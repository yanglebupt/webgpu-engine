var Oc=Object.defineProperty;var Nc=(he,ye,Se)=>ye in he?Oc(he,ye,{enumerable:!0,configurable:!0,writable:!0,value:Se}):he[ye]=Se;var S=(he,ye,Se)=>(Nc(he,typeof ye!="symbol"?ye+"":ye,Se),Se);(async()=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();function he(t,e){return t===void 0?(t=0,e=1):e===void 0&&(e=t,t=0),t+Math.random()*(e-t)}function ye(t){const e=t.reduce((n,r)=>n+r,0);return t.map(n=>n/e)}const Se=t=>t*Math.PI/180;async function is(t,e){const n=navigator.gpu;if(!n)throw new Error("Web GPU not available");const r=await n.requestAdapter(t);if(!r)throw new Error("Can not request Web GPU Adapter");e!=null&&e.requiredFeatures&&(e.requiredFeatures=e.requiredFeatures.filter(i=>r.features.has(i)));const s=await r.requestDevice(e);if(!s)throw new Error("Can not request Web GPU Device");return{gpu:n,adapter:r,device:s,format:n.getPreferredCanvasFormat()}}function os(t,e,n,r,s){var p;const i=typeof t=="object"&&typeof e=="object";if(!i&&!(typeof t!="object"&&typeof e!="object"))throw new Error("");const o=document.createElement("canvas");o.id="webgpu-canvas",r&&(o.className=r);const a=i?t.width:t,u=i?t.height:e;o.style.width=typeof a=="number"?`${a}px`:a,o.style.height=typeof u=="number"?`${u}px`:u,(p=s?document.getElementById(s):document.body)==null||p.appendChild(o);const l=i?e.width:o.clientWidth,d=i?e.height:o.clientHeight;o.width=l*window.devicePixelRatio,o.height=d*window.devicePixelRatio;const h=o.getContext("webgpu");if(!h)throw new Error("webgpu context for canvas not available");return n&&h.configure(n),{canvas:o,ctx:h,width:o.clientWidth,height:o.clientHeight,aspect:o.clientWidth/o.clientHeight}}const le=class le{static checkTextureIsValid(e,n){const r=!e||e.width!==n[0]||e.height!==n[1];return r&&e&&e.destroy(),r}static createDepthTexture(e,n){return le.checkTextureIsValid(le.depthTexture,n)&&(le.depthTexture=e.createTexture({size:n,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})),le.depthTexture}static createMultiSampleTexture(e,n,r,s){return le.checkTextureIsValid(le.multiSampleTexture,n)&&(le.multiSampleTexture=e.createTexture({format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT,size:n,sampleCount:s})),le.multiSampleTexture}};S(le,"depthTexture"),S(le,"multiSampleTexture");let gt=le,T=1e-6,z=Float32Array;function as(t){const e=z;return z=t,e}function Fe(t=0,e=0){const n=new z(2);return t!==void 0&&(n[0]=t,e!==void 0&&(n[1]=e)),n}let M=Float32Array;function us(t){const e=M;return M=t,e}function X(t,e,n){const r=new M(3);return t!==void 0&&(r[0]=t,e!==void 0&&(r[1]=e,n!==void 0&&(r[2]=n))),r}const cs=Fe;function ls(t,e,n){return n=n||new z(2),n[0]=t,n[1]=e,n}function hs(t,e){return e=e||new z(2),e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function ds(t,e){return e=e||new z(2),e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function fs(t,e){return e=e||new z(2),e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function _s(t,e=0,n=1,r){return r=r||new z(2),r[0]=Math.min(n,Math.max(e,t[0])),r[1]=Math.min(n,Math.max(e,t[1])),r}function ps(t,e,n){return n=n||new z(2),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n}function ms(t,e,n,r){return r=r||new z(2),r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function gs(t,e){const n=t[0],r=t[1],s=t[0],i=t[1],o=Math.sqrt(n*n+r*r),a=Math.sqrt(s*s+i*i),u=o*a,l=u&&rn(t,e)/u;return Math.acos(l)}function en(t,e,n){return n=n||new z(2),n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}const ys=en;function ws(t,e){return Math.abs(t[0]-e[0])<T&&Math.abs(t[1]-e[1])<T}function bs(t,e){return t[0]===e[0]&&t[1]===e[1]}function tn(t,e,n,r){return r=r||new z(2),r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r}function vs(t,e,n,r){return r=r||new z(2),r[0]=t[0]+n[0]*(e[0]-t[0]),r[1]=t[1]+n[1]*(e[1]-t[1]),r}function xs(t,e,n){return n=n||new z(2),n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n}function ks(t,e,n){return n=n||new z(2),n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n}function yt(t,e,n){return n=n||new z(2),n[0]=t[0]*e,n[1]=t[1]*e,n}const Es=yt;function Ss(t,e,n){return n=n||new z(2),n[0]=t[0]/e,n[1]=t[1]/e,n}function nn(t,e){return e=e||new z(2),e[0]=1/t[0],e[1]=1/t[1],e}const As=nn;function Ts(t,e,n){n=n||new M(3);const r=t[0]*e[1]-t[1]*e[0];return n[0]=0,n[1]=0,n[2]=r,n}function rn(t,e){return t[0]*e[0]+t[1]*e[1]}function wt(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}const Ms=wt;function sn(t){const e=t[0],n=t[1];return e*e+n*n}const Cs=sn;function on(t,e){const n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}const Os=on;function an(t,e){const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}const Ns=an;function un(t,e){e=e||new z(2);const n=t[0],r=t[1],s=Math.sqrt(n*n+r*r);return s>1e-5?(e[0]=n/s,e[1]=r/s):(e[0]=0,e[1]=0),e}function Bs(t,e){return e=e||new z(2),e[0]=-t[0],e[1]=-t[1],e}function bt(t,e){return e=e||new z(2),e[0]=t[0],e[1]=t[1],e}const zs=bt;function cn(t,e,n){return n=n||new z(2),n[0]=t[0]*e[0],n[1]=t[1]*e[1],n}const Is=cn;function ln(t,e,n){return n=n||new z(2),n[0]=t[0]/e[0],n[1]=t[1]/e[1],n}const Ls=ln;function Rs(t=1,e){e=e||new z(2);const n=Math.random()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Ps(t){return t=t||new z(2),t[0]=0,t[1]=0,t}function Us(t,e,n){n=n||new z(2);const r=t[0],s=t[1];return n[0]=r*e[0]+s*e[4]+e[12],n[1]=r*e[1]+s*e[5]+e[13],n}function Vs(t,e,n){n=n||new z(2);const r=t[0],s=t[1];return n[0]=e[0]*r+e[4]*s+e[8],n[1]=e[1]*r+e[5]*s+e[9],n}function Fs(t,e,n,r){r=r||new z(2);const s=t[0]-e[0],i=t[1]-e[1],o=Math.sin(n),a=Math.cos(n);return r[0]=s*a-i*o+e[0],r[1]=s*o+i*a+e[1],r}function hn(t,e,n){return n=n||new z(2),un(t,n),yt(n,e,n)}function Gs(t,e,n){return n=n||new z(2),wt(t)>e?hn(t,e,n):bt(t,n)}function qs(t,e,n){return n=n||new z(2),tn(t,e,.5,n)}var q=Object.freeze({__proto__:null,add:ps,addScaled:ms,angle:gs,ceil:hs,clamp:_s,clone:zs,copy:bt,create:Fe,cross:Ts,dist:Os,distSq:Ns,distance:on,distanceSq:an,div:Ls,divScalar:Ss,divide:ln,dot:rn,equals:bs,equalsApproximately:ws,floor:ds,fromValues:cs,inverse:nn,invert:As,len:Ms,lenSq:Cs,length:wt,lengthSq:sn,lerp:tn,lerpV:vs,max:xs,midpoint:qs,min:ks,mul:Is,mulScalar:yt,multiply:cn,negate:Bs,normalize:un,random:Rs,rotate:Fs,round:fs,scale:Es,set:ls,setDefaultType:as,setLength:hn,sub:ys,subtract:en,transformMat3:Vs,transformMat4:Us,truncate:Gs,zero:Ps});let dn=Float32Array;const fn=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]);let H=fn.get(Float32Array);function Ds(t){const e=dn;return dn=t,H=fn.get(t),e}function Hs(t,e,n,r,s,i,o,a,u){const l=H();return l[3]=0,l[7]=0,l[11]=0,t!==void 0&&(l[0]=t,e!==void 0&&(l[1]=e,n!==void 0&&(l[2]=n,r!==void 0&&(l[4]=r,s!==void 0&&(l[5]=s,i!==void 0&&(l[6]=i,o!==void 0&&(l[8]=o,a!==void 0&&(l[9]=a,u!==void 0&&(l[10]=u))))))))),l}function js(t,e,n,r,s,i,o,a,u,l){return l=l||H(),l[0]=t,l[1]=e,l[2]=n,l[3]=0,l[4]=r,l[5]=s,l[6]=i,l[7]=0,l[8]=o,l[9]=a,l[10]=u,l[11]=0,l}function Xs(t,e){return e=e||H(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=0,e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=0,e}function Ys(t,e){e=e||H();const n=t[0],r=t[1],s=t[2],i=t[3],o=n+n,a=r+r,u=s+s,l=n*o,d=r*o,h=r*a,p=s*o,y=s*a,x=s*u,b=i*o,g=i*a,E=i*u;return e[0]=1-h-x,e[1]=d+E,e[2]=p-g,e[3]=0,e[4]=d-E,e[5]=1-l-x,e[6]=y+b,e[7]=0,e[8]=p+g,e[9]=y-b,e[10]=1-l-h,e[11]=0,e}function Ws(t,e){return e=e||H(),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e}function vt(t,e){return e=e||H(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[8]=t[8],e[9]=t[9],e[10]=t[10],e}const Js=vt;function Ks(t,e){return Math.abs(t[0]-e[0])<T&&Math.abs(t[1]-e[1])<T&&Math.abs(t[2]-e[2])<T&&Math.abs(t[4]-e[4])<T&&Math.abs(t[5]-e[5])<T&&Math.abs(t[6]-e[6])<T&&Math.abs(t[8]-e[8])<T&&Math.abs(t[9]-e[9])<T&&Math.abs(t[10]-e[10])<T}function Qs(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]}function _n(t){return t=t||H(),t[0]=1,t[1]=0,t[2]=0,t[4]=0,t[5]=1,t[6]=0,t[8]=0,t[9]=0,t[10]=1,t}function $s(t,e){if(e=e||H(),e===t){let h;return h=t[1],t[1]=t[4],t[4]=h,h=t[2],t[2]=t[8],t[8]=h,h=t[6],t[6]=t[9],t[9]=h,e}const n=t[0*4+0],r=t[0*4+1],s=t[0*4+2],i=t[1*4+0],o=t[1*4+1],a=t[1*4+2],u=t[2*4+0],l=t[2*4+1],d=t[2*4+2];return e[0]=n,e[1]=i,e[2]=u,e[4]=r,e[5]=o,e[6]=l,e[8]=s,e[9]=a,e[10]=d,e}function pn(t,e){e=e||H();const n=t[0*4+0],r=t[0*4+1],s=t[0*4+2],i=t[1*4+0],o=t[1*4+1],a=t[1*4+2],u=t[2*4+0],l=t[2*4+1],d=t[2*4+2],h=d*o-a*l,p=-d*i+a*u,y=l*i-o*u,x=1/(n*h+r*p+s*y);return e[0]=h*x,e[1]=(-d*r+s*l)*x,e[2]=(a*r-s*o)*x,e[4]=p*x,e[5]=(d*n-s*u)*x,e[6]=(-a*n+s*i)*x,e[8]=y*x,e[9]=(-l*n+r*u)*x,e[10]=(o*n-r*i)*x,e}function Zs(t){const e=t[0],n=t[0*4+1],r=t[0*4+2],s=t[1*4+0],i=t[1*4+1],o=t[1*4+2],a=t[2*4+0],u=t[2*4+1],l=t[2*4+2];return e*(i*l-u*o)-s*(n*l-u*r)+a*(n*o-i*r)}const ei=pn;function mn(t,e,n){n=n||H();const r=t[0],s=t[1],i=t[2],o=t[4],a=t[5],u=t[6],l=t[8],d=t[9],h=t[10],p=e[0],y=e[1],x=e[2],b=e[4],g=e[5],E=e[6],k=e[8],A=e[9],C=e[10];return n[0]=r*p+o*y+l*x,n[1]=s*p+a*y+d*x,n[2]=i*p+u*y+h*x,n[4]=r*b+o*g+l*E,n[5]=s*b+a*g+d*E,n[6]=i*b+u*g+h*E,n[8]=r*k+o*A+l*C,n[9]=s*k+a*A+d*C,n[10]=i*k+u*A+h*C,n}const ti=mn;function ni(t,e,n){return n=n||_n(),t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[4]=t[4],n[5]=t[5],n[6]=t[6]),n[8]=e[0],n[9]=e[1],n[10]=1,n}function ri(t,e){return e=e||Fe(),e[0]=t[8],e[1]=t[9],e}function si(t,e,n){n=n||Fe();const r=e*4;return n[0]=t[r+0],n[1]=t[r+1],n}function ii(t,e,n,r){r!==t&&(r=vt(t,r));const s=n*4;return r[s+0]=e[0],r[s+1]=e[1],r}function oi(t,e){e=e||Fe();const n=t[0],r=t[1],s=t[4],i=t[5];return e[0]=Math.sqrt(n*n+r*r),e[1]=Math.sqrt(s*s+i*i),e}function ai(t,e){return e=e||H(),e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=t[0],e[9]=t[1],e[10]=1,e}function ui(t,e,n){n=n||H();const r=e[0],s=e[1],i=t[0],o=t[1],a=t[2],u=t[1*4+0],l=t[1*4+1],d=t[1*4+2],h=t[2*4+0],p=t[2*4+1],y=t[2*4+2];return t!==n&&(n[0]=i,n[1]=o,n[2]=a,n[4]=u,n[5]=l,n[6]=d),n[8]=i*r+u*s+h,n[9]=o*r+l*s+p,n[10]=a*r+d*s+y,n}function ci(t,e){e=e||H();const n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=r,e[2]=0,e[4]=-r,e[5]=n,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function li(t,e,n){n=n||H();const r=t[0*4+0],s=t[0*4+1],i=t[0*4+2],o=t[1*4+0],a=t[1*4+1],u=t[1*4+2],l=Math.cos(e),d=Math.sin(e);return n[0]=l*r+d*o,n[1]=l*s+d*a,n[2]=l*i+d*u,n[4]=l*o-d*r,n[5]=l*a-d*s,n[6]=l*u-d*i,t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10]),n}function hi(t,e){return e=e||H(),e[0]=t[0],e[1]=0,e[2]=0,e[4]=0,e[5]=t[1],e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function di(t,e,n){n=n||H();const r=e[0],s=e[1];return n[0]=r*t[0*4+0],n[1]=r*t[0*4+1],n[2]=r*t[0*4+2],n[4]=s*t[1*4+0],n[5]=s*t[1*4+1],n[6]=s*t[1*4+2],t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10]),n}function fi(t,e){return e=e||H(),e[0]=t,e[1]=0,e[2]=0,e[4]=0,e[5]=t,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function _i(t,e,n){return n=n||H(),n[0]=e*t[0*4+0],n[1]=e*t[0*4+1],n[2]=e*t[0*4+2],n[4]=e*t[1*4+0],n[5]=e*t[1*4+1],n[6]=e*t[1*4+2],t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10]),n}var gn=Object.freeze({__proto__:null,clone:Js,copy:vt,create:Hs,determinant:Zs,equals:Qs,equalsApproximately:Ks,fromMat4:Xs,fromQuat:Ys,getAxis:si,getScaling:oi,getTranslation:ri,identity:_n,inverse:pn,invert:ei,mul:ti,multiply:mn,negate:Ws,rotate:li,rotation:ci,scale:di,scaling:hi,set:js,setAxis:ii,setDefaultType:Ds,setTranslation:ni,translate:ui,translation:ai,transpose:$s,uniformScale:_i,uniformScaling:fi});const pi=X;function mi(t,e,n,r){return r=r||new M(3),r[0]=t,r[1]=e,r[2]=n,r}function gi(t,e){return e=e||new M(3),e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function yi(t,e){return e=e||new M(3),e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function wi(t,e){return e=e||new M(3),e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function bi(t,e=0,n=1,r){return r=r||new M(3),r[0]=Math.min(n,Math.max(e,t[0])),r[1]=Math.min(n,Math.max(e,t[1])),r[2]=Math.min(n,Math.max(e,t[2])),r}function vi(t,e,n){return n=n||new M(3),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function xi(t,e,n,r){return r=r||new M(3),r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function ki(t,e){const n=t[0],r=t[1],s=t[2],i=t[0],o=t[1],a=t[2],u=Math.sqrt(n*n+r*r+s*s),l=Math.sqrt(i*i+o*o+a*a),d=u*l,h=d&&kt(t,e)/d;return Math.acos(h)}function Ge(t,e,n){return n=n||new M(3),n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}const Ei=Ge;function Si(t,e){return Math.abs(t[0]-e[0])<T&&Math.abs(t[1]-e[1])<T&&Math.abs(t[2]-e[2])<T}function Ai(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function yn(t,e,n,r){return r=r||new M(3),r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r[2]=t[2]+n*(e[2]-t[2]),r}function Ti(t,e,n,r){return r=r||new M(3),r[0]=t[0]+n[0]*(e[0]-t[0]),r[1]=t[1]+n[1]*(e[1]-t[1]),r[2]=t[2]+n[2]*(e[2]-t[2]),r}function Mi(t,e,n){return n=n||new M(3),n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n}function Ci(t,e,n){return n=n||new M(3),n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n}function xt(t,e,n){return n=n||new M(3),n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n}const Oi=xt;function Ni(t,e,n){return n=n||new M(3),n[0]=t[0]/e,n[1]=t[1]/e,n[2]=t[2]/e,n}function wn(t,e){return e=e||new M(3),e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}const Bi=wn;function _e(t,e,n){n=n||new M(3);const r=t[2]*e[0]-t[0]*e[2],s=t[0]*e[1]-t[1]*e[0];return n[0]=t[1]*e[2]-t[2]*e[1],n[1]=r,n[2]=s,n}function kt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Et(t){const e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}const bn=Et;function vn(t){const e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}const zi=vn;function xn(t,e){const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(n*n+r*r+s*s)}const Ii=xn;function kn(t,e){const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return n*n+r*r+s*s}const Li=kn;function ue(t,e){e=e||new M(3);const n=t[0],r=t[1],s=t[2],i=Math.sqrt(n*n+r*r+s*s);return i>1e-5?(e[0]=n/i,e[1]=r/i,e[2]=s/i):(e[0]=0,e[1]=0,e[2]=0),e}function Ri(t,e){return e=e||new M(3),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function St(t,e){return e=e||new M(3),e[0]=t[0],e[1]=t[1],e[2]=t[2],e}const Pi=St;function En(t,e,n){return n=n||new M(3),n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n}const Ui=En;function Sn(t,e,n){return n=n||new M(3),n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n}const Vi=Sn;function Fi(t=1,e){e=e||new M(3);const n=Math.random()*2*Math.PI,r=Math.random()*2-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=r*t,e}function Gi(t){return t=t||new M(3),t[0]=0,t[1]=0,t[2]=0,t}function qi(t,e,n){n=n||new M(3);const r=t[0],s=t[1],i=t[2],o=e[3]*r+e[7]*s+e[11]*i+e[15]||1;return n[0]=(e[0]*r+e[4]*s+e[8]*i+e[12])/o,n[1]=(e[1]*r+e[5]*s+e[9]*i+e[13])/o,n[2]=(e[2]*r+e[6]*s+e[10]*i+e[14])/o,n}function Di(t,e,n){n=n||new M(3);const r=t[0],s=t[1],i=t[2];return n[0]=r*e[0*4+0]+s*e[1*4+0]+i*e[2*4+0],n[1]=r*e[0*4+1]+s*e[1*4+1]+i*e[2*4+1],n[2]=r*e[0*4+2]+s*e[1*4+2]+i*e[2*4+2],n}function Hi(t,e,n){n=n||new M(3);const r=t[0],s=t[1],i=t[2];return n[0]=r*e[0]+s*e[4]+i*e[8],n[1]=r*e[1]+s*e[5]+i*e[9],n[2]=r*e[2]+s*e[6]+i*e[10],n}function ji(t,e,n){n=n||new M(3);const r=e[0],s=e[1],i=e[2],o=e[3]*2,a=t[0],u=t[1],l=t[2],d=s*l-i*u,h=i*a-r*l,p=r*u-s*a;return n[0]=a+d*o+(s*p-i*h)*2,n[1]=u+h*o+(i*d-r*p)*2,n[2]=l+p*o+(r*h-s*d)*2,n}function Xi(t,e){return e=e||new M(3),e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Yi(t,e,n){n=n||new M(3);const r=e*4;return n[0]=t[r+0],n[1]=t[r+1],n[2]=t[r+2],n}function Wi(t,e){e=e||new M(3);const n=t[0],r=t[1],s=t[2],i=t[4],o=t[5],a=t[6],u=t[8],l=t[9],d=t[10];return e[0]=Math.sqrt(n*n+r*r+s*s),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(u*u+l*l+d*d),e}function Ji(t,e,n,r){r=r||new M(3);const s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),r[0]=i[0]+e[0],r[1]=i[1]+e[1],r[2]=i[2]+e[2],r}function Ki(t,e,n,r){r=r||new M(3);const s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),r[0]=i[0]+e[0],r[1]=i[1]+e[1],r[2]=i[2]+e[2],r}function Qi(t,e,n,r){r=r||new M(3);const s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],r[0]=i[0]+e[0],r[1]=i[1]+e[1],r[2]=i[2]+e[2],r}function An(t,e,n){return n=n||new M(3),ue(t,n),xt(n,e,n)}function $i(t,e,n){return n=n||new M(3),Et(t)>e?An(t,e,n):St(t,n)}function Zi(t,e,n){return n=n||new M(3),yn(t,e,.5,n)}var te=Object.freeze({__proto__:null,add:vi,addScaled:xi,angle:ki,ceil:gi,clamp:bi,clone:Pi,copy:St,create:X,cross:_e,dist:Ii,distSq:Li,distance:xn,distanceSq:kn,div:Vi,divScalar:Ni,divide:Sn,dot:kt,equals:Ai,equalsApproximately:Si,floor:yi,fromValues:pi,getAxis:Yi,getScaling:Wi,getTranslation:Xi,inverse:wn,invert:Bi,len:bn,lenSq:zi,length:Et,lengthSq:vn,lerp:yn,lerpV:Ti,max:Mi,midpoint:Zi,min:Ci,mul:Ui,mulScalar:xt,multiply:En,negate:Ri,normalize:ue,random:Fi,rotateX:Ji,rotateY:Ki,rotateZ:Qi,round:wi,scale:Oi,set:mi,setDefaultType:us,setLength:An,sub:Ei,subtract:Ge,transformMat3:Hi,transformMat4:qi,transformMat4Upper3x3:Di,transformQuat:ji,truncate:$i,zero:Gi});let B=Float32Array;function eo(t){const e=B;return B=t,e}function to(t,e,n,r,s,i,o,a,u,l,d,h,p,y,x,b){const g=new B(16);return t!==void 0&&(g[0]=t,e!==void 0&&(g[1]=e,n!==void 0&&(g[2]=n,r!==void 0&&(g[3]=r,s!==void 0&&(g[4]=s,i!==void 0&&(g[5]=i,o!==void 0&&(g[6]=o,a!==void 0&&(g[7]=a,u!==void 0&&(g[8]=u,l!==void 0&&(g[9]=l,d!==void 0&&(g[10]=d,h!==void 0&&(g[11]=h,p!==void 0&&(g[12]=p,y!==void 0&&(g[13]=y,x!==void 0&&(g[14]=x,b!==void 0&&(g[15]=b)))))))))))))))),g}function no(t,e,n,r,s,i,o,a,u,l,d,h,p,y,x,b,g){return g=g||new B(16),g[0]=t,g[1]=e,g[2]=n,g[3]=r,g[4]=s,g[5]=i,g[6]=o,g[7]=a,g[8]=u,g[9]=l,g[10]=d,g[11]=h,g[12]=p,g[13]=y,g[14]=x,g[15]=b,g}function ro(t,e){return e=e||new B(16),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=0,e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function so(t,e){e=e||new B(16);const n=t[0],r=t[1],s=t[2],i=t[3],o=n+n,a=r+r,u=s+s,l=n*o,d=r*o,h=r*a,p=s*o,y=s*a,x=s*u,b=i*o,g=i*a,E=i*u;return e[0]=1-h-x,e[1]=d+E,e[2]=p-g,e[3]=0,e[4]=d-E,e[5]=1-l-x,e[6]=y+b,e[7]=0,e[8]=p+g,e[9]=y-b,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function io(t,e){return e=e||new B(16),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e}function At(t,e){return e=e||new B(16),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}const oo=At;function ao(t,e){return Math.abs(t[0]-e[0])<T&&Math.abs(t[1]-e[1])<T&&Math.abs(t[2]-e[2])<T&&Math.abs(t[3]-e[3])<T&&Math.abs(t[4]-e[4])<T&&Math.abs(t[5]-e[5])<T&&Math.abs(t[6]-e[6])<T&&Math.abs(t[7]-e[7])<T&&Math.abs(t[8]-e[8])<T&&Math.abs(t[9]-e[9])<T&&Math.abs(t[10]-e[10])<T&&Math.abs(t[11]-e[11])<T&&Math.abs(t[12]-e[12])<T&&Math.abs(t[13]-e[13])<T&&Math.abs(t[14]-e[14])<T&&Math.abs(t[15]-e[15])<T}function uo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Tn(t){return t=t||new B(16),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function co(t,e){if(e=e||new B(16),e===t){let k;return k=t[1],t[1]=t[4],t[4]=k,k=t[2],t[2]=t[8],t[8]=k,k=t[3],t[3]=t[12],t[12]=k,k=t[6],t[6]=t[9],t[9]=k,k=t[7],t[7]=t[13],t[13]=k,k=t[11],t[11]=t[14],t[14]=k,e}const n=t[0*4+0],r=t[0*4+1],s=t[0*4+2],i=t[0*4+3],o=t[1*4+0],a=t[1*4+1],u=t[1*4+2],l=t[1*4+3],d=t[2*4+0],h=t[2*4+1],p=t[2*4+2],y=t[2*4+3],x=t[3*4+0],b=t[3*4+1],g=t[3*4+2],E=t[3*4+3];return e[0]=n,e[1]=o,e[2]=d,e[3]=x,e[4]=r,e[5]=a,e[6]=h,e[7]=b,e[8]=s,e[9]=u,e[10]=p,e[11]=g,e[12]=i,e[13]=l,e[14]=y,e[15]=E,e}function Mn(t,e){e=e||new B(16);const n=t[0*4+0],r=t[0*4+1],s=t[0*4+2],i=t[0*4+3],o=t[1*4+0],a=t[1*4+1],u=t[1*4+2],l=t[1*4+3],d=t[2*4+0],h=t[2*4+1],p=t[2*4+2],y=t[2*4+3],x=t[3*4+0],b=t[3*4+1],g=t[3*4+2],E=t[3*4+3],k=p*E,A=g*y,C=u*E,O=g*l,L=u*y,D=p*l,J=s*E,K=g*i,Q=s*y,$=p*i,Z=s*l,ne=u*i,re=d*b,se=x*h,ie=o*b,oe=x*a,ae=o*h,lt=d*a,ht=n*b,dt=x*r,ft=n*h,_t=d*r,pt=n*a,mt=o*r,ts=k*a+O*h+L*b-(A*a+C*h+D*b),ns=A*r+J*h+$*b-(k*r+K*h+Q*b),rs=C*r+K*a+Z*b-(O*r+J*a+ne*b),ss=D*r+Q*a+ne*h-(L*r+$*a+Z*h),ee=1/(n*ts+o*ns+d*rs+x*ss);return e[0]=ee*ts,e[1]=ee*ns,e[2]=ee*rs,e[3]=ee*ss,e[4]=ee*(A*o+C*d+D*x-(k*o+O*d+L*x)),e[5]=ee*(k*n+K*d+Q*x-(A*n+J*d+$*x)),e[6]=ee*(O*n+J*o+ne*x-(C*n+K*o+Z*x)),e[7]=ee*(L*n+$*o+Z*d-(D*n+Q*o+ne*d)),e[8]=ee*(re*l+oe*y+ae*E-(se*l+ie*y+lt*E)),e[9]=ee*(se*i+ht*y+_t*E-(re*i+dt*y+ft*E)),e[10]=ee*(ie*i+dt*l+pt*E-(oe*i+ht*l+mt*E)),e[11]=ee*(lt*i+ft*l+mt*y-(ae*i+_t*l+pt*y)),e[12]=ee*(ie*p+lt*g+se*u-(ae*g+re*u+oe*p)),e[13]=ee*(ft*g+re*s+dt*p-(ht*p+_t*g+se*s)),e[14]=ee*(ht*u+mt*g+oe*s-(pt*g+ie*s+dt*u)),e[15]=ee*(pt*p+ae*s+_t*u-(ft*u+mt*p+lt*s)),e}function lo(t){const e=t[0],n=t[0*4+1],r=t[0*4+2],s=t[0*4+3],i=t[1*4+0],o=t[1*4+1],a=t[1*4+2],u=t[1*4+3],l=t[2*4+0],d=t[2*4+1],h=t[2*4+2],p=t[2*4+3],y=t[3*4+0],x=t[3*4+1],b=t[3*4+2],g=t[3*4+3],E=h*g,k=b*p,A=a*g,C=b*u,O=a*p,L=h*u,D=r*g,J=b*s,K=r*p,Q=h*s,$=r*u,Z=a*s,ne=E*o+C*d+O*x-(k*o+A*d+L*x),re=k*n+D*d+Q*x-(E*n+J*d+K*x),se=A*n+J*o+$*x-(C*n+D*o+Z*x),ie=L*n+K*o+Z*d-(O*n+Q*o+$*d);return e*ne+i*re+l*se+y*ie}const ho=Mn;function Cn(t,e,n){n=n||new B(16);const r=t[0],s=t[1],i=t[2],o=t[3],a=t[4],u=t[5],l=t[6],d=t[7],h=t[8],p=t[9],y=t[10],x=t[11],b=t[12],g=t[13],E=t[14],k=t[15],A=e[0],C=e[1],O=e[2],L=e[3],D=e[4],J=e[5],K=e[6],Q=e[7],$=e[8],Z=e[9],ne=e[10],re=e[11],se=e[12],ie=e[13],oe=e[14],ae=e[15];return n[0]=r*A+a*C+h*O+b*L,n[1]=s*A+u*C+p*O+g*L,n[2]=i*A+l*C+y*O+E*L,n[3]=o*A+d*C+x*O+k*L,n[4]=r*D+a*J+h*K+b*Q,n[5]=s*D+u*J+p*K+g*Q,n[6]=i*D+l*J+y*K+E*Q,n[7]=o*D+d*J+x*K+k*Q,n[8]=r*$+a*Z+h*ne+b*re,n[9]=s*$+u*Z+p*ne+g*re,n[10]=i*$+l*Z+y*ne+E*re,n[11]=o*$+d*Z+x*ne+k*re,n[12]=r*se+a*ie+h*oe+b*ae,n[13]=s*se+u*ie+p*oe+g*ae,n[14]=i*se+l*ie+y*oe+E*ae,n[15]=o*se+d*ie+x*oe+k*ae,n}const fo=Cn;function _o(t,e,n){return n=n||Tn(),t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11]),n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}function po(t,e){return e=e||X(),e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function mo(t,e,n){n=n||X();const r=e*4;return n[0]=t[r+0],n[1]=t[r+1],n[2]=t[r+2],n}function go(t,e,n,r){r!==t&&(r=At(t,r));const s=n*4;return r[s+0]=e[0],r[s+1]=e[1],r[s+2]=e[2],r}function yo(t,e){e=e||X();const n=t[0],r=t[1],s=t[2],i=t[4],o=t[5],a=t[6],u=t[8],l=t[9],d=t[10];return e[0]=Math.sqrt(n*n+r*r+s*s),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(u*u+l*l+d*d),e}function wo(t,e,n,r,s){s=s||new B(16);const i=Math.tan(Math.PI*.5-.5*t);if(s[0]=i/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,r===1/0)s[10]=-1,s[14]=-n;else{const o=1/(n-r);s[10]=r*o,s[14]=r*n*o}return s}function bo(t,e,n,r,s,i,o){return o=o||new B(16),o[0]=2/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(r-n),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1/(s-i),o[11]=0,o[12]=(e+t)/(t-e),o[13]=(r+n)/(n-r),o[14]=s/(s-i),o[15]=1,o}function vo(t,e,n,r,s,i,o){o=o||new B(16);const a=e-t,u=r-n,l=s-i;return o[0]=2*s/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*s/u,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(r+n)/u,o[10]=i/l,o[11]=-1,o[12]=0,o[13]=0,o[14]=s*i/l,o[15]=0,o}let P,F,I;function xo(t,e,n,r){return r=r||new B(16),P=P||X(),F=F||X(),I=I||X(),ue(Ge(e,t,I),I),ue(_e(n,I,P),P),ue(_e(I,P,F),F),r[0]=P[0],r[1]=P[1],r[2]=P[2],r[3]=0,r[4]=F[0],r[5]=F[1],r[6]=F[2],r[7]=0,r[8]=I[0],r[9]=I[1],r[10]=I[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function ko(t,e,n,r){return r=r||new B(16),P=P||X(),F=F||X(),I=I||X(),ue(Ge(t,e,I),I),ue(_e(n,I,P),P),ue(_e(I,P,F),F),r[0]=P[0],r[1]=P[1],r[2]=P[2],r[3]=0,r[4]=F[0],r[5]=F[1],r[6]=F[2],r[7]=0,r[8]=I[0],r[9]=I[1],r[10]=I[2],r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function Eo(t,e,n,r){return r=r||new B(16),P=P||X(),F=F||X(),I=I||X(),ue(Ge(t,e,I),I),ue(_e(n,I,P),P),ue(_e(I,P,F),F),r[0]=P[0],r[1]=F[0],r[2]=I[0],r[3]=0,r[4]=P[1],r[5]=F[1],r[6]=I[1],r[7]=0,r[8]=P[2],r[9]=F[2],r[10]=I[2],r[11]=0,r[12]=-(P[0]*t[0]+P[1]*t[1]+P[2]*t[2]),r[13]=-(F[0]*t[0]+F[1]*t[1]+F[2]*t[2]),r[14]=-(I[0]*t[0]+I[1]*t[1]+I[2]*t[2]),r[15]=1,r}function So(t,e){return e=e||new B(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ao(t,e,n){n=n||new B(16);const r=e[0],s=e[1],i=e[2],o=t[0],a=t[1],u=t[2],l=t[3],d=t[1*4+0],h=t[1*4+1],p=t[1*4+2],y=t[1*4+3],x=t[2*4+0],b=t[2*4+1],g=t[2*4+2],E=t[2*4+3],k=t[3*4+0],A=t[3*4+1],C=t[3*4+2],O=t[3*4+3];return t!==n&&(n[0]=o,n[1]=a,n[2]=u,n[3]=l,n[4]=d,n[5]=h,n[6]=p,n[7]=y,n[8]=x,n[9]=b,n[10]=g,n[11]=E),n[12]=o*r+d*s+x*i+k,n[13]=a*r+h*s+b*i+A,n[14]=u*r+p*s+g*i+C,n[15]=l*r+y*s+E*i+O,n}function To(t,e){e=e||new B(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Mo(t,e,n){n=n||new B(16);const r=t[4],s=t[5],i=t[6],o=t[7],a=t[8],u=t[9],l=t[10],d=t[11],h=Math.cos(e),p=Math.sin(e);return n[4]=h*r+p*a,n[5]=h*s+p*u,n[6]=h*i+p*l,n[7]=h*o+p*d,n[8]=h*a-p*r,n[9]=h*u-p*s,n[10]=h*l-p*i,n[11]=h*d-p*o,t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}function Co(t,e){e=e||new B(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Oo(t,e,n){n=n||new B(16);const r=t[0*4+0],s=t[0*4+1],i=t[0*4+2],o=t[0*4+3],a=t[2*4+0],u=t[2*4+1],l=t[2*4+2],d=t[2*4+3],h=Math.cos(e),p=Math.sin(e);return n[0]=h*r-p*a,n[1]=h*s-p*u,n[2]=h*i-p*l,n[3]=h*o-p*d,n[8]=h*a+p*r,n[9]=h*u+p*s,n[10]=h*l+p*i,n[11]=h*d+p*o,t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}function No(t,e){e=e||new B(16);const n=Math.cos(t),r=Math.sin(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bo(t,e,n){n=n||new B(16);const r=t[0*4+0],s=t[0*4+1],i=t[0*4+2],o=t[0*4+3],a=t[1*4+0],u=t[1*4+1],l=t[1*4+2],d=t[1*4+3],h=Math.cos(e),p=Math.sin(e);return n[0]=h*r+p*a,n[1]=h*s+p*u,n[2]=h*i+p*l,n[3]=h*o+p*d,n[4]=h*a-p*r,n[5]=h*u-p*s,n[6]=h*l-p*i,n[7]=h*d-p*o,t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}function On(t,e,n){n=n||new B(16);let r=t[0],s=t[1],i=t[2];const o=Math.sqrt(r*r+s*s+i*i);r/=o,s/=o,i/=o;const a=r*r,u=s*s,l=i*i,d=Math.cos(e),h=Math.sin(e),p=1-d;return n[0]=a+(1-a)*d,n[1]=r*s*p+i*h,n[2]=r*i*p-s*h,n[3]=0,n[4]=r*s*p-i*h,n[5]=u+(1-u)*d,n[6]=s*i*p+r*h,n[7]=0,n[8]=r*i*p+s*h,n[9]=s*i*p-r*h,n[10]=l+(1-l)*d,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}const zo=On;function Nn(t,e,n,r){r=r||new B(16);let s=e[0],i=e[1],o=e[2];const a=Math.sqrt(s*s+i*i+o*o);s/=a,i/=a,o/=a;const u=s*s,l=i*i,d=o*o,h=Math.cos(n),p=Math.sin(n),y=1-h,x=u+(1-u)*h,b=s*i*y+o*p,g=s*o*y-i*p,E=s*i*y-o*p,k=l+(1-l)*h,A=i*o*y+s*p,C=s*o*y+i*p,O=i*o*y-s*p,L=d+(1-d)*h,D=t[0],J=t[1],K=t[2],Q=t[3],$=t[4],Z=t[5],ne=t[6],re=t[7],se=t[8],ie=t[9],oe=t[10],ae=t[11];return r[0]=x*D+b*$+g*se,r[1]=x*J+b*Z+g*ie,r[2]=x*K+b*ne+g*oe,r[3]=x*Q+b*re+g*ae,r[4]=E*D+k*$+A*se,r[5]=E*J+k*Z+A*ie,r[6]=E*K+k*ne+A*oe,r[7]=E*Q+k*re+A*ae,r[8]=C*D+O*$+L*se,r[9]=C*J+O*Z+L*ie,r[10]=C*K+O*ne+L*oe,r[11]=C*Q+O*re+L*ae,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}const Io=Nn;function Lo(t,e){return e=e||new B(16),e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ro(t,e,n){n=n||new B(16);const r=e[0],s=e[1],i=e[2];return n[0]=r*t[0*4+0],n[1]=r*t[0*4+1],n[2]=r*t[0*4+2],n[3]=r*t[0*4+3],n[4]=s*t[1*4+0],n[5]=s*t[1*4+1],n[6]=s*t[1*4+2],n[7]=s*t[1*4+3],n[8]=i*t[2*4+0],n[9]=i*t[2*4+1],n[10]=i*t[2*4+2],n[11]=i*t[2*4+3],t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}function Po(t,e){return e=e||new B(16),e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Uo(t,e,n){return n=n||new B(16),n[0]=e*t[0*4+0],n[1]=e*t[0*4+1],n[2]=e*t[0*4+2],n[3]=e*t[0*4+3],n[4]=e*t[1*4+0],n[5]=e*t[1*4+1],n[6]=e*t[1*4+2],n[7]=e*t[1*4+3],n[8]=e*t[2*4+0],n[9]=e*t[2*4+1],n[10]=e*t[2*4+2],n[11]=e*t[2*4+3],t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}var j=Object.freeze({__proto__:null,aim:xo,axisRotate:Nn,axisRotation:On,cameraAim:ko,clone:oo,copy:At,create:to,determinant:lo,equals:uo,equalsApproximately:ao,fromMat3:ro,fromQuat:so,frustum:vo,getAxis:mo,getScaling:yo,getTranslation:po,identity:Tn,inverse:Mn,invert:ho,lookAt:Eo,mul:fo,multiply:Cn,negate:io,ortho:bo,perspective:wo,rotate:Io,rotateX:Mo,rotateY:Oo,rotateZ:Bo,rotation:zo,rotationX:To,rotationY:Co,rotationZ:No,scale:Ro,scaling:Lo,set:no,setAxis:go,setDefaultType:eo,setTranslation:_o,translate:Ao,translation:So,transpose:co,uniformScale:Uo,uniformScaling:Po});let U=Float32Array;function Vo(t){const e=U;return U=t,e}function Bn(t,e,n,r){const s=new U(4);return t!==void 0&&(s[0]=t,e!==void 0&&(s[1]=e,n!==void 0&&(s[2]=n,r!==void 0&&(s[3]=r)))),s}const Fo=Bn;function Go(t,e,n,r,s){return s=s||new U(4),s[0]=t,s[1]=e,s[2]=n,s[3]=r,s}function zn(t,e,n){n=n||new U(4);const r=e*.5,s=Math.sin(r);return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=Math.cos(r),n}function qo(t,e){e=e||X(4);const n=Math.acos(t[3])*2,r=Math.sin(n*.5);return r>T?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),{angle:n,axis:e}}function Do(t,e){const n=Un(t,e);return Math.acos(2*n*n-1)}function In(t,e,n){n=n||new U(4);const r=t[0],s=t[1],i=t[2],o=t[3],a=e[0],u=e[1],l=e[2],d=e[3];return n[0]=r*d+o*a+s*l-i*u,n[1]=s*d+o*u+i*a-r*l,n[2]=i*d+o*l+r*u-s*a,n[3]=o*d-r*a-s*u-i*l,n}const Ho=In;function jo(t,e,n){n=n||new U(4);const r=e*.5,s=t[0],i=t[1],o=t[2],a=t[3],u=Math.sin(r),l=Math.cos(r);return n[0]=s*l+a*u,n[1]=i*l+o*u,n[2]=o*l-i*u,n[3]=a*l-s*u,n}function Xo(t,e,n){n=n||new U(4);const r=e*.5,s=t[0],i=t[1],o=t[2],a=t[3],u=Math.sin(r),l=Math.cos(r);return n[0]=s*l-o*u,n[1]=i*l+a*u,n[2]=o*l+s*u,n[3]=a*l-i*u,n}function Yo(t,e,n){n=n||new U(4);const r=e*.5,s=t[0],i=t[1],o=t[2],a=t[3],u=Math.sin(r),l=Math.cos(r);return n[0]=s*l+i*u,n[1]=i*l-s*u,n[2]=o*l+a*u,n[3]=a*l-o*u,n}function Qe(t,e,n,r){r=r||new U(4);const s=t[0],i=t[1],o=t[2],a=t[3];let u=e[0],l=e[1],d=e[2],h=e[3],p=s*u+i*l+o*d+a*h;p<0&&(p=-p,u=-u,l=-l,d=-d,h=-h);let y,x;if(1-p>T){const b=Math.acos(p),g=Math.sin(b);y=Math.sin((1-n)*b)/g,x=Math.sin(n*b)/g}else y=1-n,x=n;return r[0]=y*s+x*u,r[1]=y*i+x*l,r[2]=y*o+x*d,r[3]=y*a+x*h,r}function Wo(t,e){e=e||new U(4);const n=t[0],r=t[1],s=t[2],i=t[3],o=n*n+r*r+s*s+i*i,a=o?1/o:0;return e[0]=-n*a,e[1]=-r*a,e[2]=-s*a,e[3]=i*a,e}function Jo(t,e){return e=e||new U(4),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Ko(t,e){e=e||new U(4);const n=t[0]+t[5]+t[10];if(n>0){const r=Math.sqrt(n+1);e[3]=.5*r;const s=.5/r;e[0]=(t[6]-t[9])*s,e[1]=(t[8]-t[2])*s,e[2]=(t[1]-t[4])*s}else{let r=0;t[5]>t[0]&&(r=1),t[10]>t[r*4+r]&&(r=2);const s=(r+1)%3,i=(r+2)%3,o=Math.sqrt(t[r*4+r]-t[s*4+s]-t[i*4+i]+1);e[r]=.5*o;const a=.5/o;e[3]=(t[s*4+i]-t[i*4+s])*a,e[s]=(t[s*4+r]+t[r*4+s])*a,e[i]=(t[i*4+r]+t[r*4+i])*a}return e}function Qo(t,e,n,r,s){s=s||new U(4);const i=t*.5,o=e*.5,a=n*.5,u=Math.sin(i),l=Math.cos(i),d=Math.sin(o),h=Math.cos(o),p=Math.sin(a),y=Math.cos(a);switch(r){case"xyz":s[0]=u*h*y+l*d*p,s[1]=l*d*y-u*h*p,s[2]=l*h*p+u*d*y,s[3]=l*h*y-u*d*p;break;case"xzy":s[0]=u*h*y-l*d*p,s[1]=l*d*y-u*h*p,s[2]=l*h*p+u*d*y,s[3]=l*h*y+u*d*p;break;case"yxz":s[0]=u*h*y+l*d*p,s[1]=l*d*y-u*h*p,s[2]=l*h*p-u*d*y,s[3]=l*h*y+u*d*p;break;case"yzx":s[0]=u*h*y+l*d*p,s[1]=l*d*y+u*h*p,s[2]=l*h*p-u*d*y,s[3]=l*h*y-u*d*p;break;case"zxy":s[0]=u*h*y-l*d*p,s[1]=l*d*y+u*h*p,s[2]=l*h*p+u*d*y,s[3]=l*h*y-u*d*p;break;case"zyx":s[0]=u*h*y-l*d*p,s[1]=l*d*y+u*h*p,s[2]=l*h*p-u*d*y,s[3]=l*h*y+u*d*p;break;default:throw new Error(`Unknown rotation order: ${r}`)}return s}function Ln(t,e){return e=e||new U(4),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}const $o=Ln;function Zo(t,e,n){return n=n||new U(4),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function Rn(t,e,n){return n=n||new U(4),n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[3]=t[3]-e[3],n}const ea=Rn;function Pn(t,e,n){return n=n||new U(4),n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}const ta=Pn;function na(t,e,n){return n=n||new U(4),n[0]=t[0]/e,n[1]=t[1]/e,n[2]=t[2]/e,n[3]=t[3]/e,n}function Un(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function ra(t,e,n,r){return r=r||new U(4),r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r[2]=t[2]+n*(e[2]-t[2]),r[3]=t[3]+n*(e[3]-t[3]),r}function Vn(t){const e=t[0],n=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+n*n+r*r+s*s)}const sa=Vn;function Fn(t){const e=t[0],n=t[1],r=t[2],s=t[3];return e*e+n*n+r*r+s*s}const ia=Fn;function Gn(t,e){e=e||new U(4);const n=t[0],r=t[1],s=t[2],i=t[3],o=Math.sqrt(n*n+r*r+s*s+i*i);return o>1e-5?(e[0]=n/o,e[1]=r/o,e[2]=s/o,e[3]=i/o):(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function oa(t,e){return Math.abs(t[0]-e[0])<T&&Math.abs(t[1]-e[1])<T&&Math.abs(t[2]-e[2])<T&&Math.abs(t[3]-e[3])<T}function aa(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function ua(t){return t=t||new U(4),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}let ce,Tt,Mt;function ca(t,e,n){n=n||new U(4),ce=ce||X(),Tt=Tt||X(1,0,0),Mt=Mt||X(0,1,0);const r=kt(t,e);return r<-.999999?(_e(Tt,t,ce),bn(ce)<1e-6&&_e(Mt,t,ce),ue(ce,ce),zn(ce,Math.PI,n),n):r>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(_e(t,e,ce),n[0]=ce[0],n[1]=ce[1],n[2]=ce[2],n[3]=1+r,Gn(n,n))}let $e,Ze;function la(t,e,n,r,s,i){return i=i||new U(4),$e=$e||new U(4),Ze=Ze||new U(4),Qe(t,r,s,$e),Qe(e,n,s,Ze),Qe($e,Ze,2*s*(1-s),i),i}var Be=Object.freeze({__proto__:null,add:Zo,angle:Do,clone:$o,conjugate:Jo,copy:Ln,create:Bn,divScalar:na,dot:Un,equals:aa,equalsApproximately:oa,fromAxisAngle:zn,fromEuler:Qo,fromMat:Ko,fromValues:Fo,identity:ua,inverse:Wo,len:sa,lenSq:ia,length:Vn,lengthSq:Fn,lerp:ra,mul:Ho,mulScalar:Pn,multiply:In,normalize:Gn,rotateX:jo,rotateY:Xo,rotateZ:Yo,rotationTo:ca,scale:ta,set:Go,setDefaultType:Vo,slerp:Qe,sqlerp:la,sub:ea,subtract:Rn,toAxisAngle:qo});let R=Float32Array;function ha(t){const e=R;return R=t,e}function qn(t,e,n,r){const s=new R(4);return t!==void 0&&(s[0]=t,e!==void 0&&(s[1]=e,n!==void 0&&(s[2]=n,r!==void 0&&(s[3]=r)))),s}const da=qn;function fa(t,e,n,r,s){return s=s||new R(4),s[0]=t,s[1]=e,s[2]=n,s[3]=r,s}function _a(t,e){return e=e||new R(4),e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function pa(t,e){return e=e||new R(4),e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function ma(t,e){return e=e||new R(4),e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function ga(t,e=0,n=1,r){return r=r||new R(4),r[0]=Math.min(n,Math.max(e,t[0])),r[1]=Math.min(n,Math.max(e,t[1])),r[2]=Math.min(n,Math.max(e,t[2])),r[3]=Math.min(n,Math.max(e,t[3])),r}function ya(t,e,n){return n=n||new R(4),n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function wa(t,e,n,r){return r=r||new R(4),r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r[3]=t[3]+e[3]*n,r}function Dn(t,e,n){return n=n||new R(4),n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[3]=t[3]-e[3],n}const ba=Dn;function va(t,e){return Math.abs(t[0]-e[0])<T&&Math.abs(t[1]-e[1])<T&&Math.abs(t[2]-e[2])<T&&Math.abs(t[3]-e[3])<T}function xa(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Hn(t,e,n,r){return r=r||new R(4),r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r[2]=t[2]+n*(e[2]-t[2]),r[3]=t[3]+n*(e[3]-t[3]),r}function ka(t,e,n,r){return r=r||new R(4),r[0]=t[0]+n[0]*(e[0]-t[0]),r[1]=t[1]+n[1]*(e[1]-t[1]),r[2]=t[2]+n[2]*(e[2]-t[2]),r[3]=t[3]+n[3]*(e[3]-t[3]),r}function Ea(t,e,n){return n=n||new R(4),n[0]=Math.max(t[0],e[0]),n[1]=Math.max(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n[3]=Math.max(t[3],e[3]),n}function Sa(t,e,n){return n=n||new R(4),n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.min(t[2],e[2]),n[3]=Math.min(t[3],e[3]),n}function Ct(t,e,n){return n=n||new R(4),n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}const Aa=Ct;function Ta(t,e,n){return n=n||new R(4),n[0]=t[0]/e,n[1]=t[1]/e,n[2]=t[2]/e,n[3]=t[3]/e,n}function jn(t,e){return e=e||new R(4),e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}const Ma=jn;function Ca(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ot(t){const e=t[0],n=t[1],r=t[2],s=t[3];return Math.sqrt(e*e+n*n+r*r+s*s)}const Oa=Ot;function Xn(t){const e=t[0],n=t[1],r=t[2],s=t[3];return e*e+n*n+r*r+s*s}const Na=Xn;function Yn(t,e){const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(n*n+r*r+s*s+i*i)}const Ba=Yn;function Wn(t,e){const n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+s*s+i*i}const za=Wn;function Jn(t,e){e=e||new R(4);const n=t[0],r=t[1],s=t[2],i=t[3],o=Math.sqrt(n*n+r*r+s*s+i*i);return o>1e-5?(e[0]=n/o,e[1]=r/o,e[2]=s/o,e[3]=i/o):(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ia(t,e){return e=e||new R(4),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Nt(t,e){return e=e||new R(4),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}const La=Nt;function Kn(t,e,n){return n=n||new R(4),n[0]=t[0]*e[0],n[1]=t[1]*e[1],n[2]=t[2]*e[2],n[3]=t[3]*e[3],n}const Ra=Kn;function Qn(t,e,n){return n=n||new R(4),n[0]=t[0]/e[0],n[1]=t[1]/e[1],n[2]=t[2]/e[2],n[3]=t[3]/e[3],n}const Pa=Qn;function Ua(t){return t=t||new R(4),t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Va(t,e,n){n=n||new R(4);const r=t[0],s=t[1],i=t[2],o=t[3];return n[0]=e[0]*r+e[4]*s+e[8]*i+e[12]*o,n[1]=e[1]*r+e[5]*s+e[9]*i+e[13]*o,n[2]=e[2]*r+e[6]*s+e[10]*i+e[14]*o,n[3]=e[3]*r+e[7]*s+e[11]*i+e[15]*o,n}function $n(t,e,n){return n=n||new R(4),Jn(t,n),Ct(n,e,n)}function Fa(t,e,n){return n=n||new R(4),Ot(t)>e?$n(t,e,n):Nt(t,n)}function Ga(t,e,n){return n=n||new R(4),Hn(t,e,.5,n)}var ve=Object.freeze({__proto__:null,add:ya,addScaled:wa,ceil:_a,clamp:ga,clone:La,copy:Nt,create:qn,dist:Ba,distSq:za,distance:Yn,distanceSq:Wn,div:Pa,divScalar:Ta,divide:Qn,dot:Ca,equals:xa,equalsApproximately:va,floor:pa,fromValues:da,inverse:jn,invert:Ma,len:Oa,lenSq:Na,length:Ot,lengthSq:Xn,lerp:Hn,lerpV:ka,max:Ea,midpoint:Ga,min:Sa,mul:Ra,mulScalar:Ct,multiply:Kn,negate:Ia,normalize:Jn,round:ma,scale:Aa,set:fa,setDefaultType:ha,setLength:$n,sub:ba,subtract:Dn,transformMat4:Va,truncate:Fa,zero:Ua}),Ae=(t=>(t[t.POSITION=0]="POSITION",t[t.NORMAL=1]="NORMAL",t[t.TEXCOORD_0=2]="TEXCOORD_0",t[t.TANGENT=3]="TANGENT",t))(Ae||{});const Zn=`
struct Transformation {
  projectionMatrix: mat4x4f,
  viewMatrix: mat4x4f,
};

@group(0) @binding(0) var<uniform> trf: Transformation;
`,er=`
struct VertexInput {
  @location(${Ae.POSITION}) position: vec4f,
  @location(${Ae.NORMAL}) normal: vec3f,
};

struct VertexOutput {
  @builtin(position) position: vec4f,
  @location(0) normal: vec3f,
};

${Zn}
@group(1) @binding(0) var<uniform> modelMatrix: mat4x4f;

@vertex
fn main(vert: VertexInput) -> VertexOutput {
    var o: VertexOutput;
    o.position = trf.projectionMatrix * trf.viewMatrix * modelMatrix * vert.position;
    o.normal = (modelMatrix * vec4f(vert.normal, 0)).xyz;
    return o;
};

`,tr=`const lightDir = vec3f(0, -1, 0);\r
const lightColor = vec3f(0.5);\r
const ambientColor = vec3f(0.5);\r
\r
@fragment\r
fn main(@location(0) norm: vec3f) -> @location(0) vec4f {\r
  let n = normalize(norm);\r
  let l = normalize(lightDir);\r
  let surfaceColor = ambientColor + lightColor * saturate(dot(n, -l));\r
  return vec4f(surfaceColor, 1.);\r
}`;function qa(t,e){return Math.floor((t+e-1)/e)*e}function Da(t,e,n,r){const s=r??j.create();let i=t[0],o=t[1],a=t[2],u=t[3],l=i+i,d=o+o,h=a+a,p=i*l,y=i*d,x=i*h,b=o*d,g=o*h,E=a*h,k=u*l,A=u*d,C=u*h,O=n[0],L=n[1],D=n[2];return s[0]=(1-(b+E))*O,s[1]=(y+C)*O,s[2]=(x-A)*O,s[3]=0,s[4]=(y-C)*L,s[5]=(1-(p+E))*L,s[6]=(g+k)*L,s[7]=0,s[8]=(x+A)*D,s[9]=(g-k)*D,s[10]=(1-(p+b))*D,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}function Ha(t){if(t.matrix)return j.create(...t.matrix);{let e=t.scale??[1,1,1],n=t.rotation??[0,0,0,1],r=t.translation??[0,0,0];return Da(n,r,e)}}function nr(t,e,n){const r=[],s=Ha(t);return j.mul(e,s,s),r.push({name:t.name,matrix:s,mesh:t.mesh,camera:t.camera}),t.children&&r.push(...t.children.map(i=>nr(n[i],s,n)).flat()),r}const ja=1179937895,Xa=2,Ya=1313821514,Wa=5130562;var rr=(t=>(t[t.POINTS=0]="POINTS",t[t.LINE=1]="LINE",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(rr||{}),Bt=(t=>(t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t))(Bt||{}),sr=(t=>(t[t.BYTE=1]="BYTE",t[t.UNSIGNED_BYTE=1]="UNSIGNED_BYTE",t[t.SHORT=2]="SHORT",t[t.UNSIGNED_SHORT=2]="UNSIGNED_SHORT",t[t.INT=4]="INT",t[t.UNSIGNED_INT=4]="UNSIGNED_INT",t[t.FLOAT=4]="FLOAT",t[t.DOUBLE=8]="DOUBLE",t))(sr||{}),ir=(t=>(t.BYTE="sint8",t.UNSIGNED_BYTE="uint8",t.SHORT="sint16",t.UNSIGNED_SHORT="uint16",t.INT="int32",t.UNSIGNED_INT="uint32",t.FLOAT="float32",t))(ir||{}),zt=(t=>(t[t.SCALAR=1]="SCALAR",t[t.VEC2=2]="VEC2",t[t.VEC3=3]="VEC3",t[t.VEC4=4]="VEC4",t[t.MAT2=4]="MAT2",t[t.MAT3=9]="MAT3",t[t.MAT4=16]="MAT4",t))(zt||{});class Ja{async load(e,n,r){const s=await this.parse(e,n),{bindGroupLayouts:i,format:o,depthFormat:a,record:u}=r;return s.buildInRenderPipeline(e,i,o,a,u),s}async parse(e,n){const r=await(await fetch(n)).arrayBuffer(),s=new Uint32Array(r,0,5);if(s[0]!=ja)throw Error("Provided file is not a gltf file");if(s[1]!=Xa)throw Error("Provided file is not gltf version 2");const i=s[3];if(s[4]!=Ya)throw Error("Invalid glB: The first chunk of the glB file is not a JSON chunk!");const o=JSON.parse(new TextDecoder("utf-8").decode(new Uint8Array(r,5*4,i))),a=new Uint32Array(r,5*4+i,2),u=a[0];if(a[1]!=Wa)throw Error("Invalid glB: The second chunk of the glB file is not a binary chunk!");const l=new tu(r,7*4+i,u),d=o.bufferViews.map(g=>new nu(l,g)),h=o.accessors.map(g=>new ru(d[g.bufferView],g)),p=o.meshes.map(g=>{const E=g.primitives.map(k=>{let A=k.mode;if(A===void 0&&(A=4),!(A in rr))throw new Error(`Unsupported primitive mode ${A}`);const C=k.indices!==void 0&&k.indices<h.length?h[k.indices]:null,O=Object.keys(k.attributes).map(L=>({name:L,shaderLocation:Reflect.get(Ae,L),accessor:h[Reflect.get(k.attributes,L)]})).filter(({shaderLocation:L})=>L!==void 0);return new eu(C,A,O,k)});return new $a(E,g)}),y=o.scenes[o.scene??0],x=y.nodes.map(g=>{const E=o.nodes[g];return nr(E,j.identity(),o.nodes).filter(k=>k.mesh!==void 0).map(k=>new Qa(p[k.mesh],k))}).flat(),b=new Ka(x,p,y);return d.forEach(g=>g.upload(e)),b}}class Ka{constructor(e,n,r){S(this,"renderPipelines",new Map);S(this,"record");S(this,"bindGroupLayout",null);this.a_nodes=e,this.a_meshs=n,Object.assign(this,r)}buildInRenderPipeline(e,n,r,s="depth24plus",i){return this.buildRenderPipeline(e,e.createShaderModule({code:er}),e.createShaderModule({code:tr}),n,r,s,i)}buildRenderPipeline(e,n,r,s,i,o="depth24plus",a){return this.buildRenderOrder(e,n,r,s,i,o,a)}buildRenderOrder(e,n,r,s,i,o="depth24plus",a){this.record=a,this.bindGroupLayout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]});const u=new Map;this.a_nodes.forEach(l=>{const{bindGroup:d}=l.makeNodeBindGroup(e);a&&a.bindGroupCount++;const h={bindGroup:d,groupIndex:s.length};l.a_mesh.primitives.forEach(p=>{const y=JSON.stringify(p),x=u.get(y)??[];x.push(h),u.set(y,x)})}),this.a_meshs.forEach(l=>{l.a_primitives.forEach(d=>{const{gpuBuffers:h,indices:p,pipelineCacheKey:y,vertexCount:x}=d.makeBuffers();let b=this.renderPipelines.get(y);if(!b){const{pipeline:g,create:E}=Za(JSON.parse(y),e,n,r,[...s,this.bindGroupLayout],i,o);b={pipeline:g,primitives:[]},E&&a&&a.pipelineCount++}b.primitives.push({buffers:h,indices:p,vertexCount:x,nodes:u.get(JSON.stringify(d.__primitive))??[]}),this.renderPipelines.set(y,b)})})}render(e,n){this.renderPipelines.forEach(r=>{e.setPipeline(r.pipeline),this.record&&this.record.pipelineSets++,r.primitives.forEach(s=>{s.buffers.forEach(({accessor:a,offset:u},l)=>{this.record&&this.record.bufferSets++,e.setVertexBuffer(l,a.view.gpuBuffer,u,a.byteLength)});const{indices:i,vertexCount:o}=s;i&&(this.record&&this.record.bufferSets++,e.setIndexBuffer(i.view.gpuBuffer,i.vertexType,i.byteOffset,i.byteLength)),s.nodes.forEach(({groupIndex:a,bindGroup:u})=>{this.record&&this.record.bindGroupSets++,e.setBindGroup(a,u),i?e.drawIndexed(i.count):e.draw(o),this.record&&this.record.drawCount++})})})}}class Qa{constructor(e,n){S(this,"name");S(this,"matrix");S(this,"mesh");S(this,"camera");S(this,"bindGroupLayout",null);S(this,"bindGroup",null);this.a_mesh=e,this.name=n.name,this.mesh=n.mesh,this.camera=n.camera,this.matrix=n.matrix}makeNodeBindGroup(e){const n=e.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new Float32Array(n.getMappedRange()).set(this.matrix),n.unmap(),this.bindGroupLayout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),this.bindGroup=e.createBindGroup({layout:this.bindGroupLayout,entries:[{binding:0,resource:{buffer:n}}]}),{bindGroup:this.bindGroup,bindGroupLayout:this.bindGroup}}}class $a{constructor(e,n){this.a_primitives=e,Object.assign(this,n)}}const or=new Map;function Za(t,e,n,r,s,i,o="depth24plus"){const a=JSON.stringify(t);let u=or.get(a);return u?{pipeline:u,create:!1}:(u=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:s}),vertex:{module:n,entryPoint:"main",buffers:t.bufferLayout},fragment:{module:r,entryPoint:"main",targets:[{format:i}]},primitive:{cullMode:"back",...t.primitive},depthStencil:{format:o,depthWriteEnabled:!0,depthCompare:"less"}}),or.set(a,u),{pipeline:u,create:!0})}class eu{constructor(e,n,r,s){S(this,"renderPipeline",null);S(this,"vertexCount",0);S(this,"bufferLayout",[]);S(this,"gpuBuffers",[]);var i;this.a_indices=e,this.topology=n,this.attributeAccessors=r,this.__primitive=s,Object.assign(this,this.__primitive),(i=this.a_indices)==null||i.view.addUsage(GPUBufferUsage.INDEX),this.setupPrimitive()}makeBuffers(){const e={topology:"triangle-list"};this.topology==5&&(e.topology="triangle-strip",this.a_indices&&(e.stripIndexFormat=this.a_indices.vertexType));const n=this.bufferLayout;return{pipelineCacheKey:JSON.stringify({primitive:e,bufferLayout:n}),vertexCount:this.vertexCount,gpuBuffers:this.gpuBuffers,indices:this.a_indices}}setupPrimitive(){const e=new Map,n=new Map;this.attributeAccessors.sort((r,s)=>r.accessor.byteOffset-s.accessor.byteOffset).forEach(({accessor:r,name:s,shaderLocation:i})=>{s=="POSITION"&&(this.vertexCount=r.count),r.view.addUsage(GPUBufferUsage.VERTEX);let o=e.get(r.bufferView),a,u=o&&Math.abs(r.byteOffset-o.attributes[0].offset)>=o.arrayStride;!o||u?(o={arrayStride:r.byteStride,attributes:[]},e.set(u?s:r.bufferView,o),n.set(o,{accessor:r,offset:r.byteOffset})):(a=n.get(o),a.offset=Math.min(a.offset,r.byteOffset)),o.attributes.push({shaderLocation:i,format:r.vertexType,offset:r.byteOffset})});for(const r of e.values()){const s=n.get(r);for(const i of r.attributes)i.offset-=s.offset;r.attributes=r.attributes.sort((i,o)=>i.shaderLocation-o.shaderLocation)}this.bufferLayout=[...e.values()].sort((r,s)=>r.attributes[0].shaderLocation-s.attributes[0].shaderLocation),this.gpuBuffers=this.bufferLayout.map(r=>n.get(r))}}class tu extends Uint8Array{constructor(e,n,r){return super(),new Uint8Array(e,n,r)}}class nu{constructor(e,n){S(this,"viewBuffer");S(this,"usage");S(this,"gpuBuffer",null);Object.assign(this,{byteStride:0,byteOffset:0,...n}),this.viewBuffer=e.subarray(this.byteOffset,this.byteOffset+this.byteLength),this.usage=GPUBufferUsage.COPY_DST}addUsage(e){this.usage=this.usage|e}upload(e){var n;(n=this.gpuBuffer)==null||n.destroy(),this.gpuBuffer=e.createBuffer({size:qa(this.viewBuffer.byteLength,4),usage:this.usage,mappedAtCreation:!0}),Reflect.construct(this.viewBuffer.constructor,[this.gpuBuffer.getMappedRange()]).set(this.viewBuffer),this.gpuBuffer.unmap()}}class ru{constructor(e,n){this.view=e,Object.assign(this,{byteOffset:0,...n})}get byteStride(){const e=Reflect.get(zt,this.type)*Reflect.get(sr,Reflect.get(Bt,this.componentType));return Math.max(e,this.view.byteStride)}get byteLength(){return this.count*this.byteStride}get vertexType(){const e=Reflect.get(ir,Reflect.get(Bt,this.componentType));if(!e)throw Error(`Unrecognized or unsupported glTF type ${this.componentType}`);const n=Reflect.get(zt,this.type);return n>1?`${e}x${n}`:e}}class su{constructor(){S(this,"pipelineCount",0);S(this,"pipelineSets",0);S(this,"bindGroupCount",0);S(this,"bindGroupSets",0);S(this,"bufferSets",0);S(this,"drawCount",0)}}class iu{constructor(e,n,r,s,i){S(this,"invScreen");S(this,"centerTranslation");S(this,"translation");S(this,"rotation");S(this,"camera");S(this,"invCamera");this.eye=e,this.center=n,this.up=r,this.zoomSpeed=s,this.screenDims=i;var o=te.set(e[0],e[1],e[2]),a=te.set(n[0],n[1],n[2]),u=te.set(r[0],r[1],r[2]);te.normalize(u,u);var l=te.sub(a,o),d=te.len(l);te.normalize(l,l);var h=te.cross(l,u);te.normalize(h,h);var p=te.cross(h,l);te.normalize(p,p),te.cross(h,l,p),te.normalize(h,h),this.zoomSpeed=s,this.invScreen=[1/i[0],1/i[1]],this.centerTranslation=j.translation(n),j.inverse(this.centerTranslation,this.centerTranslation);var y=te.set(0,0,-1*d);this.translation=j.translation(y);var x=gn.create(h[0],h[1],h[2],p[0],p[1],p[2],-l[0],-l[1],-l[2]);gn.transpose(x,x),this.rotation=Be.fromMat(x),Be.normalize(this.rotation,this.rotation),this.camera=j.create(),this.invCamera=j.create(),this.updateCameraMatrix()}rotate(e,n){var r=q.set(et(e[0]*2*this.invScreen[0]-1,-1,1),et(1-e[1]*2*this.invScreen[1],-1,1)),s=q.set(et(n[0]*2*this.invScreen[0]-1,-1,1),et(1-n[1]*2*this.invScreen[1],-1,1)),i=ar(r),o=ar(s);this.rotation=Be.mul(this.rotation,i,this.rotation),this.rotation=Be.mul(this.rotation,o,this.rotation),this.updateCameraMatrix()}zoom(e){var n=te.set(0,0,e*this.invScreen[1]*this.zoomSpeed),r=j.translation(n);this.translation=j.mul(this.translation,r,this.translation),this.translation[14]>=-.2&&(this.translation[14]=-.2),this.updateCameraMatrix()}pan(e){var n=ve.set(e[0]*this.invScreen[0]*Math.abs(this.translation[14]),e[1]*this.invScreen[1]*Math.abs(this.translation[14]),0,0),r=ve.transformMat4(n,this.invCamera),s=j.translation(r);this.centerTranslation=j.mul(this.centerTranslation,s,this.centerTranslation),this.updateCameraMatrix()}updateCameraMatrix(){var e=j.fromQuat(this.rotation);this.camera=j.mul(e,this.centerTranslation,this.camera),this.camera=j.mul(this.translation,this.camera,this.camera),this.invCamera=j.invert(this.camera,this.invCamera)}eyePos(){return[this.invCamera[12],this.invCamera[13],this.invCamera[14]]}eyeDir(){var e=ve.set(0,0,-1,0);return e=ve.transformMat4(e,e,this.invCamera),e=ve.normalize(e,e),[e[0],e[1],e[2]]}upDir(){var e=ve.set(0,1,0,0);return e=ve.transformMat4(e,e,this.invCamera),e=ve.normalize(e,e),[e[0],e[1],e[2]]}}function ar(t){const e=q.dot(t,t);if(e<=1)return Be.set(t[0],t[1],Math.sqrt(1-e),0);{const n=q.normalize(t);return Be.set(n[0],n[1],0,0)}}function et(t,e,n){return t<e?e:t>n?n:t}let ou=class{constructor(){S(this,"mousemove",null);S(this,"press",null);S(this,"wheel",null);S(this,"twoFingerDrag",null);S(this,"pinch",null)}registerForCanvas(t){let e;t.addEventListener("mousemove",s=>{s.preventDefault();const i=t.getBoundingClientRect(),o=[s.clientX-i.left,s.clientY-i.top];e?this.mousemove&&this.mousemove(e,o,s):e=[s.clientX-i.left,s.clientY-i.top],e=o}),t.addEventListener("mousedown",s=>{s.preventDefault();let i=t.getBoundingClientRect(),o=[s.clientX-i.left,s.clientY-i.top];this.press&&this.press(o,s)}),t.addEventListener("wheel",s=>{s.preventDefault(),this.wheel&&this.wheel(-s.deltaY)}),t.oncontextmenu=function(s){s.preventDefault()};const n={};t.addEventListener("touchstart",s=>{const i=t.getBoundingClientRect();s.preventDefault();for(let o=0;o<s.changedTouches.length;++o){const a=s.changedTouches[o];n[a.identifier]=[a.clientX-i.left,a.clientY-i.top],s.changedTouches.length==1&&this.press&&this.press(n[a.identifier],s)}}),t.addEventListener("touchmove",s=>{s.preventDefault();const i=t.getBoundingClientRect();if(Object.keys(n).length==1){if(this.mousemove){const o=s.changedTouches[0],a=n[o.identifier],u=[o.clientX-i.left,o.clientY-i.top];s.buttons=1,this.mousemove(a,u,s)}}else{const o={};for(let b=0;b<s.changedTouches.length;++b){let g=s.changedTouches[b];o[g.identifier]=[g.clientX-i.left,g.clientY-i.top]}let a=[];for(const b in n)b in o||(o[b]=n[b]),a.push(n[b]);let u=[];for(const b in o)u.push(o[b]);let l=[q.set(u[0][0]-a[0][0],u[0][1]-a[0][1]),q.set(u[1][0]-a[1][0],u[1][1]-a[1][1])],d=[q.create(),q.create()];q.normalize(d[0],l[0]),q.normalize(d[1],l[1]);let h=q.set(a[1][0]-a[0][0],a[1][1]-a[0][1]);q.normalize(h,h);let p=q.lerp(l[0],l[1],.5);q.normalize(p,p);let y=[q.dot(h,d[0]),q.dot(h,d[1])],x=[q.dot(p,d[0]),q.dot(p,d[1])];if(this.pinch&&Math.abs(y[0])>.5&&Math.abs(y[1])>.5&&Math.sign(y[0])!=Math.sign(y[1])){let b=q.distance(a[0],a[1]),g=q.distance(u[0],u[1]);this.pinch(g-b)}else if(this.twoFingerDrag&&Math.abs(x[0])>.5&&Math.abs(x[1])>.5&&Math.sign(x[0])==Math.sign(x[1])){let b=q.lerp(l[0],l[1],.5);b[1]=-b[1],this.twoFingerDrag(b)}}for(let o=0;o<s.changedTouches.length;++o){let a=s.changedTouches[o];n[a.identifier]=[a.clientX-i.left,a.clientY-i.top]}});let r=function(s){s.preventDefault();for(let i=0;i<s.changedTouches.length;++i){let o=s.changedTouches[i];delete n[o.identifier]}};t.addEventListener("touchcancel",r),t.addEventListener("touchend",r)}};const It=(t,e)=>((t+e-1)/e|0)*e;function au(t){return Object.keys(t)}function uu(t,e){return new Array(t).fill(0).map((n,r)=>e(r))}const ur=t=>t&&typeof t.length=="number"&&t.buffer instanceof ArrayBuffer&&typeof t.byteLength=="number",N={i32:{numElements:1,align:4,size:4,type:"i32",View:Int32Array},u32:{numElements:1,align:4,size:4,type:"u32",View:Uint32Array},f32:{numElements:1,align:4,size:4,type:"f32",View:Float32Array},f16:{numElements:1,align:2,size:2,type:"u16",View:Uint16Array},vec2f:{numElements:2,align:8,size:8,type:"f32",View:Float32Array},vec2i:{numElements:2,align:8,size:8,type:"i32",View:Int32Array},vec2u:{numElements:2,align:8,size:8,type:"u32",View:Uint32Array},vec2h:{numElements:2,align:4,size:4,type:"u16",View:Uint16Array},vec3i:{numElements:3,align:16,size:12,type:"i32",View:Int32Array},vec3u:{numElements:3,align:16,size:12,type:"u32",View:Uint32Array},vec3f:{numElements:3,align:16,size:12,type:"f32",View:Float32Array},vec3h:{numElements:3,align:8,size:6,type:"u16",View:Uint16Array},vec4i:{numElements:4,align:16,size:16,type:"i32",View:Int32Array},vec4u:{numElements:4,align:16,size:16,type:"u32",View:Uint32Array},vec4f:{numElements:4,align:16,size:16,type:"f32",View:Float32Array},vec4h:{numElements:4,align:8,size:8,type:"u16",View:Uint16Array},mat2x2f:{numElements:4,align:8,size:16,type:"f32",View:Float32Array},mat2x2h:{numElements:4,align:4,size:8,type:"u16",View:Uint16Array},mat3x2f:{numElements:6,align:8,size:24,type:"f32",View:Float32Array},mat3x2h:{numElements:6,align:4,size:12,type:"u16",View:Uint16Array},mat4x2f:{numElements:8,align:8,size:32,type:"f32",View:Float32Array},mat4x2h:{numElements:8,align:4,size:16,type:"u16",View:Uint16Array},mat2x3f:{numElements:8,align:16,size:32,pad:[3,1],type:"f32",View:Float32Array},mat2x3h:{numElements:8,align:8,size:16,pad:[3,1],type:"u16",View:Uint16Array},mat3x3f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x3h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x3f:{numElements:16,align:16,size:64,pad:[3,1],type:"f32",View:Float32Array},mat4x3h:{numElements:16,align:8,size:32,pad:[3,1],type:"u16",View:Uint16Array},mat2x4f:{numElements:8,align:16,size:32,type:"f32",View:Float32Array},mat2x4h:{numElements:8,align:8,size:16,type:"u16",View:Uint16Array},mat3x4f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x4h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x4f:{numElements:16,align:16,size:64,type:"f32",View:Float32Array},mat4x4h:{numElements:16,align:8,size:32,type:"u16",View:Uint16Array},bool:{numElements:0,align:1,size:0,type:"bool",View:Uint32Array}},ze={...N,"atomic<i32>":N.i32,"atomic<u32>":N.u32,"vec2<i32>":N.vec2i,"vec2<u32>":N.vec2u,"vec2<f32>":N.vec2f,"vec2<f16>":N.vec2h,"vec3<i32>":N.vec3i,"vec3<u32>":N.vec3u,"vec3<f32>":N.vec3f,"vec3<f16>":N.vec3h,"vec4<i32>":N.vec4i,"vec4<u32>":N.vec4u,"vec4<f32>":N.vec4f,"vec4<f16>":N.vec4h,"mat2x2<f32>":N.mat2x2f,"mat2x2<f16>":N.mat2x2h,"mat3x2<f32>":N.mat3x2f,"mat3x2<f16>":N.mat3x2h,"mat4x2<f32>":N.mat4x2f,"mat4x2<f16>":N.mat4x2h,"mat2x3<f32>":N.mat2x3f,"mat2x3<f16>":N.mat2x3h,"mat3x3<f32>":N.mat3x3f,"mat3x3<f16>":N.mat3x3h,"mat4x3<f32>":N.mat4x3f,"mat4x3<f16>":N.mat4x3h,"mat2x4<f32>":N.mat2x4f,"mat2x4<f16>":N.mat2x4h,"mat3x4<f32>":N.mat3x4f,"mat3x4<f16>":N.mat3x4h,"mat4x4<f32>":N.mat4x4f,"mat4x4<f16>":N.mat4x4h},cu=au(ze);function lu(t=[],e){const n=new Set;for(const r of cu){const s=ze[r];n.has(s)||(n.add(s),s.flatten=t.includes(r)?e:!e)}}lu();function hu(t){const e=t;if(e.elementType)return e.size;{const n=t,r=e.numElements||1;if(n.fields)return t.size*r;{const s=t,{align:i}=ze[s.type];return r>1?It(t.size,i)*r:t.size}}}function cr(t,e,n,r){const{size:s,type:i}=t;try{const{View:o,align:a}=ze[i],u=r!==void 0,l=u?It(s,a):s,d=l/o.BYTES_PER_ELEMENT,h=u?r===0?(e.byteLength-n)/l:r:1;return new o(e,n,d*h)}catch{throw new Error(`unknown type: ${i}`)}}function du(t){return!t.fields&&!t.elementType}function fu(t,e,n){const r=n||0,s=e||new ArrayBuffer(hu(t)),i=(o,a)=>{const u=o,l=u.elementType;if(l){if(du(l)&&ze[l.type].flatten)return cr(l,s,a,u.numElements);{const{size:d}=lr(o),h=u.numElements===0?(s.byteLength-a)/d:u.numElements;return uu(h,p=>i(l,a+d*p))}}else{if(typeof o=="string")throw Error("unreachable");{const d=o.fields;if(d){const h={};for(const[p,{type:y,offset:x}]of Object.entries(d))h[p]=i(y,a+x);return h}else return cr(o,s,a)}}};return{views:i(t,r),arrayBuffer:s}}function Lt(t,e){if(t!==void 0)if(ur(e)){const n=e;if(n.length===1&&typeof t=="number")n[0]=t;else if(Array.isArray(t[0])||ur(t[0])){const r=t[0].length,s=r===3?4:r;for(let i=0;i<t.length;++i){const o=i*s;n.set(t[i],o)}}else n.set(t)}else if(Array.isArray(e)){const n=e;t.forEach((r,s)=>{Lt(r,n[s])})}else{const n=e;for(const[r,s]of Object.entries(t)){const i=n[r];i&&Lt(s,i)}}}function _u(t,e,n=0){const r=t,s=r.group===void 0?t:r.typeDefinition,i=fu(s,e,n);return{...i,set(o){Lt(o,i.views)}}}function Rt(t){const e=t.elementType;if(e)return Rt(e);const n=t.fields;if(n)return Object.values(n).reduce((i,{type:o})=>Math.max(i,Rt(o)),0);const{type:r}=t,{align:s}=ze[r];return s}function lr(t){const e=t.elementType;if(e){const r=e.size,s=Rt(e);return{unalignedSize:r,align:s,size:It(r,s)}}const n=t.fields;if(n){const r=Object.values(n).pop();if(r.type.size===0)return lr(r.type)}return{size:0,unalignedSize:0,align:1}}class pu{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class we{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(tt.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(nt.instance)}}}class tt extends we{}tt.instance=new tt;class nt extends we{}nt.instance=new nt;class G extends we{constructor(){super()}}let Pt=class extends G{constructor(t,e,n,r){super(),this.name=t,this.args=e,this.returnType=n,this.body=r}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}};class mu extends G{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class gu extends G{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class yu extends G{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class wu extends G{constructor(e,n,r,s){super(),this.init=e,this.condition=n,this.increment=r,this.body=s}get astNodeType(){return"for"}search(e){var n,r,s;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class Te extends G{constructor(e,n,r,s,i){super(),this.name=e,this.type=n,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class hr extends G{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Ut extends G{constructor(e,n,r,s,i){super(),this.name=e,this.type=n,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"let"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class dr extends G{constructor(e,n,r,s,i){super(),this.name=e,this.type=n,this.storage=r,this.access=s,this.value=i}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}var Ie;(function(t){t.increment="++",t.decrement="--"})(Ie||(Ie={})),function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e}(Ie||(Ie={}));class bu extends G{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var qe;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(qe||(qe={})),function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e}(qe||(qe={}));class vu extends G{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.value.search(e)}}class xu extends G{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}}class ku extends G{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class Eu extends G{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class Su extends G{constructor(e,n,r,s){super(),this.condition=e,this.body=n,this.elseif=r,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Au extends G{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Tu extends G{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class fr extends G{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class Mu extends G{constructor(){super()}get astNodeType(){return"discard"}}class Cu extends G{constructor(){super()}get astNodeType(){return"break"}}class Ou extends G{constructor(){super()}get astNodeType(){return"continue"}}class Me extends G{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Ce extends Me{constructor(e,n){super(e),this.members=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class _r extends Me{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class Nu extends Me{constructor(e,n,r,s){super(e),this.storage=n,this.type=r,this.access=s}get astNodeType(){return"pointer"}}class pr extends Me{constructor(e,n,r,s){super(e),this.attributes=n,this.format=r,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class De extends Me{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class pe extends we{constructor(){super()}}class mr extends pe{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class He extends pe{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}}class gr extends pe{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class yr extends pe{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this)}}class wr extends pe{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof He){const s=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),i=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(i),a=o==null?void 0:o.getMemberIndex(s);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class br extends pe{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Bu extends pe{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class zu extends pe{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class vr extends pe{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class xr extends pe{constructor(){super()}}class Iu extends xr{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class me extends xr{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class kr extends we{constructor(){super()}}class Lu extends kr{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Ru extends kr{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Pu extends we{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class Uu extends we{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Vu extends we{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class Er extends we{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}var w,f;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(f||(f={}));class _{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class c{}w=c,c.none=new _("",f.reserved,""),c.eof=new _("EOF",f.token,""),c.reserved={asm:new _("asm",f.reserved,"asm"),bf16:new _("bf16",f.reserved,"bf16"),do:new _("do",f.reserved,"do"),enum:new _("enum",f.reserved,"enum"),f16:new _("f16",f.reserved,"f16"),f64:new _("f64",f.reserved,"f64"),handle:new _("handle",f.reserved,"handle"),i8:new _("i8",f.reserved,"i8"),i16:new _("i16",f.reserved,"i16"),i64:new _("i64",f.reserved,"i64"),mat:new _("mat",f.reserved,"mat"),premerge:new _("premerge",f.reserved,"premerge"),regardless:new _("regardless",f.reserved,"regardless"),typedef:new _("typedef",f.reserved,"typedef"),u8:new _("u8",f.reserved,"u8"),u16:new _("u16",f.reserved,"u16"),u64:new _("u64",f.reserved,"u64"),unless:new _("unless",f.reserved,"unless"),using:new _("using",f.reserved,"using"),vec:new _("vec",f.reserved,"vec"),void:new _("void",f.reserved,"void")},c.keywords={array:new _("array",f.keyword,"array"),atomic:new _("atomic",f.keyword,"atomic"),bool:new _("bool",f.keyword,"bool"),f32:new _("f32",f.keyword,"f32"),i32:new _("i32",f.keyword,"i32"),mat2x2:new _("mat2x2",f.keyword,"mat2x2"),mat2x3:new _("mat2x3",f.keyword,"mat2x3"),mat2x4:new _("mat2x4",f.keyword,"mat2x4"),mat3x2:new _("mat3x2",f.keyword,"mat3x2"),mat3x3:new _("mat3x3",f.keyword,"mat3x3"),mat3x4:new _("mat3x4",f.keyword,"mat3x4"),mat4x2:new _("mat4x2",f.keyword,"mat4x2"),mat4x3:new _("mat4x3",f.keyword,"mat4x3"),mat4x4:new _("mat4x4",f.keyword,"mat4x4"),ptr:new _("ptr",f.keyword,"ptr"),sampler:new _("sampler",f.keyword,"sampler"),sampler_comparison:new _("sampler_comparison",f.keyword,"sampler_comparison"),struct:new _("struct",f.keyword,"struct"),texture_1d:new _("texture_1d",f.keyword,"texture_1d"),texture_2d:new _("texture_2d",f.keyword,"texture_2d"),texture_2d_array:new _("texture_2d_array",f.keyword,"texture_2d_array"),texture_3d:new _("texture_3d",f.keyword,"texture_3d"),texture_cube:new _("texture_cube",f.keyword,"texture_cube"),texture_cube_array:new _("texture_cube_array",f.keyword,"texture_cube_array"),texture_multisampled_2d:new _("texture_multisampled_2d",f.keyword,"texture_multisampled_2d"),texture_storage_1d:new _("texture_storage_1d",f.keyword,"texture_storage_1d"),texture_storage_2d:new _("texture_storage_2d",f.keyword,"texture_storage_2d"),texture_storage_2d_array:new _("texture_storage_2d_array",f.keyword,"texture_storage_2d_array"),texture_storage_3d:new _("texture_storage_3d",f.keyword,"texture_storage_3d"),texture_depth_2d:new _("texture_depth_2d",f.keyword,"texture_depth_2d"),texture_depth_2d_array:new _("texture_depth_2d_array",f.keyword,"texture_depth_2d_array"),texture_depth_cube:new _("texture_depth_cube",f.keyword,"texture_depth_cube"),texture_depth_cube_array:new _("texture_depth_cube_array",f.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new _("texture_depth_multisampled_2d",f.keyword,"texture_depth_multisampled_2d"),texture_external:new _("texture_external",f.keyword,"texture_external"),u32:new _("u32",f.keyword,"u32"),vec2:new _("vec2",f.keyword,"vec2"),vec3:new _("vec3",f.keyword,"vec3"),vec4:new _("vec4",f.keyword,"vec4"),bitcast:new _("bitcast",f.keyword,"bitcast"),block:new _("block",f.keyword,"block"),break:new _("break",f.keyword,"break"),case:new _("case",f.keyword,"case"),continue:new _("continue",f.keyword,"continue"),continuing:new _("continuing",f.keyword,"continuing"),default:new _("default",f.keyword,"default"),discard:new _("discard",f.keyword,"discard"),else:new _("else",f.keyword,"else"),enable:new _("enable",f.keyword,"enable"),fallthrough:new _("fallthrough",f.keyword,"fallthrough"),false:new _("false",f.keyword,"false"),fn:new _("fn",f.keyword,"fn"),for:new _("for",f.keyword,"for"),function:new _("function",f.keyword,"function"),if:new _("if",f.keyword,"if"),let:new _("let",f.keyword,"let"),const:new _("const",f.keyword,"const"),loop:new _("loop",f.keyword,"loop"),while:new _("while",f.keyword,"while"),private:new _("private",f.keyword,"private"),read:new _("read",f.keyword,"read"),read_write:new _("read_write",f.keyword,"read_write"),return:new _("return",f.keyword,"return"),storage:new _("storage",f.keyword,"storage"),switch:new _("switch",f.keyword,"switch"),true:new _("true",f.keyword,"true"),alias:new _("alias",f.keyword,"alias"),type:new _("type",f.keyword,"type"),uniform:new _("uniform",f.keyword,"uniform"),var:new _("var",f.keyword,"var"),override:new _("override",f.keyword,"override"),workgroup:new _("workgroup",f.keyword,"workgroup"),write:new _("write",f.keyword,"write"),r8unorm:new _("r8unorm",f.keyword,"r8unorm"),r8snorm:new _("r8snorm",f.keyword,"r8snorm"),r8uint:new _("r8uint",f.keyword,"r8uint"),r8sint:new _("r8sint",f.keyword,"r8sint"),r16uint:new _("r16uint",f.keyword,"r16uint"),r16sint:new _("r16sint",f.keyword,"r16sint"),r16float:new _("r16float",f.keyword,"r16float"),rg8unorm:new _("rg8unorm",f.keyword,"rg8unorm"),rg8snorm:new _("rg8snorm",f.keyword,"rg8snorm"),rg8uint:new _("rg8uint",f.keyword,"rg8uint"),rg8sint:new _("rg8sint",f.keyword,"rg8sint"),r32uint:new _("r32uint",f.keyword,"r32uint"),r32sint:new _("r32sint",f.keyword,"r32sint"),r32float:new _("r32float",f.keyword,"r32float"),rg16uint:new _("rg16uint",f.keyword,"rg16uint"),rg16sint:new _("rg16sint",f.keyword,"rg16sint"),rg16float:new _("rg16float",f.keyword,"rg16float"),rgba8unorm:new _("rgba8unorm",f.keyword,"rgba8unorm"),rgba8unorm_srgb:new _("rgba8unorm_srgb",f.keyword,"rgba8unorm_srgb"),rgba8snorm:new _("rgba8snorm",f.keyword,"rgba8snorm"),rgba8uint:new _("rgba8uint",f.keyword,"rgba8uint"),rgba8sint:new _("rgba8sint",f.keyword,"rgba8sint"),bgra8unorm:new _("bgra8unorm",f.keyword,"bgra8unorm"),bgra8unorm_srgb:new _("bgra8unorm_srgb",f.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new _("rgb10a2unorm",f.keyword,"rgb10a2unorm"),rg11b10float:new _("rg11b10float",f.keyword,"rg11b10float"),rg32uint:new _("rg32uint",f.keyword,"rg32uint"),rg32sint:new _("rg32sint",f.keyword,"rg32sint"),rg32float:new _("rg32float",f.keyword,"rg32float"),rgba16uint:new _("rgba16uint",f.keyword,"rgba16uint"),rgba16sint:new _("rgba16sint",f.keyword,"rgba16sint"),rgba16float:new _("rgba16float",f.keyword,"rgba16float"),rgba32uint:new _("rgba32uint",f.keyword,"rgba32uint"),rgba32sint:new _("rgba32sint",f.keyword,"rgba32sint"),rgba32float:new _("rgba32float",f.keyword,"rgba32float"),static_assert:new _("static_assert",f.keyword,"static_assert")},c.tokens={decimal_float_literal:new _("decimal_float_literal",f.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new _("hex_float_literal",f.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new _("int_literal",f.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new _("uint_literal",f.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new _("ident",f.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new _("and",f.token,"&"),and_and:new _("and_and",f.token,"&&"),arrow:new _("arrow ",f.token,"->"),attr:new _("attr",f.token,"@"),attr_left:new _("attr_left",f.token,"[["),attr_right:new _("attr_right",f.token,"]]"),forward_slash:new _("forward_slash",f.token,"/"),bang:new _("bang",f.token,"!"),bracket_left:new _("bracket_left",f.token,"["),bracket_right:new _("bracket_right",f.token,"]"),brace_left:new _("brace_left",f.token,"{"),brace_right:new _("brace_right",f.token,"}"),colon:new _("colon",f.token,":"),comma:new _("comma",f.token,","),equal:new _("equal",f.token,"="),equal_equal:new _("equal_equal",f.token,"=="),not_equal:new _("not_equal",f.token,"!="),greater_than:new _("greater_than",f.token,">"),greater_than_equal:new _("greater_than_equal",f.token,">="),shift_right:new _("shift_right",f.token,">>"),less_than:new _("less_than",f.token,"<"),less_than_equal:new _("less_than_equal",f.token,"<="),shift_left:new _("shift_left",f.token,"<<"),modulo:new _("modulo",f.token,"%"),minus:new _("minus",f.token,"-"),minus_minus:new _("minus_minus",f.token,"--"),period:new _("period",f.token,"."),plus:new _("plus",f.token,"+"),plus_plus:new _("plus_plus",f.token,"++"),or:new _("or",f.token,"|"),or_or:new _("or_or",f.token,"||"),paren_left:new _("paren_left",f.token,"("),paren_right:new _("paren_right",f.token,")"),semicolon:new _("semicolon",f.token,";"),star:new _("star",f.token,"*"),tilde:new _("tilde",f.token,"~"),underscore:new _("underscore",f.token,"_"),xor:new _("xor",f.token,"^"),plus_equal:new _("plus_equal",f.token,"+="),minus_equal:new _("minus_equal",f.token,"-="),times_equal:new _("times_equal",f.token,"*="),division_equal:new _("division_equal",f.token,"/="),modulo_equal:new _("modulo_equal",f.token,"%="),and_equal:new _("and_equal",f.token,"&="),or_equal:new _("or_equal",f.token,"|="),xor_equal:new _("xor_equal",f.token,"^="),shift_right_equal:new _("shift_right_equal",f.token,">>="),shift_left_equal:new _("shift_left_equal",f.token,"<<=")},c.storage_class=[w.keywords.function,w.keywords.private,w.keywords.workgroup,w.keywords.uniform,w.keywords.storage],c.access_mode=[w.keywords.read,w.keywords.write,w.keywords.read_write],c.sampler_type=[w.keywords.sampler,w.keywords.sampler_comparison],c.sampled_texture_type=[w.keywords.texture_1d,w.keywords.texture_2d,w.keywords.texture_2d_array,w.keywords.texture_3d,w.keywords.texture_cube,w.keywords.texture_cube_array],c.multisampled_texture_type=[w.keywords.texture_multisampled_2d],c.storage_texture_type=[w.keywords.texture_storage_1d,w.keywords.texture_storage_2d,w.keywords.texture_storage_2d_array,w.keywords.texture_storage_3d],c.depth_texture_type=[w.keywords.texture_depth_2d,w.keywords.texture_depth_2d_array,w.keywords.texture_depth_cube,w.keywords.texture_depth_cube_array,w.keywords.texture_depth_multisampled_2d],c.texture_external_type=[w.keywords.texture_external],c.any_texture_type=[...w.sampled_texture_type,...w.multisampled_texture_type,...w.storage_texture_type,...w.depth_texture_type,...w.texture_external_type],c.texel_format=[w.keywords.r8unorm,w.keywords.r8snorm,w.keywords.r8uint,w.keywords.r8sint,w.keywords.r16uint,w.keywords.r16sint,w.keywords.r16float,w.keywords.rg8unorm,w.keywords.rg8snorm,w.keywords.rg8uint,w.keywords.rg8sint,w.keywords.r32uint,w.keywords.r32sint,w.keywords.r32float,w.keywords.rg16uint,w.keywords.rg16sint,w.keywords.rg16float,w.keywords.rgba8unorm,w.keywords.rgba8unorm_srgb,w.keywords.rgba8snorm,w.keywords.rgba8uint,w.keywords.rgba8sint,w.keywords.bgra8unorm,w.keywords.bgra8unorm_srgb,w.keywords.rgb10a2unorm,w.keywords.rg11b10float,w.keywords.rg32uint,w.keywords.rg32sint,w.keywords.rg32float,w.keywords.rgba16uint,w.keywords.rgba16sint,w.keywords.rgba16float,w.keywords.rgba32uint,w.keywords.rgba32sint,w.keywords.rgba32float],c.const_literal=[w.tokens.int_literal,w.tokens.uint_literal,w.tokens.decimal_float_literal,w.tokens.hex_float_literal,w.keywords.true,w.keywords.false],c.literal_or_ident=[w.tokens.ident,w.tokens.int_literal,w.tokens.uint_literal,w.tokens.decimal_float_literal,w.tokens.hex_float_literal],c.element_count_expression=[w.tokens.int_literal,w.tokens.uint_literal,w.tokens.ident],c.template_types=[w.keywords.vec2,w.keywords.vec3,w.keywords.vec4,w.keywords.mat2x2,w.keywords.mat2x3,w.keywords.mat2x4,w.keywords.mat3x2,w.keywords.mat3x3,w.keywords.mat3x4,w.keywords.mat4x2,w.keywords.mat4x3,w.keywords.mat4x4,w.keywords.atomic,w.keywords.bitcast,...w.any_texture_type],c.attribute_name=[w.tokens.ident,w.keywords.block],c.assignment_operators=[w.tokens.equal,w.tokens.plus_equal,w.tokens.minus_equal,w.tokens.times_equal,w.tokens.division_equal,w.tokens.modulo_equal,w.tokens.and_equal,w.tokens.or_equal,w.tokens.xor_equal,w.tokens.shift_right_equal,w.tokens.shift_left_equal],c.increment_operators=[w.tokens.plus_plus,w.tokens.minus_minus];class Sr{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return c.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==c.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Fu{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Sr(c.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let r=1;for(;r>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),r--,r==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),r++)}return!0}}let n=c.none;for(;;){let r=this._findType(e);const s=this._peekAhead();if(e==">"&&(s==">"||s=="=")){let i=!1,o=this._tokens.length-1;for(let a=0;a<5&&o>=0;++a,--o)if(this._tokens[o].type===c.tokens.less_than){o>0&&this._tokens[o-1].isArrayOrTemplateType()&&(i=!0);break}if(i)return this._addToken(r),!0}if(r===c.none){let i=e,o=0;const a=2;for(let u=0;u<a;++u)if(i+=this._peekAhead(u),r=this._findType(i),r!==c.none){o=u;break}if(r===c.none)return n===c.none?!1:(this._current--,this._addToken(n),!0);e=i,this._current+=o+1}if(n=r,this._isAtEnd())break;e+=this._advance()}return n===c.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in c.keywords){const r=c.keywords[n];if(this._match(e,r.rule))return r}for(const n in c.tokens){const r=c.tokens[n];if(this._match(e,r.rule))return r}return c.none}_match(e,n){if(typeof n=="string"){if(n==e)return!0}else{const r=n.exec(e);if(r&&r.index==0&&r[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Sr(e,n,this._line))}}class Gu{constructor(){this._tokens=[],this._current=0,this._context=new pu}parse(e){this._initialize(e);let n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new Fu(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return console.error(e,n),{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==c.eof}_match(e){if(e instanceof _)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const s=e[n];if(this._check(s))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){let r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(c.tokens.semicolon)&&!this._isAtEnd(););if(this._match(c.keywords.alias)){const n=this._type_alias();return this._consume(c.tokens.semicolon,"Expected ';'"),n}if(this._match(c.keywords.enable)){const n=this._enable_directive();return this._consume(c.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(c.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(c.tokens.semicolon,"Expected ';'."),n}if(this._check(c.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(c.tokens.semicolon,"Expected ';'."),n}if(this._check(c.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(c.tokens.semicolon,"Expected ';'."),n}if(this._check(c.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(c.tokens.semicolon,"Expected ';'."),n}if(this._check(c.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(c.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(c.keywords.fn))return null;const e=this._consume(c.tokens.ident,"Expected function name.").toString();this._consume(c.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(c.tokens.paren_right))do{if(this._check(c.tokens.paren_right))break;const i=this._attribute(),o=this._consume(c.tokens.ident,"Expected argument name.").toString();this._consume(c.tokens.colon,"Expected ':' for argument type.");const a=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=a,n.push(new Pu(o,u,i)))}while(this._match(c.tokens.comma));this._consume(c.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(c.tokens.arrow)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}const s=this._compound_statement();return new Pt(e,n,r,s)}_compound_statement(){const e=[];for(this._consume(c.tokens.brace_left,"Expected '{' for block.");!this._check(c.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(c.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(c.tokens.semicolon)&&!this._isAtEnd(););if(this._check(c.keywords.if))return this._if_statement();if(this._check(c.keywords.switch))return this._switch_statement();if(this._check(c.keywords.loop))return this._loop_statement();if(this._check(c.keywords.for))return this._for_statement();if(this._check(c.keywords.while))return this._while_statement();if(this._check(c.keywords.continuing))return this._continuing_statement();if(this._check(c.keywords.static_assert))return this._static_assert_statement();if(this._check(c.tokens.brace_left))return this._compound_statement();let e=null;return this._check(c.keywords.return)?e=this._return_statement():this._check([c.keywords.var,c.keywords.let,c.keywords.const])?e=this._variable_statement():this._match(c.keywords.discard)?e=new Mu:this._match(c.keywords.break)?e=new Cu:this._match(c.keywords.continue)?e=new Ou:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(c.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(c.keywords.static_assert))return null;let e=this._optional_paren_expression();return new mu(e)}_while_statement(){if(!this._match(c.keywords.while))return null;let e=this._optional_paren_expression();const n=this._compound_statement();return new gu(e,n)}_continuing_statement(){if(!this._match(c.keywords.continuing))return null;const e=this._compound_statement();return new yu(e)}_for_statement(){if(!this._match(c.keywords.for))return null;this._consume(c.tokens.paren_left,"Expected '('.");const e=this._check(c.tokens.semicolon)?null:this._for_init();this._consume(c.tokens.semicolon,"Expected ';'.");const n=this._check(c.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(c.tokens.semicolon,"Expected ';'.");const r=this._check(c.tokens.paren_right)?null:this._for_increment();this._consume(c.tokens.paren_right,"Expected ')'.");const s=this._compound_statement();return new wu(e,n,r,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(c.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(c.tokens.equal)&&(n=this._short_circuit_or_expression()),new Te(e.name,e.type,e.storage,e.access,n)}if(this._match(c.keywords.let)){const e=this._consume(c.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(c.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(c.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Ut(e,n,null,null,r)}if(this._match(c.keywords.const)){const e=this._consume(c.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(c.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(c.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new dr(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(c.increment_operators))return this._current=e,null;const r=this._consume(c.increment_operators,"Expected increment operator");return new bu(r.type===c.tokens.plus_plus?Ie.increment:Ie.decrement,n)}_assignment_statement(){let e=null;if(this._check(c.tokens.brace_right))return null;let n=this._match(c.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(c.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new vu(qe.parse(r.lexeme),e,s)}_func_call_statement(){if(!this._check(c.tokens.ident))return null;const e=this._current,n=this._consume(c.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new xu(n.lexeme,r)}_loop_statement(){if(!this._match(c.keywords.loop))return null;this._consume(c.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let s of n)e.push(s);else e.push(n);n=this._statement()}let r=null;return this._match(c.keywords.continuing)&&(r=this._compound_statement()),this._consume(c.tokens.brace_right,"Expected '}' for loop."),new ku(e,r)}_switch_statement(){if(!this._match(c.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(c.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(c.tokens.brace_right,"Expected '}' for switch."),new Eu(e,n)}_switch_body(){const e=[];if(this._match(c.keywords.case)){const n=this._case_selectors();this._match(c.tokens.colon),this._consume(c.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(c.tokens.brace_right,"Exected '}' for switch case."),e.push(new Lu(n,r))}if(this._match(c.keywords.default)){this._match(c.tokens.colon),this._consume(c.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(c.tokens.brace_right,"Exected '}' for switch default."),e.push(new Ru(n))}if(this._check([c.keywords.default,c.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){var e,n,r,s;const i=[(n=(e=this._shift_expression())===null||e===void 0?void 0:e.evaluate(this._context).toString())!==null&&n!==void 0?n:""];for(;this._match(c.tokens.comma);)i.push((s=(r=this._shift_expression())===null||r===void 0?void 0:r.evaluate(this._context).toString())!==null&&s!==void 0?s:"");return i}_case_body(){if(this._match(c.keywords.fallthrough))return this._consume(c.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(c.keywords.if))return null;const e=this._optional_paren_expression(),n=this._compound_statement();let r=[];this._match_elseif()&&(r=this._elseif_statement(r));let s=null;return this._match(c.keywords.else)&&(s=this._compound_statement()),new Su(e,n,r,s)}_match_elseif(){return this._tokens[this._current].type===c.keywords.else&&this._tokens[this._current+1].type===c.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new Uu(n,r)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(c.keywords.return))return null;const e=this._short_circuit_or_expression();return new Au(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(c.tokens.or_or);)e=new me(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(c.tokens.and_and);)e=new me(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(c.tokens.or);)e=new me(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(c.tokens.xor);)e=new me(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(c.tokens.and);)e=new me(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([c.tokens.equal_equal,c.tokens.not_equal])?new me(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([c.tokens.less_than,c.tokens.greater_than,c.tokens.less_than_equal,c.tokens.greater_than_equal]);)e=new me(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([c.tokens.shift_left,c.tokens.shift_right]);)e=new me(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([c.tokens.plus,c.tokens.minus]);)e=new me(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([c.tokens.star,c.tokens.forward_slash,c.tokens.modulo]);)e=new me(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([c.tokens.minus,c.tokens.bang,c.tokens.tilde,c.tokens.star,c.tokens.and])?new Iu(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(c.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(c.tokens.bracket_right,"Expected ']'.");const n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(c.tokens.period)){const e=this._consume(c.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new mr(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(c.tokens.ident)){const r=this._previous().toString();if(this._check(c.tokens.paren_left)){const s=this._argument_expression_list(),i=this._getStruct(r);return i!=null?new He(i,s):new gr(r,s)}if(this._context.constants.has(r)){const s=this._context.constants.get(r);return new wr(r,s.value)}return new yr(r)}if(this._match(c.const_literal))return new br(parseFloat(this._previous().toString()));if(this._check(c.tokens.paren_left))return this._paren_expression();if(this._match(c.keywords.bitcast)){this._consume(c.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(c.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return new Bu(r,s)}const e=this._type_decl(),n=this._argument_expression_list();return new zu(e,n)}_argument_expression_list(){if(!this._match(c.tokens.paren_left))return null;const e=[];do{if(this._check(c.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(c.tokens.comma));return this._consume(c.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(c.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(c.tokens.paren_right),new vr([e])}_paren_expression(){this._consume(c.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(c.tokens.paren_right,"Expected ')'."),new vr([e])}_struct_decl(){if(!this._match(c.keywords.struct))return null;const e=this._consume(c.tokens.ident,"Expected name for struct.").toString();this._consume(c.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(c.tokens.brace_right);){const s=this._attribute(),i=this._consume(c.tokens.ident,"Expected variable name.").toString();this._consume(c.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=o),this._check(c.tokens.brace_right)?this._match(c.tokens.comma):this._consume(c.tokens.comma,"Expected ',' for struct member."),n.push(new Vu(i,a,s))}this._consume(c.tokens.brace_right,"Expected '}' after struct body.");const r=new Ce(e,n);return this._context.structs.set(e,r),r}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(c.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(c.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(c.keywords.const))return null;const e=this._consume(c.tokens.ident,"Expected variable name");let n=null;if(this._match(c.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;if(this._match(c.tokens.equal)){const i=this._short_circuit_or_expression();if(i instanceof He)r=i;else if(i instanceof wr&&i.initializer instanceof He)r=i.initializer;else try{const o=i.evaluate(this._context);r=new br(o)}catch{r=i}}const s=new dr(e.toString(),n,"","",r);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(c.keywords.let))return null;const e=this._consume(c.tokens.ident,"Expected variable name");let n=null;if(this._match(c.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;return this._match(c.tokens.equal)&&(r=this._const_expression()),new Ut(e.toString(),n,"","",r)}_const_expression(){if(this._match(c.const_literal))return new mr(this._previous().toString());const e=this._type_decl();this._consume(c.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(c.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(c.tokens.comma));)this._advance();return this._consume(c.tokens.paren_right,"Expected ')'."),new He(e,n)}_variable_decl(){if(!this._match(c.keywords.var))return null;let e="",n="";this._match(c.tokens.less_than)&&(e=this._consume(c.storage_class,"Expected storage_class.").toString(),this._match(c.tokens.comma)&&(n=this._consume(c.access_mode,"Expected access_mode.").toString()),this._consume(c.tokens.greater_than,"Expected '>'."));const r=this._consume(c.tokens.ident,"Expected variable name");let s=null;if(this._match(c.tokens.colon)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}return new Te(r.toString(),s,e,n,null)}_override_decl(){if(!this._match(c.keywords.override))return null;const e=this._consume(c.tokens.ident,"Expected variable name");let n=null;if(this._match(c.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new hr(e.toString(),n,null)}_enable_directive(){const e=this._consume(c.tokens.ident,"identity expected.");return new Tu(e.toString())}_type_alias(){const e=this._consume(c.tokens.ident,"identity expected.");this._consume(c.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new fr(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([c.tokens.ident,...c.texel_format,c.keywords.bool,c.keywords.f32,c.keywords.i32,c.keywords.u32])){const r=this._advance(),s=r.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new Me(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(c.template_types)){let r=this._advance().toString(),s=null,i=null;return this._match(c.tokens.less_than)&&(s=this._type_decl(),i=null,this._match(c.tokens.comma)&&(i=this._consume(c.access_mode,"Expected access_mode for pointer").toString()),this._consume(c.tokens.greater_than,"Expected '>' for type.")),new _r(r,s,i)}if(this._match(c.keywords.ptr)){let r=this._previous().toString();this._consume(c.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(c.storage_class,"Expected storage_class for pointer");this._consume(c.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let o=null;return this._match(c.tokens.comma)&&(o=this._consume(c.access_mode,"Expected access_mode for pointer").toString()),this._consume(c.tokens.greater_than,"Expected '>' for pointer."),new Nu(r,s.toString(),i,o)}const n=this._attribute();if(this._match(c.keywords.array)){let r=null,s=-1;const i=this._previous();if(this._match(c.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let o="";this._match(c.tokens.comma)&&(o=this._shift_expression().evaluate(this._context).toString()),this._consume(c.tokens.greater_than,"Expected '>' for array."),s=o?parseInt(o):0}return new pr(i.toString(),n,r,s)}return null}_texture_sampler_types(){if(this._match(c.sampler_type))return new De(this._previous().toString(),null,null);if(this._match(c.depth_texture_type))return new De(this._previous().toString(),null,null);if(this._match(c.sampled_texture_type)||this._match(c.multisampled_texture_type)){const e=this._previous();this._consume(c.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(c.tokens.greater_than,"Expected '>' for sampler type."),new De(e.toString(),n,null)}if(this._match(c.storage_texture_type)){const e=this._previous();this._consume(c.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(c.texel_format,"Invalid texel format.").toString();this._consume(c.tokens.comma,"Expected ',' after texel format.");const r=this._consume(c.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(c.tokens.greater_than,"Expected '>' for sampler type."),new De(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(c.tokens.attr);){const n=this._consume(c.attribute_name,"Expected attribute name"),r=new Er(n.toString(),null);if(this._match(c.tokens.paren_left)){if(r.value=this._consume(c.literal_or_ident,"Expected attribute value").toString(),this._check(c.tokens.comma)){this._advance();do{const s=this._consume(c.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(s)}while(this._match(c.tokens.comma))}this._consume(c.tokens.paren_right,"Expected ')'")}e.push(r)}for(;this._match(c.tokens.attr_left);){if(!this._check(c.tokens.attr_right))do{const n=this._consume(c.attribute_name,"Expected attribute name"),r=new Er(n.toString(),null);if(this._match(c.tokens.paren_left)){if(r.value=[this._consume(c.literal_or_ident,"Expected attribute value").toString()],this._check(c.tokens.comma)){this._advance();do{const s=this._consume(c.literal_or_ident,"Expected attribute value").toString();r.value.push(s)}while(this._match(c.tokens.comma))}this._consume(c.tokens.paren_right,"Expected ')'")}e.push(r)}while(this._match(c.tokens.comma));this._consume(c.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class Le{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Ar{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class rt extends Le{constructor(e,n){super(e,n),this.members=[],this.align=0}get isStruct(){return!0}}class Vt extends Le{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class Tr extends Le{constructor(e,n,r,s){super(e,r),this.format=n,this.access=s}get isTemplate(){return!0}}var Y;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Y||(Y={}));class st{constructor(e,n,r,s,i,o,a){this.name=e,this.type=n,this.group=r,this.binding=s,this.attributes=i,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class qu{constructor(e,n){this.name=e,this.type=n}}class it{constructor(e,n){this.align=e,this.size=n}}class Du{constructor(e,n,r,s){this.name=e,this.type=n,this.locationType=r,this.location=s,this.interpolation=null}}class Mr{constructor(e,n,r,s){this.name=e,this.type=n,this.locationType=r,this.location=s}}class Hu{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.name=e,this.stage=n}}class ju{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Xu{constructor(e,n,r,s){this.name=e,this.type=n,this.attributes=r,this.id=s}}class Yu{constructor(e){this.resources=null,this.node=e}}class be{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new ju,this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new Gu().parse(e);for(const r of n)r instanceof Pt&&this._functions.set(r.name,new Yu(r));for(const r of n){if(r instanceof Ce){const s=this._getTypeInfo(r,null);s instanceof rt&&this.structs.push(s);continue}if(r instanceof fr){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof hr){const s=r,i=this._getAttributeNum(s.attributes,"id",0),o=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new Xu(s.name,o,s.attributes,i));continue}if(this._isUniformVar(r)){const s=r,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=new st(s.name,a,i,o,s.attributes,Y.Uniform,s.access);this.uniforms.push(u);continue}if(this._isStorageVar(r)){const s=r,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=this._isStorageTexture(a),l=new st(s.name,a,i,o,s.attributes,u?Y.StorageTexture:Y.Storage,s.access);this.storage.push(l);continue}if(this._isTextureVar(r)){const s=r,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=this._isStorageTexture(a),l=new st(s.name,a,i,o,s.attributes,u?Y.StorageTexture:Y.Texture,s.access);u?this.storage.push(l):this.textures.push(l);continue}if(this._isSamplerVar(r)){const s=r,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=new st(s.name,a,i,o,s.attributes,Y.Sampler,s.access);this.samplers.push(u);continue}if(r instanceof Pt){const s=this._getAttribute(r,"vertex"),i=this._getAttribute(r,"fragment"),o=this._getAttribute(r,"compute"),a=s||i||o;if(a){const u=new Hu(r.name,a==null?void 0:a.name);u.inputs=this._getInputs(r.args),u.outputs=this._getOutputs(r.returnType),u.resources=this._findResources(r),this.entry[a.name].push(u)}continue}}}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_findResources(e){const n=[],r=this,s=[];return e.search(i=>{if(i instanceof tt)s.push({});else if(i instanceof nt)s.pop();else if(i instanceof Te){if(s.length>0){const o=i;s[s.length-1][o.name]=o}}else if(i instanceof Ut){if(s.length>0){const o=i;s[s.length-1][o.name]=o}}else if(i instanceof yr){const o=i;if(s.length>0&&s[s.length-1][o.name])return;const a=r._findResource(o.name);a&&n.push(a)}else if(i instanceof gr){const o=i,a=r._functions.get(o.name);a&&(a.resources===null&&(a.resources=r._findResources(a.node)),n.push(...a.resources))}}),[...new Map(n.map(i=>[i.name,i])).values()]}getBindGroups(){const e=[];function n(r,s){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),s>=e[r].length&&(e[r].length=s+1)}for(const r of this.uniforms){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const s=e[r.group];s[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof Ce)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof Ce)this._getStructOutputs(r.type,n);else{const s=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(s!==null){const i=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(s.value),a=new Mr(r.name,i,s.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),s=this._parseInt(n.value);return new Mr("",r,n.name,s)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof Ce)this._getStructInputs(r.type,n);else{const s=this._getInputInfo(r);s!==null&&n.push(s)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof Ce)this._getStructInputs(r.type,n);else{const s=this._getInputInfo(r);s!==null&&n.push(s)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),s=this._getTypeInfo(e.type,e.attributes),i=this._parseInt(n.value),o=new Du(e.name,s,n.name,i);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new qu(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof pr){const s=e,i=this._getTypeInfo(s.format,s.attributes),o=new Vt(s.name,n);return o.format=i,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Ce){const s=e,i=new rt(s.name,n);for(const o of s.members){const a=this._getTypeInfo(o.type,o.attributes);i.members.push(new Ar(o.name,a,o.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof De){const s=e,i=s.format instanceof Me,o=s.format?i?this._getTypeInfo(s.format,null):new Le(s.format,null):null,a=new Tr(s.name,o,n,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof _r){const s=e,i=s.format?this._getTypeInfo(s.format,null):null,o=new Tr(s.name,i,n,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new Le(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof Vt){const i=this._getTypeSize(e.format);e.stride=(r=i==null?void 0:i.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof rt&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,s=0,i=0,o=0;for(let a=0,u=e.members.length;a<u;++a){const l=e.members[a],d=this._getTypeSize(l);if(!d)continue;(n=this._getAlias(l.type.name))!==null&&n!==void 0||l.type;const h=d.align,p=d.size;r=this._roundUp(h,r+s),s=p,i=r,o=Math.max(o,h),l.offset=r,l.size=p,this._updateTypeInfo(l.type)}e.size=this._roundUp(o,i+s),e.align=o}_getTypeSize(e){var n;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Ar&&(e=e.type),e instanceof Le){const i=this._getAlias(e.name);i!==null&&(e=i)}{const i=be._typeInfo[e.name];if(i!==void 0){const o=e.format==="f16"?2:1;return new it(Math.max(s,i.align/o),Math.max(r,i.size/o))}}{const i=be._typeInfo[e.name.substring(0,e.name.length-1)];if(i){const o=e.name[e.name.length-1]==="h"?2:1;return new it(Math.max(s,i.align/o),Math.max(r,i.size/o))}}if(e instanceof Vt){let i=e,o=8,a=8;const u=this._getTypeSize(i.format);u!==null&&(a=u.size,o=u.align);const l=i.count,d=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,a));return a=l*d,r&&(a=r),new it(Math.max(s,o),Math.max(r,a))}if(e instanceof rt){let i=0,o=0,a=0,u=0,l=0;for(const d of e.members){const h=this._getTypeSize(d.type);h!==null&&(i=Math.max(h.align,i),a=this._roundUp(h.align,a+u),u=h.size,l=a)}return o=this._roundUp(i,l+u),new it(Math.max(s,i),Math.max(r,o))}return null}_isUniformVar(e){return e instanceof Te&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Te&&e.storage=="storage"}_isTextureVar(e){return e instanceof Te&&e.type!==null&&be._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Te&&e.type!==null&&be._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const s=r.attributes;for(let i of s)if(i.name==n)return i;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let s of e)if(s.name==n){let i=s!==null&&s.value!==null?s.value:r;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}be._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},be._textureTypes=c.any_texture_type.map(t=>t.name),be._samplerTypes=c.sampler_type.map(t=>t.name);function Re(t,e){return Object.fromEntries(e.map(n=>{const r=Zu(t,n,0);return[n.name,{typeDefinition:r,group:n.group,binding:n.binding,size:r.size}]}))}function Cr(t,e,n){return{fields:Object.fromEntries(e.members.map(r=>[r.name,{offset:r.offset,type:qt(t,r.type,0)}])),size:e.size,offset:n}}function Wu(t){var e;if(t.name.includes("depth"))return"depth";switch((e=t.format)==null?void 0:e.name){case"f32":return"float";case"i32":return"sint";case"u32":return"uint";default:throw new Error("unknown texture sample type")}}function Or(t){return t.name.includes("2d_array")?"2d-array":t.name.includes("cube_array")?"cube-array":t.name.includes("3d")?"3d":t.name.includes("1d")?"1d":t.name.includes("cube")?"cube":"2d"}function Ju(t){switch(t.access){case"read":return"read-only";case"write":return"write-only";case"read_write":return"read-write";default:throw new Error("unknonw storage texture access")}}function Ku(t){return t.name.endsWith("_comparison")?"comparison":"filtering"}function Qu(t,e){const{binding:n,access:r,type:s}=t;switch(t.resourceType){case Y.Uniform:return{binding:n,visibility:e,buffer:{}};case Y.Storage:return{binding:n,visibility:e,buffer:{type:r===""||r==="read"?"read-only-storage":"storage"}};case Y.Texture:{if(s.name==="texture_external")return{binding:n,visibility:e,externalTexture:{}};const i=s.name.includes("multisampled");return{binding:n,visibility:e,texture:{sampleType:Wu(s),viewDimension:Or(s),multisampled:i}}}case Y.Sampler:return{binding:n,visibility:e,sampler:{type:Ku(s)}};case Y.StorageTexture:return{binding:n,visibility:e,storageTexture:{access:Ju(s),format:s.format.name,viewDimension:Or(s)}};default:throw new Error("unknown resource type")}}function Ft(t,e){const n={};for(const r of t)n[r.name]={stage:e,resources:r.resources.map(s=>{const{name:i,group:o}=s;return{name:i,group:o,entry:Qu(s,e)}})};return n}function $u(t){const e=new be(t),n=Object.fromEntries(e.structs.map(d=>[d.name,Cr(e,d,0)])),r=Re(e,e.uniforms),s=Re(e,e.storage.filter(d=>d.resourceType===Y.Storage)),i=Re(e,e.storage.filter(d=>d.resourceType===Y.StorageTexture)),o=Re(e,e.textures.filter(d=>d.type.name!=="texture_external")),a=Re(e,e.textures.filter(d=>d.type.name==="texture_external")),u=Re(e,e.samplers),l={...Ft(e.entry.vertex,GPUShaderStage.VERTEX),...Ft(e.entry.fragment,GPUShaderStage.FRAGMENT),...Ft(e.entry.compute,GPUShaderStage.COMPUTE)};return{externalTextures:a,samplers:u,structs:n,storages:s,storageTextures:i,textures:o,uniforms:r,entryPoints:l}}function Gt(t,e=""){if(!t)throw new Error(e)}function Zu(t,e,n){switch(e.resourceType){case Y.Uniform:case Y.Storage:case Y.StorageTexture:return qt(t,e.type,n);default:return{size:0,type:e.type.name}}}function qt(t,e,n){if(e.isArray){Gt(!e.isStruct,"struct array is invalid"),Gt(!e.isStruct,"template array is invalid");const r=e;return{size:r.size,elementType:qt(t,r.format,n),numElements:r.count}}else{if(e.isStruct)return Gt(!e.isTemplate,"template struct is invalid"),Cr(t,e,n);{const r=e,s=e.isTemplate?`${r.name}<${r.format.name}>`:e.name;return{size:e.size,type:s}}}}const ec=new Map([[Int8Array,{formats:["sint8","snorm8"],defaultForType:1}],[Uint8Array,{formats:["uint8","unorm8"],defaultForType:1}],[Int16Array,{formats:["sint16","snorm16"],defaultForType:1}],[Uint16Array,{formats:["uint16","unorm16"],defaultForType:1}],[Int32Array,{formats:["sint32","snorm32"],defaultForType:0}],[Uint32Array,{formats:["uint32","unorm32"],defaultForType:0}],[Float32Array,{formats:["float32","float32"],defaultForType:0}]]);new Map([...ec.entries()].map(([t,{formats:[e,n]}])=>[[e,t],[n,t]]).flat());class tc{constructor(e,n,r,s,i){S(this,"eye",[0,0,0]);S(this,"target",[0,0,0]);S(this,"up",[0,1,0]);S(this,"matrix");S(this,"trfView");S(this,"trfBuffer");S(this,"bindGrouplayout");S(this,"bindGroup");this.matrix=j.perspective(n,r,s,i);const o=$u(Zn);this.trfView=_u(o.uniforms.trf),this.trfView.set({projectionMatrix:this.matrix});const{bindGrouplayout:a,bindGroup:u,trfBuffer:l}=this.makeBindGroup(e);this.bindGroup=u,this.bindGrouplayout=a,this.trfBuffer=l}makeBindGroup(e){const n=e.createBuffer({size:this.trfView.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),r=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]});return{bindGroup:e.createBindGroup({layout:r,entries:[{binding:0,resource:{buffer:n}}]}),bindGrouplayout:r,trfBuffer:n}}lookAt(e,n,r){this.eye=e,n&&(this.target=n),r&&(this.up=r)}render(e){e.setBindGroup(0,this.bindGroup)}}class nc{constructor(e,n,r){S(this,"arcballController");S(this,"id","orbitcontroller-tips");this.camera=e,this.canvas=n,this.options=r,this.arcballController=this.createArcBallCamera(e.eye,e.target,e.up)}update(){}createArcBallCamera(e,n,r){const s=this.canvas.clientWidth,i=this.canvas.clientHeight,{zoomSpeed:o}=this.options??{},a=new iu(e,n,r,o??.5,[s,i]),u=new ou;if(u.mousemove=(l,d,h)=>{h.buttons==1?a.rotate(l,d):h.buttons==2&&a.pan([d[0]-l[0],l[1]-d[1]])},u.wheel=l=>{a.zoom(l*.5)},u.registerForCanvas(this.canvas),!document.getElementById(this.id)){const l=document.createElement("div");l.innerText="Controls: left-click to drag, right-click to pan, scroll to zoom.",document.body.insertBefore(l,document.body.firstChild),l.id=this.id}return a}render(e,n){this.camera.trfView.set({viewMatrix:this.arcballController.camera}),n.queue.writeBuffer(this.camera.trfBuffer,0,this.camera.trfView.arrayBuffer),this.camera.render(e)}}class rc{constructor(){S(this,"comments",[]);S(this,"name","");S(this,"vertexs",[]);S(this,"uvs",[]);S(this,"norms",[]);S(this,"indices",[]);S(this,"vertexData",[]);S(this,"matrix",j.identity());S(this,"renderPipeline",null);S(this,"renderBuffers",null);S(this,"renderBindGroup",null)}get VertexCount(){return this.vertexs.length/3}makeBuffers(e,n){if(this.vertexs.length===0)throw new Error("No vertex");const{indexFormat:r="uint32"}=n??{},s=r==="uint32"?new Uint32Array(this.indices):new Uint16Array(this.indices),i=e.createBuffer({size:s.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(i,0,s);const o=new Float32Array(this.vertexData),a=e.createBuffer({size:o.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(a,0,o);const u=[{arrayStride:8*4,stepMode:"vertex",attributes:[{shaderLocation:Ae.POSITION,offset:0,format:"float32x3"},{shaderLocation:Ae.NORMAL,offset:3*4,format:"float32x3"},{shaderLocation:Ae.TEXCOORD_0,offset:6*4,format:"float32x2"}]}];return{indicesBuffer:i,vertexBuffer:a,vertexDescriptor:u,indexFormat:r}}makeBindGroup(e){const n=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),r=e.createBuffer({size:16*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new Float32Array(r.getMappedRange()).set(this.matrix),r.unmap(),{bindGroup:e.createBindGroup({layout:n,entries:[{binding:0,resource:{buffer:r}}]}),bindGroupLayout:n}}buildRenderPipeline(e,n,r,s,i,o="depth24plus",a){this.renderBuffers=this.makeBuffers(e,{indexFormat:"uint32"}),this.renderBindGroup={...this.makeBindGroup(e),groupIndex:s.length},a&&a.bindGroupCount++,this.renderPipeline=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[...s,this.renderBindGroup.bindGroupLayout]}),vertex:{module:n,entryPoint:"main",buffers:this.renderBuffers.vertexDescriptor},fragment:{module:r,entryPoint:"main",targets:[{format:i}]},primitive:{cullMode:"back",topology:"triangle-list"},depthStencil:{format:o,depthWriteEnabled:!0,depthCompare:"less"}}),a&&a.pipelineCount++}buildInRenderPipeline(e,n,r,s="depth24plus",i){return this.buildRenderPipeline(e,e.createShaderModule({code:er}),e.createShaderModule({code:tr}),n,r,s,i)}render(e,n){if(!this.renderPipeline)return;const{vertexBuffer:r,indicesBuffer:s,indexFormat:i}=this.renderBuffers,{groupIndex:o,bindGroup:a}=this.renderBindGroup;e.setPipeline(this.renderPipeline),n&&n.pipelineSets++,e.setVertexBuffer(0,r),e.setIndexBuffer(s,i),n&&(n.bufferSets=n.bufferSets+2),e.setBindGroup(o,a),n&&n.bindGroupSets++,e.drawIndexed(this.indices.length),n&&n.drawCount++}}class sc{async load(e,n,r){const s=await this.parse(n),{bindGroupLayouts:i,format:o,depthFormat:a,record:u}=r;return s.buildInRenderPipeline(e,i,o,a,u),s}async parse(e){const n=(await(await fetch(e)).text()).split(`
`),r=new rc,s=[],i=[],o=[],a=[];r.name=e.split("/").at(-1)??"",n.forEach(b=>{const g=b.trim(),[E,...k]=g.split(" ");E==="#"?r.comments.push(k.join(" ")):E==="o"?r.name=k.join(" "):E==="v"?s.push(k.map(parseFloat)):E==="vt"?i.push(k.map(parseFloat)):E==="vn"?o.push(k.map(parseFloat)):E==="f"&&a.push(k)});const u=[],l=[],d=[],h=[],p=[],y={};let x=0;for(const b of a)for(const g of b){if(y[g]!==void 0){h.push(y[g]);continue}y[g]=x,h.push(x);const[E,k,A]=g.split("/").map(L=>Number(L)-1);E>-1&&(u.push(...s[E]),p.push(...s[E]));const C=A>-1?o[A]:ye([(he(-1,1),he(-1,1),he(-1,1))]);d.push(...C),p.push(...C);const O=k>-1?i[k]:[he(0,1),he(0,1)];l.push(...O),p.push(...O),x++}return r.vertexs=u,r.uvs=l,r.norms=d,r.indices=h,r.vertexData=p,r}}function ic(t){if(t&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function Pe(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),s=Math.round(t.g),i=Math.round(t.b),o=t.a,a=Math.round(t.h),u=t.s.toFixed(1),l=t.v.toFixed(1);if(e||n==="THREE_CHAR_HEX"||n==="SIX_CHAR_HEX"){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}else{if(n==="CSS_RGB")return"rgb("+r+","+s+","+i+")";if(n==="CSS_RGBA")return"rgba("+r+","+s+","+i+","+o+")";if(n==="HEX")return"0x"+t.hex.toString(16);if(n==="RGB_ARRAY")return"["+r+","+s+","+i+"]";if(n==="RGBA_ARRAY")return"["+r+","+s+","+i+","+o+"]";if(n==="RGB_OBJ")return"{r:"+r+",g:"+s+",b:"+i+"}";if(n==="RGBA_OBJ")return"{r:"+r+",g:"+s+",b:"+i+",a:"+o+"}";if(n==="HSV_OBJ")return"{h:"+a+",s:"+u+",v:"+l+"}";if(n==="HSVA_OBJ")return"{h:"+a+",s:"+u+",v:"+l+",a:"+o+"}"}return"unknown format"}var Nr=Array.prototype.forEach,je=Array.prototype.slice,v={BREAK:{},extend:function(t){return this.each(je.call(arguments,1),function(e){var n=this.isObject(e)?Object.keys(e):[];n.forEach((function(r){this.isUndefined(e[r])||(t[r]=e[r])}).bind(this))},this),t},defaults:function(t){return this.each(je.call(arguments,1),function(e){var n=this.isObject(e)?Object.keys(e):[];n.forEach((function(r){this.isUndefined(t[r])&&(t[r]=e[r])}).bind(this))},this),t},compose:function(){var t=je.call(arguments);return function(){for(var e=je.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t){if(Nr&&t.forEach&&t.forEach===Nr)t.forEach(e,n);else if(t.length===t.length+0){var r=void 0,s=void 0;for(r=0,s=t.length;r<s;r++)if(r in t&&e.call(n,t[r],r)===this.BREAK)return}else for(var i in t)if(e.call(n,t[i],i)===this.BREAK)return}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var r=void 0;return function(){var s=this,i=arguments;function o(){r=null,n||t.apply(s,i)}var a=n||!r;clearTimeout(r),r=setTimeout(o,e),a&&t.apply(s,i)}},toArray:function(t){return t.toArray?t.toArray():je.call(t)},isUndefined:function(t){return t===void 0},isNull:function(t){return t===null},isNaN:function(t){function e(n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return t instanceof Function}},oc=[{litmus:v.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Pe},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Pe},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Pe},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Pe}}},{litmus:v.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:v.isArray,conversions:{RGB_ARRAY:{read:function(t){return t.length!==3?!1:{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return t.length!==4?!1:{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:v.isObject,conversions:{RGBA_OBJ:{read:function(t){return v.isNumber(t.r)&&v.isNumber(t.g)&&v.isNumber(t.b)&&v.isNumber(t.a)?{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return v.isNumber(t.r)&&v.isNumber(t.g)&&v.isNumber(t.b)?{space:"RGB",r:t.r,g:t.g,b:t.b}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return v.isNumber(t.h)&&v.isNumber(t.s)&&v.isNumber(t.v)&&v.isNumber(t.a)?{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return v.isNumber(t.h)&&v.isNumber(t.s)&&v.isNumber(t.v)?{space:"HSV",h:t.h,s:t.s,v:t.v}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],Xe=void 0,ot=void 0,Dt=function(){ot=!1;var t=arguments.length>1?v.toArray(arguments):arguments[0];return v.each(oc,function(e){if(e.litmus(t))return v.each(e.conversions,function(n,r){if(Xe=n.read(t),ot===!1&&Xe!==!1)return ot=Xe,Xe.conversionName=r,Xe.conversion=n,v.BREAK}),v.BREAK}),ot},Br=void 0,at={hsv_to_rgb:function(t,e,n){var r=Math.floor(t/60)%6,s=t/60-Math.floor(t/60),i=n*(1-e),o=n*(1-s*e),a=n*(1-(1-s)*e),u=[[n,a,i],[o,n,i],[i,n,a],[i,o,n],[a,i,n],[n,i,o]][r];return{r:u[0]*255,g:u[1]*255,b:u[2]*255}},rgb_to_hsv:function(t,e,n){var r=Math.min(t,e,n),s=Math.max(t,e,n),i=s-r,o=void 0,a=void 0;if(s!==0)a=i/s;else return{h:NaN,s:0,v:0};return t===s?o=(e-n)/i:e===s?o=2+(n-t)/i:o=4+(t-e)/i,o/=6,o<0&&(o+=1),{h:o*360,s:a,v:s/255}},rgb_to_hex:function(t,e,n){var r=this.hex_with_component(0,2,t);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,n),r},component_from_hex:function(t,e){return t>>e*8&255},hex_with_component:function(t,e,n){return n<<(Br=e*8)|t&~(255<<Br)}},ac=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},fe=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),xe=function t(e,n,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(s===void 0){var i=Object.getPrototypeOf(e);return i===null?void 0:t(i,n,r)}else{if("value"in s)return s.value;var o=s.get;return o===void 0?void 0:o.call(r)}},ke=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Ee=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},W=function(){function t(){if(de(this,t),this.__state=Dt.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return fe(t,[{key:"toString",value:function(){return Pe(this)}},{key:"toHexString",value:function(){return Pe(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function Ht(t,e,n){Object.defineProperty(t,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(W.recalculateRGB(this,e,n),this.__state[e])},set:function(r){this.__state.space!=="RGB"&&(W.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=r}})}function jt(t,e){Object.defineProperty(t,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(W.recalculateHSV(this),this.__state[e])},set:function(n){this.__state.space!=="HSV"&&(W.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=n}})}W.recalculateRGB=function(t,e,n){if(t.__state.space==="HEX")t.__state[e]=at.component_from_hex(t.__state.hex,n);else if(t.__state.space==="HSV")v.extend(t.__state,at.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v));else throw new Error("Corrupted color state")},W.recalculateHSV=function(t){var e=at.rgb_to_hsv(t.r,t.g,t.b);v.extend(t.__state,{s:e.s,v:e.v}),v.isNaN(e.h)?v.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},W.COMPONENTS=["r","g","b","h","s","v","hex","a"],Ht(W.prototype,"r",2),Ht(W.prototype,"g",1),Ht(W.prototype,"b",0),jt(W.prototype,"h"),jt(W.prototype,"s"),jt(W.prototype,"v"),Object.defineProperty(W.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(W.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=at.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var Oe=function(){function t(e,n){de(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return fe(t,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),uc={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},zr={};v.each(uc,function(t,e){v.each(t,function(n){zr[n]=e})});var cc=/(\d+(\.\d+)?)px/;function ge(t){if(t==="0"||v.isUndefined(t))return 0;var e=t.match(cc);return v.isNull(e)?0:parseFloat(e[1])}var m={makeSelectable:function(t,e){t===void 0||t.style===void 0||(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var r=n,s=e;v.isUndefined(s)&&(s=!0),v.isUndefined(r)&&(r=!0),t.style.position="absolute",s&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,r){var s=n||{},i=zr[e];if(!i)throw new Error("Event type "+e+" not supported.");var o=document.createEvent(i);switch(i){case"MouseEvents":{var a=s.x||s.clientX||0,u=s.y||s.clientY||0;o.initMouseEvent(e,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,a,u,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var l=o.initKeyboardEvent||o.initKeyEvent;v.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(e,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break}default:{o.initEvent(e,s.bubbles||!1,s.cancelable||!0);break}}v.defaults(o,r),t.dispatchEvent(o)},bind:function(t,e,n,r){var s=r||!1;return t.addEventListener?t.addEventListener(e,n,s):t.attachEvent&&t.attachEvent("on"+e,n),m},unbind:function(t,e,n,r){var s=r||!1;return t.removeEventListener?t.removeEventListener(e,n,s):t.detachEvent&&t.detachEvent("on"+e,n),m},addClass:function(t,e){if(t.className===void 0)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);n.indexOf(e)===-1&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return m},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),r=n.indexOf(e);r!==-1&&(n.splice(r,1),t.className=n.join(" "))}else t.className=void 0;return m},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return ge(e["border-left-width"])+ge(e["border-right-width"])+ge(e["padding-left"])+ge(e["padding-right"])+ge(e.width)},getHeight:function(t){var e=getComputedStyle(t);return ge(e["border-top-width"])+ge(e["border-bottom-width"])+ge(e["padding-top"])+ge(e["padding-bottom"])+ge(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent;while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},Ir=function(t){ke(e,t);function e(n,r){de(this,e);var s=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),i=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function o(){i.setValue(!i.__prev)}return m.bind(s.__checkbox,"change",o,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return fe(e,[{key:"setValue",value:function(n){var r=xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Oe),lc=function(t){ke(e,t);function e(n,r,s){de(this,e);var i=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s,a=i;if(i.__select=document.createElement("select"),v.isArray(o)){var u={};v.each(o,function(l){u[l]=l}),o=u}return v.each(o,function(l,d){var h=document.createElement("option");h.innerHTML=d,h.setAttribute("value",l),a.__select.appendChild(h)}),i.updateDisplay(),m.bind(i.__select,"change",function(){var l=this.options[this.selectedIndex].value;a.setValue(l)}),i.domElement.appendChild(i.__select),i}return fe(e,[{key:"setValue",value:function(n){var r=xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return m.isActive(this.__select)?this:(this.__select.value=this.getValue(),xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Oe),hc=function(t){ke(e,t);function e(n,r){de(this,e);var s=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),i=s;function o(){i.setValue(i.__input.value)}function a(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),m.bind(s.__input,"keyup",o),m.bind(s.__input,"change",o),m.bind(s.__input,"blur",a),m.bind(s.__input,"keydown",function(u){u.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return fe(e,[{key:"updateDisplay",value:function(){return m.isActive(this.__input)||(this.__input.value=this.getValue()),xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Oe);function Lr(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Rr=function(t){ke(e,t);function e(n,r,s){de(this,e);var i=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,v.isUndefined(i.__step)?i.initialValue===0?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=Lr(i.__impliedStep),i}return fe(e,[{key:"setValue",value:function(n){var r=n;return this.__min!==void 0&&r<this.__min?r=this.__min:this.__max!==void 0&&r>this.__max&&(r=this.__max),this.__step!==void 0&&r%this.__step!==0&&(r=Math.round(r/this.__step)*this.__step),xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(n){return this.__min=n,this}},{key:"max",value:function(n){return this.__max=n,this}},{key:"step",value:function(n){return this.__step=n,this.__impliedStep=n,this.__precision=Lr(n),this}}]),e}(Oe);function dc(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}var ut=function(t){ke(e,t);function e(n,r,s){de(this,e);var i=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,s));i.__truncationSuspended=!1;var o=i,a=void 0;function u(){var x=parseFloat(o.__input.value);v.isNaN(x)||o.setValue(x)}function l(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function d(){l()}function h(x){var b=a-x.clientY;o.setValue(o.getValue()+b*o.__impliedStep),a=x.clientY}function p(){m.unbind(window,"mousemove",h),m.unbind(window,"mouseup",p),l()}function y(x){m.bind(window,"mousemove",h),m.bind(window,"mouseup",p),a=x.clientY}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),m.bind(i.__input,"change",u),m.bind(i.__input,"blur",d),m.bind(i.__input,"mousedown",y),m.bind(i.__input,"keydown",function(x){x.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,l())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return fe(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():dc(this.getValue(),this.__precision),xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Rr);function Pr(t,e,n,r,s){return r+(s-r)*((t-e)/(n-e))}var Xt=function(t){ke(e,t);function e(n,r,s,i,o){de(this,e);var a=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,{min:s,max:i,step:o})),u=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),m.bind(a.__background,"mousedown",l),m.bind(a.__background,"touchstart",p),m.addClass(a.__background,"slider"),m.addClass(a.__foreground,"slider-fg");function l(b){document.activeElement.blur(),m.bind(window,"mousemove",d),m.bind(window,"mouseup",h),d(b)}function d(b){b.preventDefault();var g=u.__background.getBoundingClientRect();return u.setValue(Pr(b.clientX,g.left,g.right,u.__min,u.__max)),!1}function h(){m.unbind(window,"mousemove",d),m.unbind(window,"mouseup",h),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}function p(b){b.touches.length===1&&(m.bind(window,"touchmove",y),m.bind(window,"touchend",x),y(b))}function y(b){var g=b.touches[0].clientX,E=u.__background.getBoundingClientRect();u.setValue(Pr(g,E.left,E.right,u.__min,u.__max))}function x(){m.unbind(window,"touchmove",y),m.unbind(window,"touchend",x),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return fe(e,[{key:"updateDisplay",value:function(){var n=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=n*100+"%",xe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Rr),Ur=function(t){ke(e,t);function e(n,r,s){de(this,e);var i=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=s===void 0?"Fire":s,m.bind(i.__button,"click",function(a){return a.preventDefault(),o.fire(),!1}),m.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return fe(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Oe),Yt=function(t){ke(e,t);function e(n,r){de(this,e);var s=Ee(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r));s.__color=new W(s.getValue()),s.__temp=new W(0);var i=s;s.domElement=document.createElement("div"),m.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",m.bind(s.__input,"keydown",function(b){b.keyCode===13&&h.call(this)}),m.bind(s.__input,"blur",h),m.bind(s.__selector,"mousedown",function(){m.addClass(this,"drag").bind(window,"mouseup",function(){m.removeClass(i.__selector,"drag")})}),m.bind(s.__selector,"touchstart",function(){m.addClass(this,"drag").bind(window,"touchend",function(){m.removeClass(i.__selector,"drag")})});var o=document.createElement("div");v.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),v.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),v.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),v.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),v.extend(o.style,{width:"100%",height:"100%",background:"none"}),Vr(o,"top","rgba(0,0,0,0)","#000"),v.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),_c(s.__hue_field),v.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),m.bind(s.__saturation_field,"mousedown",a),m.bind(s.__saturation_field,"touchstart",a),m.bind(s.__field_knob,"mousedown",a),m.bind(s.__field_knob,"touchstart",a),m.bind(s.__hue_field,"mousedown",u),m.bind(s.__hue_field,"touchstart",u);function a(b){y(b),m.bind(window,"mousemove",y),m.bind(window,"touchmove",y),m.bind(window,"mouseup",l),m.bind(window,"touchend",l)}function u(b){x(b),m.bind(window,"mousemove",x),m.bind(window,"touchmove",x),m.bind(window,"mouseup",d),m.bind(window,"touchend",d)}function l(){m.unbind(window,"mousemove",y),m.unbind(window,"touchmove",y),m.unbind(window,"mouseup",l),m.unbind(window,"touchend",l),p()}function d(){m.unbind(window,"mousemove",x),m.unbind(window,"touchmove",x),m.unbind(window,"mouseup",d),m.unbind(window,"touchend",d),p()}function h(){var b=Dt(this.value);b!==!1?(i.__color.__state=b,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function p(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}s.__saturation_field.appendChild(o),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function y(b){b.type.indexOf("touch")===-1&&b.preventDefault();var g=i.__saturation_field.getBoundingClientRect(),E=b.touches&&b.touches[0]||b,k=E.clientX,A=E.clientY,C=(k-g.left)/(g.right-g.left),O=1-(A-g.top)/(g.bottom-g.top);return O>1?O=1:O<0&&(O=0),C>1?C=1:C<0&&(C=0),i.__color.v=O,i.__color.s=C,i.setValue(i.__color.toOriginal()),!1}function x(b){b.type.indexOf("touch")===-1&&b.preventDefault();var g=i.__hue_field.getBoundingClientRect(),E=b.touches&&b.touches[0]||b,k=E.clientY,A=1-(k-g.top)/(g.bottom-g.top);return A>1?A=1:A<0&&(A=0),i.__color.h=A*360,i.setValue(i.__color.toOriginal()),!1}return s}return fe(e,[{key:"updateDisplay",value:function(){var n=Dt(this.getValue());if(n!==!1){var r=!1;v.each(W.COMPONENTS,function(o){if(!v.isUndefined(n[o])&&!v.isUndefined(this.__color.__state[o])&&n[o]!==this.__color.__state[o])return r=!0,{}},this),r&&v.extend(this.__color.__state,n)}v.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,i=255-s;v.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Vr(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),v.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(Oe),fc=["-moz-","-o-","-webkit-","-ms-",""];function Vr(t,e,n,r){t.style.background="",v.each(fc,function(s){t.style.cssText+="background: "+s+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "})}function _c(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var pc={load:function(t,e){var n=e||document,r=n.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=t,n.getElementsByTagName("head")[0].appendChild(r)},inject:function(t,e){var n=e||document,r=document.createElement("style");r.type="text/css",r.innerHTML=t;var s=n.getElementsByTagName("head")[0];try{s.appendChild(r)}catch{}}},mc=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,gc=function(t,e){var n=t[e];return v.isArray(arguments[2])||v.isObject(arguments[2])?new lc(t,e,arguments[2]):v.isNumber(n)?v.isNumber(arguments[2])&&v.isNumber(arguments[3])?v.isNumber(arguments[4])?new Xt(t,e,arguments[2],arguments[3],arguments[4]):new Xt(t,e,arguments[2],arguments[3]):v.isNumber(arguments[4])?new ut(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ut(t,e,{min:arguments[2],max:arguments[3]}):v.isString(n)?new hc(t,e):v.isFunction(n)?new Ur(t,e,""):v.isBoolean(n)?new Ir(t,e):null};function yc(t){setTimeout(t,1e3/60)}var wc=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||yc,bc=function(){function t(){de(this,t),this.backgroundElement=document.createElement("div"),v.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),m.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),v.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;m.bind(this.backgroundElement,"click",function(){e.hide()})}return fe(t,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),v.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,n=function r(){e.domElement.style.display="none",e.backgroundElement.style.display="none",m.unbind(e.domElement,"webkitTransitionEnd",r),m.unbind(e.domElement,"transitionend",r),m.unbind(e.domElement,"oTransitionEnd",r)};m.bind(this.domElement,"webkitTransitionEnd",n),m.bind(this.domElement,"transitionend",n),m.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-m.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-m.getHeight(this.domElement)/2+"px"}}]),t}(),vc=ic(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);pc.inject(vc);var Fr="dg",Gr=72,qr=20,Ye="Default",We=function(){try{return!!window.localStorage}catch{return!1}}(),Je=void 0,Dr=!0,Ue=void 0,Wt=!1,Hr=[],V=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),m.addClass(this.domElement,Fr),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=v.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=v.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),v.isUndefined(r.load)?r.load={preset:Ye}:r.preset&&(r.load.preset=r.preset),v.isUndefined(r.parent)&&r.hideable&&Hr.push(this),r.resizable=v.isUndefined(r.parent)&&r.resizable,r.autoPlace&&v.isUndefined(r.scrollable)&&(r.scrollable=!0);var s=We&&localStorage.getItem(Ve(this,"isLocal"))==="true",i=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(h){n.parent?n.getRoot().preset=h:r.load.preset=h,Sc(this),n.revert()}},width:{get:function(){return r.width},set:function(h){r.width=h,$t(n,h)}},name:{get:function(){return r.name},set:function(h){r.name=h,o&&(o.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(h){r.closed=h,r.closed?m.addClass(n.__ul,t.CLASS_CLOSED):m.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=h?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return s},set:function(h){We&&(s=h,h?m.bind(window,"unload",i):m.unbind(window,"unload",i),localStorage.setItem(Ve(n,"isLocal"),h))}}}),v.isUndefined(r.parent)){if(this.closed=r.closed||!1,m.addClass(this.domElement,t.CLASS_MAIN),m.makeSelectable(this.domElement,!1),We&&s){n.useLocalStorage=!0;var a=localStorage.getItem(Ve(this,"gui"));a&&(r.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,m.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(m.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(m.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),m.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{r.closed===void 0&&(r.closed=!0);var u=document.createTextNode(r.name);m.addClass(u,"controller-name"),o=Jt(n,u);var l=function(h){return h.preventDefault(),n.closed=!n.closed,!1};m.addClass(this.__ul,t.CLASS_CLOSED),m.addClass(o,"title"),m.bind(o,"click",l),r.closed||(this.closed=!1)}r.autoPlace&&(v.isUndefined(r.parent)&&(Dr&&(Ue=document.createElement("div"),m.addClass(Ue,Fr),m.addClass(Ue,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Ue),Dr=!1),Ue.appendChild(this.domElement),m.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||$t(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},m.bind(window,"resize",this.__resizeHandler),m.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),m.bind(this.__ul,"transitionend",this.__resizeHandler),m.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&Ec(this),i=function(){We&&localStorage.getItem(Ve(n,"isLocal"))==="true"&&localStorage.setItem(Ve(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=i;function d(){var h=n.getRoot();h.width+=1,v.defer(function(){h.width-=1})}r.parent||d()};V.toggleHide=function(){Wt=!Wt,v.each(Hr,function(t){t.domElement.style.display=Wt?"none":""})},V.CLASS_AUTO_PLACE="a",V.CLASS_AUTO_PLACE_CONTAINER="ac",V.CLASS_MAIN="main",V.CLASS_CONTROLLER_ROW="cr",V.CLASS_TOO_TALL="taller-than-window",V.CLASS_CLOSED="closed",V.CLASS_CLOSE_BUTTON="close-button",V.CLASS_CLOSE_TOP="close-top",V.CLASS_CLOSE_BOTTOM="close-bottom",V.CLASS_DRAG="drag",V.DEFAULT_WIDTH=245,V.TEXT_CLOSED="Close Controls",V.TEXT_OPEN="Open Controls",V._keydownHandler=function(t){document.activeElement.type!=="text"&&(t.which===Gr||t.keyCode===Gr)&&V.toggleHide()},m.bind(window,"keydown",V._keydownHandler,!1),v.extend(V.prototype,{add:function(t,e){return Ke(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Ke(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;v.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Ue.removeChild(this.domElement);var t=this;v.each(this.__folders,function(e){t.removeFolder(e)}),m.unbind(window,"keydown",V._keydownHandler,!1),jr(this)},addFolder:function(t){if(this.__folders[t]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new V(e);this.__folders[t]=n;var r=Jt(this,n.domElement);return m.addClass(r,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],jr(t);var e=this;v.each(t.__folders,function(n){t.removeFolder(n)}),v.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=m.getOffset(t.__ul).top,n=0;v.each(t.__ul.childNodes,function(r){t.autoPlace&&r===t.__save_row||(n+=m.getHeight(r))}),window.innerHeight-e-qr<n?(m.addClass(t.domElement,V.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-qr+"px"):(m.removeClass(t.domElement,V.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&v.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:v.debounce(function(){this.onResize()},50),remember:function(){if(v.isUndefined(Je)&&(Je=new bc,Je.domElement.innerHTML=mc),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;v.each(Array.prototype.slice.call(arguments),function(e){t.__rememberedObjects.length===0&&kc(t),t.__rememberedObjects.indexOf(e)===-1&&t.__rememberedObjects.push(e)}),this.autoPlace&&$t(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=ct(this)),t.folders={},v.each(this.__folders,function(e,n){t.folders[n]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ct(this),Kt(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[Ye]=ct(this,!0)),this.load.remembered[t]=ct(this),this.preset=t,Qt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){v.each(this.__controllers,function(e){this.getRoot().load.remembered?Xr(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),v.each(this.__folders,function(e){e.revert(e)}),t||Kt(this.getRoot(),!1)},listen:function(t){var e=this.__listening.length===0;this.__listening.push(t),e&&Wr(this.__listening)},updateDisplay:function(){v.each(this.__controllers,function(t){t.updateDisplay()}),v.each(this.__folders,function(t){t.updateDisplay()})}});function Jt(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function jr(t){m.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&m.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Kt(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];e?n.innerHTML=n.value+"*":n.innerHTML=n.value}function xc(t,e,n){if(n.__li=e,n.__gui=t,v.extend(n,{options:function(i){if(arguments.length>1){var o=n.__li.nextElementSibling;return n.remove(),Ke(t,n.object,n.property,{before:o,factoryArgs:[v.toArray(arguments)]})}if(v.isArray(i)||v.isObject(i)){var a=n.__li.nextElementSibling;return n.remove(),Ke(t,n.object,n.property,{before:a,factoryArgs:[i]})}},name:function(i){return n.__li.firstElementChild.firstElementChild.innerHTML=i,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Xt){var r=new ut(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});v.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(i){var o=n[i],a=r[i];n[i]=r[i]=function(){var u=Array.prototype.slice.call(arguments);return a.apply(r,u),o.apply(n,u)}}),m.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof ut){var s=function(i){if(v.isNumber(n.__min)&&v.isNumber(n.__max)){var o=n.__li.firstElementChild.firstElementChild.innerHTML,a=n.__gui.__listening.indexOf(n)>-1;n.remove();var u=Ke(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return u.name(o),a&&u.listen(),u}return i};n.min=v.compose(s,n.min),n.max=v.compose(s,n.max)}else n instanceof Ir?(m.bind(e,"click",function(){m.fakeEvent(n.__checkbox,"click")}),m.bind(n.__checkbox,"click",function(i){i.stopPropagation()})):n instanceof Ur?(m.bind(e,"click",function(){m.fakeEvent(n.__button,"click")}),m.bind(e,"mouseover",function(){m.addClass(n.__button,"hover")}),m.bind(e,"mouseout",function(){m.removeClass(n.__button,"hover")})):n instanceof Yt&&(m.addClass(e,"color"),n.updateDisplay=v.compose(function(i){return e.style.borderLeftColor=n.__color.toString(),i},n.updateDisplay),n.updateDisplay());n.setValue=v.compose(function(i){return t.getRoot().__preset_select&&n.isModified()&&Kt(t.getRoot(),!0),i},n.setValue)}function Xr(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=n.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},n.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,n.load&&n.load.remembered){var i=n.load.remembered,o=void 0;if(i[t.preset])o=i[t.preset];else if(i[Ye])o=i[Ye];else return;if(o[r]&&o[r][e.property]!==void 0){var a=o[r][e.property];e.initialValue=a,e.setValue(a)}}}}function Ke(t,e,n,r){if(e[n]===void 0)throw new Error('Object "'+e+'" has no property "'+n+'"');var s=void 0;if(r.color)s=new Yt(e,n);else{var i=[e,n].concat(r.factoryArgs);s=gc.apply(t,i)}r.before instanceof Oe&&(r.before=r.before.__li),Xr(t,s),m.addClass(s.domElement,"c");var o=document.createElement("span");m.addClass(o,"property-name"),o.innerHTML=s.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(s.domElement);var u=Jt(t,a,r.before);return m.addClass(u,V.CLASS_CONTROLLER_ROW),s instanceof Yt?m.addClass(u,"color"):m.addClass(u,ac(s.getValue())),xc(t,u,s),t.__controllers.push(s),s}function Ve(t,e){return document.location.href+"."+e}function Qt(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function Yr(t,e){e.style.display=t.useLocalStorage?"block":"none"}function kc(t){var e=t.__save_row=document.createElement("li");m.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),m.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",m.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",m.addClass(r,"button"),m.addClass(r,"save");var s=document.createElement("span");s.innerHTML="New",m.addClass(s,"button"),m.addClass(s,"save-as");var i=document.createElement("span");i.innerHTML="Revert",m.addClass(i,"button"),m.addClass(i,"revert");var o=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?v.each(t.load.remembered,function(h,p){Qt(t,p,p===t.preset)}):Qt(t,Ye,!1),m.bind(o,"change",function(){for(var h=0;h<t.__preset_select.length;h++)t.__preset_select[h].innerHTML=t.__preset_select[h].value;t.preset=this.value}),e.appendChild(o),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(i),We){var a=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block",localStorage.getItem(Ve(t,"isLocal"))==="true"&&u.setAttribute("checked","checked"),Yr(t,a),m.bind(u,"change",function(){t.useLocalStorage=!t.useLocalStorage,Yr(t,a)})}var d=document.getElementById("dg-new-constructor");m.bind(d,"keydown",function(h){h.metaKey&&(h.which===67||h.keyCode===67)&&Je.hide()}),m.bind(n,"click",function(){d.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),Je.show(),d.focus(),d.select()}),m.bind(r,"click",function(){t.save()}),m.bind(s,"click",function(){var h=prompt("Enter a new preset name.");h&&t.saveAs(h)}),m.bind(i,"click",function(){t.revert()})}function Ec(t){var e=void 0;t.__resize_handle=document.createElement("div"),v.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function n(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function r(){m.removeClass(t.__closeButton,V.CLASS_DRAG),m.unbind(window,"mousemove",n),m.unbind(window,"mouseup",r)}function s(i){return i.preventDefault(),e=i.clientX,m.addClass(t.__closeButton,V.CLASS_DRAG),m.bind(window,"mousemove",n),m.bind(window,"mouseup",r),!1}m.bind(t.__resize_handle,"mousedown",s),m.bind(t.__closeButton,"mousedown",s),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function $t(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function ct(t,e){var n={};return v.each(t.__rememberedObjects,function(r,s){var i={},o=t.__rememberedObjectIndecesToControllers[s];v.each(o,function(a,u){i[u]=e?a.initialValue:a.getValue()}),n[s]=i}),n}function Sc(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}function Wr(t){t.length!==0&&wc.call(window,function(){Wr(t)}),v.each(t,function(e){e.updateDisplay()})}var Ac=V;const Jr={avocado:{path:"/gltf/Avocado.glb",near:.01,far:1e3,eye:[0,0,.2],zoomSpeed:.5},cylinder_engine:{path:"/gltf/2CylinderEngine.glb",near:.01,far:1e3,eye:[0,0,700],zoomSpeed:70},antique_camera:{path:"/glTF-Sample-Models/2.0/AntiqueCamera/glTF-Binary/AntiqueCamera-Interleaved.glb",near:.01,far:100,eye:[0,10,5],target:[0,4,0],zoomSpeed:5},buggy:{path:"/glTF-Sample-Models/2.0/Buggy/glTF-Binary/Buggy.glb",near:.01,far:1e3,eye:[100,200,-0],target:[0,0,0],zoomSpeed:30},bunny:{path:"/bunny/bunny-export.obj",near:1,far:100,eye:[0,2,5],target:[0,0,0]}};let Zt=!1;const Kr={model_name:"bunny"};new Ac().add(Kr,"model_name",Object.keys(Jr)).onChange(()=>Zt=!0);const{device:Ne,format:Qr}=await is(),{ctx:Tc,canvas:Mc,aspect:Cc}=os(500,500,{device:Ne,format:Qr});async function $r(){const t=Kr.model_name,e=Jr[t],n=new su,r=[],s=new tc(Ne,Se(75),Cc,e.near,e.far);s.lookAt(e.eye,e.target);const i=new nc(s,Mc,{zoomSpeed:e.zoomSpeed});r.push(s.bindGrouplayout);const o=await(t==="bunny"?new sc:new Ja).load(Ne,e.path,{bindGroupLayouts:r,format:Qr,record:n});return{record:n,orbitController:i,scene:o}}let Zr=await $r();async function es(){Zt&&(Zr=await $r(),Zt=!1);const{orbitController:t,scene:e,record:n}=Zr,r=Tc.getCurrentTexture(),s=gt.createDepthTexture(Ne,[r.width,r.height]),i=Ne.createCommandEncoder(),o=i.beginRenderPass({colorAttachments:[{loadOp:"clear",storeOp:"store",view:r.createView()}],depthStencilAttachment:{depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",view:s.createView()}});t.render(o,Ne),e.render(o,n),o.end(),Ne.queue.submit([i.finish()]),requestAnimationFrame(es)}requestAnimationFrame(es)})();
