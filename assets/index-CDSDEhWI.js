var Bl=Object.defineProperty;var Il=(he,be,Ie)=>be in he?Bl(he,be,{enumerable:!0,configurable:!0,writable:!0,value:Ie}):he[be]=Ie;var k=(he,be,Ie)=>(Il(he,typeof be!="symbol"?be+"":be,Ie),Ie);(async()=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();function he(t,e){return t===void 0?(t=0,e=1):e===void 0&&(e=t,t=0),t+Math.random()*(e-t)}function be(t){const e=t.reduce((r,n)=>r+n,0);return t.map(r=>r/e)}const Ie=t=>t*Math.PI/180;let C=1e-6,z=Float32Array;function Gs(t){const e=z;return z=t,e}function Qe(t=0,e=0){const r=new z(2);return t!==void 0&&(r[0]=t,e!==void 0&&(r[1]=e)),r}let O=Float32Array;function Us(t){const e=O;return O=t,e}function re(t,e,r){const n=new O(3);return t!==void 0&&(n[0]=t,e!==void 0&&(n[1]=e,r!==void 0&&(n[2]=r))),n}const Vs=Qe;function Ds(t,e,r){return r=r||new z(2),r[0]=t,r[1]=e,r}function qs(t,e){return e=e||new z(2),e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Hs(t,e){return e=e||new z(2),e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function js(t,e){return e=e||new z(2),e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function $s(t,e=0,r=1,n){return n=n||new z(2),n[0]=Math.min(r,Math.max(e,t[0])),n[1]=Math.min(r,Math.max(e,t[1])),n}function Xs(t,e,r){return r=r||new z(2),r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function Ys(t,e,r,n){return n=n||new z(2),n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n}function Ws(t,e){const r=t[0],n=t[1],s=t[0],i=t[1],o=Math.sqrt(r*r+n*n),a=Math.sqrt(s*s+i*i),u=o*a,c=u&&Cr(t,e)/u;return Math.acos(c)}function Tr(t,e,r){return r=r||new z(2),r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}const Js=Tr;function Ks(t,e){return Math.abs(t[0]-e[0])<C&&Math.abs(t[1]-e[1])<C}function Qs(t,e){return t[0]===e[0]&&t[1]===e[1]}function Ar(t,e,r,n){return n=n||new z(2),n[0]=t[0]+r*(e[0]-t[0]),n[1]=t[1]+r*(e[1]-t[1]),n}function Zs(t,e,r,n){return n=n||new z(2),n[0]=t[0]+r[0]*(e[0]-t[0]),n[1]=t[1]+r[1]*(e[1]-t[1]),n}function ei(t,e,r){return r=r||new z(2),r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r}function ti(t,e,r){return r=r||new z(2),r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r}function zt(t,e,r){return r=r||new z(2),r[0]=t[0]*e,r[1]=t[1]*e,r}const ri=zt;function ni(t,e,r){return r=r||new z(2),r[0]=t[0]/e,r[1]=t[1]/e,r}function Mr(t,e){return e=e||new z(2),e[0]=1/t[0],e[1]=1/t[1],e}const si=Mr;function ii(t,e,r){r=r||new O(3);const n=t[0]*e[1]-t[1]*e[0];return r[0]=0,r[1]=0,r[2]=n,r}function Cr(t,e){return t[0]*e[0]+t[1]*e[1]}function Lt(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}const oi=Lt;function Or(t){const e=t[0],r=t[1];return e*e+r*r}const ai=Or;function Nr(t,e){const r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}const ui=Nr;function Br(t,e){const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}const ci=Br;function Ir(t,e){e=e||new z(2);const r=t[0],n=t[1],s=Math.sqrt(r*r+n*n);return s>1e-5?(e[0]=r/s,e[1]=n/s):(e[0]=0,e[1]=0),e}function li(t,e){return e=e||new z(2),e[0]=-t[0],e[1]=-t[1],e}function Pt(t,e){return e=e||new z(2),e[0]=t[0],e[1]=t[1],e}const hi=Pt;function zr(t,e,r){return r=r||new z(2),r[0]=t[0]*e[0],r[1]=t[1]*e[1],r}const di=zr;function Lr(t,e,r){return r=r||new z(2),r[0]=t[0]/e[0],r[1]=t[1]/e[1],r}const fi=Lr;function pi(t=1,e){e=e||new z(2);const r=Math.random()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function mi(t){return t=t||new z(2),t[0]=0,t[1]=0,t}function _i(t,e,r){r=r||new z(2);const n=t[0],s=t[1];return r[0]=n*e[0]+s*e[4]+e[12],r[1]=n*e[1]+s*e[5]+e[13],r}function gi(t,e,r){r=r||new z(2);const n=t[0],s=t[1];return r[0]=e[0]*n+e[4]*s+e[8],r[1]=e[1]*n+e[5]*s+e[9],r}function yi(t,e,r,n){n=n||new z(2);const s=t[0]-e[0],i=t[1]-e[1],o=Math.sin(r),a=Math.cos(r);return n[0]=s*a-i*o+e[0],n[1]=s*o+i*a+e[1],n}function Pr(t,e,r){return r=r||new z(2),Ir(t,r),zt(r,e,r)}function wi(t,e,r){return r=r||new z(2),Lt(t)>e?Pr(t,e,r):Pt(t,r)}function bi(t,e,r){return r=r||new z(2),Ar(t,e,.5,r)}var W=Object.freeze({__proto__:null,add:Xs,addScaled:Ys,angle:Ws,ceil:qs,clamp:$s,clone:hi,copy:Pt,create:Qe,cross:ii,dist:ui,distSq:ci,distance:Nr,distanceSq:Br,div:fi,divScalar:ni,divide:Lr,dot:Cr,equals:Qs,equalsApproximately:Ks,floor:Hs,fromValues:Vs,inverse:Mr,invert:si,len:oi,lenSq:ai,length:Lt,lengthSq:Or,lerp:Ar,lerpV:Zs,max:ei,midpoint:bi,min:ti,mul:di,mulScalar:zt,multiply:zr,negate:li,normalize:Ir,random:pi,rotate:yi,round:js,scale:ri,set:Ds,setDefaultType:Gs,setLength:Pr,sub:Js,subtract:Tr,transformMat3:gi,transformMat4:_i,truncate:wi,zero:mi});let Rr=Float32Array;const Fr=new Map([[Float32Array,()=>new Float32Array(12)],[Float64Array,()=>new Float64Array(12)],[Array,()=>new Array(12).fill(0)]]);let Z=Fr.get(Float32Array);function vi(t){const e=Rr;return Rr=t,Z=Fr.get(t),e}function xi(t,e,r,n,s,i,o,a,u){const c=Z();return c[3]=0,c[7]=0,c[11]=0,t!==void 0&&(c[0]=t,e!==void 0&&(c[1]=e,r!==void 0&&(c[2]=r,n!==void 0&&(c[4]=n,s!==void 0&&(c[5]=s,i!==void 0&&(c[6]=i,o!==void 0&&(c[8]=o,a!==void 0&&(c[9]=a,u!==void 0&&(c[10]=u))))))))),c}function ki(t,e,r,n,s,i,o,a,u,c){return c=c||Z(),c[0]=t,c[1]=e,c[2]=r,c[3]=0,c[4]=n,c[5]=s,c[6]=i,c[7]=0,c[8]=o,c[9]=a,c[10]=u,c[11]=0,c}function Si(t,e){return e=e||Z(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=0,e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=0,e}function Ei(t,e){e=e||Z();const r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,u=s+s,c=r*o,h=n*o,d=n*a,m=s*o,g=s*a,b=s*u,y=i*o,w=i*a,S=i*u;return e[0]=1-d-b,e[1]=h+S,e[2]=m-w,e[3]=0,e[4]=h-S,e[5]=1-c-b,e[6]=g+y,e[7]=0,e[8]=m+w,e[9]=g-y,e[10]=1-c-d,e[11]=0,e}function Ti(t,e){return e=e||Z(),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e}function Rt(t,e){return e=e||Z(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[8]=t[8],e[9]=t[9],e[10]=t[10],e}const Ai=Rt;function Mi(t,e){return Math.abs(t[0]-e[0])<C&&Math.abs(t[1]-e[1])<C&&Math.abs(t[2]-e[2])<C&&Math.abs(t[4]-e[4])<C&&Math.abs(t[5]-e[5])<C&&Math.abs(t[6]-e[6])<C&&Math.abs(t[8]-e[8])<C&&Math.abs(t[9]-e[9])<C&&Math.abs(t[10]-e[10])<C}function Ci(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]}function Gr(t){return t=t||Z(),t[0]=1,t[1]=0,t[2]=0,t[4]=0,t[5]=1,t[6]=0,t[8]=0,t[9]=0,t[10]=1,t}function Oi(t,e){if(e=e||Z(),e===t){let d;return d=t[1],t[1]=t[4],t[4]=d,d=t[2],t[2]=t[8],t[8]=d,d=t[6],t[6]=t[9],t[9]=d,e}const r=t[0*4+0],n=t[0*4+1],s=t[0*4+2],i=t[1*4+0],o=t[1*4+1],a=t[1*4+2],u=t[2*4+0],c=t[2*4+1],h=t[2*4+2];return e[0]=r,e[1]=i,e[2]=u,e[4]=n,e[5]=o,e[6]=c,e[8]=s,e[9]=a,e[10]=h,e}function Ur(t,e){e=e||Z();const r=t[0*4+0],n=t[0*4+1],s=t[0*4+2],i=t[1*4+0],o=t[1*4+1],a=t[1*4+2],u=t[2*4+0],c=t[2*4+1],h=t[2*4+2],d=h*o-a*c,m=-h*i+a*u,g=c*i-o*u,b=1/(r*d+n*m+s*g);return e[0]=d*b,e[1]=(-h*n+s*c)*b,e[2]=(a*n-s*o)*b,e[4]=m*b,e[5]=(h*r-s*u)*b,e[6]=(-a*r+s*i)*b,e[8]=g*b,e[9]=(-c*r+n*u)*b,e[10]=(o*r-n*i)*b,e}function Ni(t){const e=t[0],r=t[0*4+1],n=t[0*4+2],s=t[1*4+0],i=t[1*4+1],o=t[1*4+2],a=t[2*4+0],u=t[2*4+1],c=t[2*4+2];return e*(i*c-u*o)-s*(r*c-u*n)+a*(r*o-i*n)}const Bi=Ur;function Vr(t,e,r){r=r||Z();const n=t[0],s=t[1],i=t[2],o=t[4],a=t[5],u=t[6],c=t[8],h=t[9],d=t[10],m=e[0],g=e[1],b=e[2],y=e[4],w=e[5],S=e[6],E=e[8],A=e[9],M=e[10];return r[0]=n*m+o*g+c*b,r[1]=s*m+a*g+h*b,r[2]=i*m+u*g+d*b,r[4]=n*y+o*w+c*S,r[5]=s*y+a*w+h*S,r[6]=i*y+u*w+d*S,r[8]=n*E+o*A+c*M,r[9]=s*E+a*A+h*M,r[10]=i*E+u*A+d*M,r}const Ii=Vr;function zi(t,e,r){return r=r||Gr(),t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[4]=t[4],r[5]=t[5],r[6]=t[6]),r[8]=e[0],r[9]=e[1],r[10]=1,r}function Li(t,e){return e=e||Qe(),e[0]=t[8],e[1]=t[9],e}function Pi(t,e,r){r=r||Qe();const n=e*4;return r[0]=t[n+0],r[1]=t[n+1],r}function Ri(t,e,r,n){n!==t&&(n=Rt(t,n));const s=r*4;return n[s+0]=e[0],n[s+1]=e[1],n}function Fi(t,e){e=e||Qe();const r=t[0],n=t[1],s=t[4],i=t[5];return e[0]=Math.sqrt(r*r+n*n),e[1]=Math.sqrt(s*s+i*i),e}function Gi(t,e){return e=e||Z(),e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=t[0],e[9]=t[1],e[10]=1,e}function Ui(t,e,r){r=r||Z();const n=e[0],s=e[1],i=t[0],o=t[1],a=t[2],u=t[1*4+0],c=t[1*4+1],h=t[1*4+2],d=t[2*4+0],m=t[2*4+1],g=t[2*4+2];return t!==r&&(r[0]=i,r[1]=o,r[2]=a,r[4]=u,r[5]=c,r[6]=h),r[8]=i*n+u*s+d,r[9]=o*n+c*s+m,r[10]=a*n+h*s+g,r}function Vi(t,e){e=e||Z();const r=Math.cos(t),n=Math.sin(t);return e[0]=r,e[1]=n,e[2]=0,e[4]=-n,e[5]=r,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function Di(t,e,r){r=r||Z();const n=t[0*4+0],s=t[0*4+1],i=t[0*4+2],o=t[1*4+0],a=t[1*4+1],u=t[1*4+2],c=Math.cos(e),h=Math.sin(e);return r[0]=c*n+h*o,r[1]=c*s+h*a,r[2]=c*i+h*u,r[4]=c*o-h*n,r[5]=c*a-h*s,r[6]=c*u-h*i,t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10]),r}function qi(t,e){return e=e||Z(),e[0]=t[0],e[1]=0,e[2]=0,e[4]=0,e[5]=t[1],e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function Hi(t,e,r){r=r||Z();const n=e[0],s=e[1];return r[0]=n*t[0*4+0],r[1]=n*t[0*4+1],r[2]=n*t[0*4+2],r[4]=s*t[1*4+0],r[5]=s*t[1*4+1],r[6]=s*t[1*4+2],t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10]),r}function ji(t,e){return e=e||Z(),e[0]=t,e[1]=0,e[2]=0,e[4]=0,e[5]=t,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e}function $i(t,e,r){return r=r||Z(),r[0]=e*t[0*4+0],r[1]=e*t[0*4+1],r[2]=e*t[0*4+2],r[4]=e*t[1*4+0],r[5]=e*t[1*4+1],r[6]=e*t[1*4+2],t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10]),r}var Dr=Object.freeze({__proto__:null,clone:Ai,copy:Rt,create:xi,determinant:Ni,equals:Ci,equalsApproximately:Mi,fromMat4:Si,fromQuat:Ei,getAxis:Pi,getScaling:Fi,getTranslation:Li,identity:Gr,inverse:Ur,invert:Bi,mul:Ii,multiply:Vr,negate:Ti,rotate:Di,rotation:Vi,scale:Hi,scaling:qi,set:ki,setAxis:Ri,setDefaultType:vi,setTranslation:zi,translate:Ui,translation:Gi,transpose:Oi,uniformScale:$i,uniformScaling:ji});const Xi=re;function Yi(t,e,r,n){return n=n||new O(3),n[0]=t,n[1]=e,n[2]=r,n}function Wi(t,e){return e=e||new O(3),e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Ji(t,e){return e=e||new O(3),e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Ki(t,e){return e=e||new O(3),e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Qi(t,e=0,r=1,n){return n=n||new O(3),n[0]=Math.min(r,Math.max(e,t[0])),n[1]=Math.min(r,Math.max(e,t[1])),n[2]=Math.min(r,Math.max(e,t[2])),n}function Zi(t,e,r){return r=r||new O(3),r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function eo(t,e,r,n){return n=n||new O(3),n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function to(t,e){const r=t[0],n=t[1],s=t[2],i=t[0],o=t[1],a=t[2],u=Math.sqrt(r*r+n*n+s*s),c=Math.sqrt(i*i+o*o+a*a),h=u*c,d=h&&Gt(t,e)/h;return Math.acos(d)}function Ze(t,e,r){return r=r||new O(3),r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}const ro=Ze;function no(t,e){return Math.abs(t[0]-e[0])<C&&Math.abs(t[1]-e[1])<C&&Math.abs(t[2]-e[2])<C}function so(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function qr(t,e,r,n){return n=n||new O(3),n[0]=t[0]+r*(e[0]-t[0]),n[1]=t[1]+r*(e[1]-t[1]),n[2]=t[2]+r*(e[2]-t[2]),n}function io(t,e,r,n){return n=n||new O(3),n[0]=t[0]+r[0]*(e[0]-t[0]),n[1]=t[1]+r[1]*(e[1]-t[1]),n[2]=t[2]+r[2]*(e[2]-t[2]),n}function oo(t,e,r){return r=r||new O(3),r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function ao(t,e,r){return r=r||new O(3),r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function Ft(t,e,r){return r=r||new O(3),r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}const uo=Ft;function co(t,e,r){return r=r||new O(3),r[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e,r}function Hr(t,e){return e=e||new O(3),e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}const lo=Hr;function me(t,e,r){r=r||new O(3);const n=t[2]*e[0]-t[0]*e[2],s=t[0]*e[1]-t[1]*e[0];return r[0]=t[1]*e[2]-t[2]*e[1],r[1]=n,r[2]=s,r}function Gt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ut(t){const e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}const jr=Ut;function $r(t){const e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}const ho=$r;function Xr(t,e){const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+n*n+s*s)}const fo=Xr;function Yr(t,e){const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s}const po=Yr;function ue(t,e){e=e||new O(3);const r=t[0],n=t[1],s=t[2],i=Math.sqrt(r*r+n*n+s*s);return i>1e-5?(e[0]=r/i,e[1]=n/i,e[2]=s/i):(e[0]=0,e[1]=0,e[2]=0),e}function mo(t,e){return e=e||new O(3),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Vt(t,e){return e=e||new O(3),e[0]=t[0],e[1]=t[1],e[2]=t[2],e}const _o=Vt;function Wr(t,e,r){return r=r||new O(3),r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}const go=Wr;function Jr(t,e,r){return r=r||new O(3),r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}const yo=Jr;function wo(t=1,e){e=e||new O(3);const r=Math.random()*2*Math.PI,n=Math.random()*2-1,s=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=n*t,e}function bo(t){return t=t||new O(3),t[0]=0,t[1]=0,t[2]=0,t}function vo(t,e,r){r=r||new O(3);const n=t[0],s=t[1],i=t[2],o=e[3]*n+e[7]*s+e[11]*i+e[15]||1;return r[0]=(e[0]*n+e[4]*s+e[8]*i+e[12])/o,r[1]=(e[1]*n+e[5]*s+e[9]*i+e[13])/o,r[2]=(e[2]*n+e[6]*s+e[10]*i+e[14])/o,r}function xo(t,e,r){r=r||new O(3);const n=t[0],s=t[1],i=t[2];return r[0]=n*e[0*4+0]+s*e[1*4+0]+i*e[2*4+0],r[1]=n*e[0*4+1]+s*e[1*4+1]+i*e[2*4+1],r[2]=n*e[0*4+2]+s*e[1*4+2]+i*e[2*4+2],r}function ko(t,e,r){r=r||new O(3);const n=t[0],s=t[1],i=t[2];return r[0]=n*e[0]+s*e[4]+i*e[8],r[1]=n*e[1]+s*e[5]+i*e[9],r[2]=n*e[2]+s*e[6]+i*e[10],r}function So(t,e,r){r=r||new O(3);const n=e[0],s=e[1],i=e[2],o=e[3]*2,a=t[0],u=t[1],c=t[2],h=s*c-i*u,d=i*a-n*c,m=n*u-s*a;return r[0]=a+h*o+(s*m-i*d)*2,r[1]=u+d*o+(i*h-n*m)*2,r[2]=c+m*o+(n*d-s*h)*2,r}function Eo(t,e){return e=e||new O(3),e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function To(t,e,r){r=r||new O(3);const n=e*4;return r[0]=t[n+0],r[1]=t[n+1],r[2]=t[n+2],r}function Ao(t,e){e=e||new O(3);const r=t[0],n=t[1],s=t[2],i=t[4],o=t[5],a=t[6],u=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(r*r+n*n+s*s),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(u*u+c*c+h*h),e}function Mo(t,e,r,n){n=n||new O(3);const s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Co(t,e,r,n){n=n||new O(3);const s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Oo(t,e,r,n){n=n||new O(3);const s=[],i=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Kr(t,e,r){return r=r||new O(3),ue(t,r),Ft(r,e,r)}function No(t,e,r){return r=r||new O(3),Ut(t)>e?Kr(t,e,r):Vt(t,r)}function Bo(t,e,r){return r=r||new O(3),qr(t,e,.5,r)}var Q=Object.freeze({__proto__:null,add:Zi,addScaled:eo,angle:to,ceil:Wi,clamp:Qi,clone:_o,copy:Vt,create:re,cross:me,dist:fo,distSq:po,distance:Xr,distanceSq:Yr,div:yo,divScalar:co,divide:Jr,dot:Gt,equals:so,equalsApproximately:no,floor:Ji,fromValues:Xi,getAxis:To,getScaling:Ao,getTranslation:Eo,inverse:Hr,invert:lo,len:jr,lenSq:ho,length:Ut,lengthSq:$r,lerp:qr,lerpV:io,max:oo,midpoint:Bo,min:ao,mul:go,mulScalar:Ft,multiply:Wr,negate:mo,normalize:ue,random:wo,rotateX:Mo,rotateY:Co,rotateZ:Oo,round:Ki,scale:uo,set:Yi,setDefaultType:Us,setLength:Kr,sub:ro,subtract:Ze,transformMat3:ko,transformMat4:vo,transformMat4Upper3x3:xo,transformQuat:So,truncate:No,zero:bo});let I=Float32Array;function Io(t){const e=I;return I=t,e}function zo(t,e,r,n,s,i,o,a,u,c,h,d,m,g,b,y){const w=new I(16);return t!==void 0&&(w[0]=t,e!==void 0&&(w[1]=e,r!==void 0&&(w[2]=r,n!==void 0&&(w[3]=n,s!==void 0&&(w[4]=s,i!==void 0&&(w[5]=i,o!==void 0&&(w[6]=o,a!==void 0&&(w[7]=a,u!==void 0&&(w[8]=u,c!==void 0&&(w[9]=c,h!==void 0&&(w[10]=h,d!==void 0&&(w[11]=d,m!==void 0&&(w[12]=m,g!==void 0&&(w[13]=g,b!==void 0&&(w[14]=b,y!==void 0&&(w[15]=y)))))))))))))))),w}function Lo(t,e,r,n,s,i,o,a,u,c,h,d,m,g,b,y,w){return w=w||new I(16),w[0]=t,w[1]=e,w[2]=r,w[3]=n,w[4]=s,w[5]=i,w[6]=o,w[7]=a,w[8]=u,w[9]=c,w[10]=h,w[11]=d,w[12]=m,w[13]=g,w[14]=b,w[15]=y,w}function Po(t,e){return e=e||new I(16),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=0,e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ro(t,e){e=e||new I(16);const r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,u=s+s,c=r*o,h=n*o,d=n*a,m=s*o,g=s*a,b=s*u,y=i*o,w=i*a,S=i*u;return e[0]=1-d-b,e[1]=h+S,e[2]=m-w,e[3]=0,e[4]=h-S,e[5]=1-c-b,e[6]=g+y,e[7]=0,e[8]=m+w,e[9]=g-y,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fo(t,e){return e=e||new I(16),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e}function Dt(t,e){return e=e||new I(16),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}const Go=Dt;function Uo(t,e){return Math.abs(t[0]-e[0])<C&&Math.abs(t[1]-e[1])<C&&Math.abs(t[2]-e[2])<C&&Math.abs(t[3]-e[3])<C&&Math.abs(t[4]-e[4])<C&&Math.abs(t[5]-e[5])<C&&Math.abs(t[6]-e[6])<C&&Math.abs(t[7]-e[7])<C&&Math.abs(t[8]-e[8])<C&&Math.abs(t[9]-e[9])<C&&Math.abs(t[10]-e[10])<C&&Math.abs(t[11]-e[11])<C&&Math.abs(t[12]-e[12])<C&&Math.abs(t[13]-e[13])<C&&Math.abs(t[14]-e[14])<C&&Math.abs(t[15]-e[15])<C}function Vo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Qr(t){return t=t||new I(16),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Do(t,e){if(e=e||new I(16),e===t){let E;return E=t[1],t[1]=t[4],t[4]=E,E=t[2],t[2]=t[8],t[8]=E,E=t[3],t[3]=t[12],t[12]=E,E=t[6],t[6]=t[9],t[9]=E,E=t[7],t[7]=t[13],t[13]=E,E=t[11],t[11]=t[14],t[14]=E,e}const r=t[0*4+0],n=t[0*4+1],s=t[0*4+2],i=t[0*4+3],o=t[1*4+0],a=t[1*4+1],u=t[1*4+2],c=t[1*4+3],h=t[2*4+0],d=t[2*4+1],m=t[2*4+2],g=t[2*4+3],b=t[3*4+0],y=t[3*4+1],w=t[3*4+2],S=t[3*4+3];return e[0]=r,e[1]=o,e[2]=h,e[3]=b,e[4]=n,e[5]=a,e[6]=d,e[7]=y,e[8]=s,e[9]=u,e[10]=m,e[11]=w,e[12]=i,e[13]=c,e[14]=g,e[15]=S,e}function Zr(t,e){e=e||new I(16);const r=t[0*4+0],n=t[0*4+1],s=t[0*4+2],i=t[0*4+3],o=t[1*4+0],a=t[1*4+1],u=t[1*4+2],c=t[1*4+3],h=t[2*4+0],d=t[2*4+1],m=t[2*4+2],g=t[2*4+3],b=t[3*4+0],y=t[3*4+1],w=t[3*4+2],S=t[3*4+3],E=m*S,A=w*g,M=u*S,N=w*c,L=u*g,G=m*c,X=s*S,J=w*i,Y=s*g,T=m*i,D=s*c,ee=u*i,R=h*y,K=b*d,ie=o*y,ae=b*a,te=o*d,At=h*a,Mt=r*y,Ct=b*n,Ot=r*d,Nt=h*n,Bt=r*a,It=o*n,Ls=E*a+N*d+L*y-(A*a+M*d+G*y),Ps=A*n+X*d+T*y-(E*n+J*d+Y*y),Rs=M*n+J*a+D*y-(N*n+X*a+ee*y),Fs=G*n+Y*a+ee*d-(L*n+T*a+D*d),oe=1/(r*Ls+o*Ps+h*Rs+b*Fs);return e[0]=oe*Ls,e[1]=oe*Ps,e[2]=oe*Rs,e[3]=oe*Fs,e[4]=oe*(A*o+M*h+G*b-(E*o+N*h+L*b)),e[5]=oe*(E*r+J*h+Y*b-(A*r+X*h+T*b)),e[6]=oe*(N*r+X*o+ee*b-(M*r+J*o+D*b)),e[7]=oe*(L*r+T*o+D*h-(G*r+Y*o+ee*h)),e[8]=oe*(R*c+ae*g+te*S-(K*c+ie*g+At*S)),e[9]=oe*(K*i+Mt*g+Nt*S-(R*i+Ct*g+Ot*S)),e[10]=oe*(ie*i+Ct*c+Bt*S-(ae*i+Mt*c+It*S)),e[11]=oe*(At*i+Ot*c+It*g-(te*i+Nt*c+Bt*g)),e[12]=oe*(ie*m+At*w+K*u-(te*w+R*u+ae*m)),e[13]=oe*(Ot*w+R*s+Ct*m-(Mt*m+Nt*w+K*s)),e[14]=oe*(Mt*u+It*w+ae*s-(Bt*w+ie*s+Ct*u)),e[15]=oe*(Bt*m+te*s+Nt*u-(Ot*u+It*m+At*s)),e}function qo(t){const e=t[0],r=t[0*4+1],n=t[0*4+2],s=t[0*4+3],i=t[1*4+0],o=t[1*4+1],a=t[1*4+2],u=t[1*4+3],c=t[2*4+0],h=t[2*4+1],d=t[2*4+2],m=t[2*4+3],g=t[3*4+0],b=t[3*4+1],y=t[3*4+2],w=t[3*4+3],S=d*w,E=y*m,A=a*w,M=y*u,N=a*m,L=d*u,G=n*w,X=y*s,J=n*m,Y=d*s,T=n*u,D=a*s,ee=S*o+M*h+N*b-(E*o+A*h+L*b),R=E*r+G*h+Y*b-(S*r+X*h+J*b),K=A*r+X*o+T*b-(M*r+G*o+D*b),ie=L*r+J*o+D*h-(N*r+Y*o+T*h);return e*ee+i*R+c*K+g*ie}const Ho=Zr;function en(t,e,r){r=r||new I(16);const n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],h=t[7],d=t[8],m=t[9],g=t[10],b=t[11],y=t[12],w=t[13],S=t[14],E=t[15],A=e[0],M=e[1],N=e[2],L=e[3],G=e[4],X=e[5],J=e[6],Y=e[7],T=e[8],D=e[9],ee=e[10],R=e[11],K=e[12],ie=e[13],ae=e[14],te=e[15];return r[0]=n*A+a*M+d*N+y*L,r[1]=s*A+u*M+m*N+w*L,r[2]=i*A+c*M+g*N+S*L,r[3]=o*A+h*M+b*N+E*L,r[4]=n*G+a*X+d*J+y*Y,r[5]=s*G+u*X+m*J+w*Y,r[6]=i*G+c*X+g*J+S*Y,r[7]=o*G+h*X+b*J+E*Y,r[8]=n*T+a*D+d*ee+y*R,r[9]=s*T+u*D+m*ee+w*R,r[10]=i*T+c*D+g*ee+S*R,r[11]=o*T+h*D+b*ee+E*R,r[12]=n*K+a*ie+d*ae+y*te,r[13]=s*K+u*ie+m*ae+w*te,r[14]=i*K+c*ie+g*ae+S*te,r[15]=o*K+h*ie+b*ae+E*te,r}const jo=en;function $o(t,e,r){return r=r||Qr(),t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11]),r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Xo(t,e){return e=e||re(),e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Yo(t,e,r){r=r||re();const n=e*4;return r[0]=t[n+0],r[1]=t[n+1],r[2]=t[n+2],r}function Wo(t,e,r,n){n!==t&&(n=Dt(t,n));const s=r*4;return n[s+0]=e[0],n[s+1]=e[1],n[s+2]=e[2],n}function Jo(t,e){e=e||re();const r=t[0],n=t[1],s=t[2],i=t[4],o=t[5],a=t[6],u=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(r*r+n*n+s*s),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(u*u+c*c+h*h),e}function Ko(t,e,r,n,s){s=s||new I(16);const i=Math.tan(Math.PI*.5-.5*t);if(s[0]=i/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,n===1/0)s[10]=-1,s[14]=-r;else{const o=1/(r-n);s[10]=n*o,s[14]=n*r*o}return s}function Qo(t,e,r,n,s,i,o){return o=o||new I(16),o[0]=2/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/(n-r),o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1/(s-i),o[11]=0,o[12]=(e+t)/(t-e),o[13]=(n+r)/(r-n),o[14]=s/(s-i),o[15]=1,o}function Zo(t,e,r,n,s,i,o){o=o||new I(16);const a=e-t,u=n-r,c=s-i;return o[0]=2*s/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*s/u,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(n+r)/u,o[10]=i/c,o[11]=-1,o[12]=0,o[13]=0,o[14]=s*i/c,o[15]=0,o}let U,j,P;function ea(t,e,r,n){return n=n||new I(16),U=U||re(),j=j||re(),P=P||re(),ue(Ze(e,t,P),P),ue(me(r,P,U),U),ue(me(P,U,j),j),n[0]=U[0],n[1]=U[1],n[2]=U[2],n[3]=0,n[4]=j[0],n[5]=j[1],n[6]=j[2],n[7]=0,n[8]=P[0],n[9]=P[1],n[10]=P[2],n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function ta(t,e,r,n){return n=n||new I(16),U=U||re(),j=j||re(),P=P||re(),ue(Ze(t,e,P),P),ue(me(r,P,U),U),ue(me(P,U,j),j),n[0]=U[0],n[1]=U[1],n[2]=U[2],n[3]=0,n[4]=j[0],n[5]=j[1],n[6]=j[2],n[7]=0,n[8]=P[0],n[9]=P[1],n[10]=P[2],n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}function ra(t,e,r,n){return n=n||new I(16),U=U||re(),j=j||re(),P=P||re(),ue(Ze(t,e,P),P),ue(me(r,P,U),U),ue(me(P,U,j),j),n[0]=U[0],n[1]=j[0],n[2]=P[0],n[3]=0,n[4]=U[1],n[5]=j[1],n[6]=P[1],n[7]=0,n[8]=U[2],n[9]=j[2],n[10]=P[2],n[11]=0,n[12]=-(U[0]*t[0]+U[1]*t[1]+U[2]*t[2]),n[13]=-(j[0]*t[0]+j[1]*t[1]+j[2]*t[2]),n[14]=-(P[0]*t[0]+P[1]*t[1]+P[2]*t[2]),n[15]=1,n}function na(t,e){return e=e||new I(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function sa(t,e,r){r=r||new I(16);const n=e[0],s=e[1],i=e[2],o=t[0],a=t[1],u=t[2],c=t[3],h=t[1*4+0],d=t[1*4+1],m=t[1*4+2],g=t[1*4+3],b=t[2*4+0],y=t[2*4+1],w=t[2*4+2],S=t[2*4+3],E=t[3*4+0],A=t[3*4+1],M=t[3*4+2],N=t[3*4+3];return t!==r&&(r[0]=o,r[1]=a,r[2]=u,r[3]=c,r[4]=h,r[5]=d,r[6]=m,r[7]=g,r[8]=b,r[9]=y,r[10]=w,r[11]=S),r[12]=o*n+h*s+b*i+E,r[13]=a*n+d*s+y*i+A,r[14]=u*n+m*s+w*i+M,r[15]=c*n+g*s+S*i+N,r}function ia(t,e){e=e||new I(16);const r=Math.cos(t),n=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function oa(t,e,r){r=r||new I(16);const n=t[4],s=t[5],i=t[6],o=t[7],a=t[8],u=t[9],c=t[10],h=t[11],d=Math.cos(e),m=Math.sin(e);return r[4]=d*n+m*a,r[5]=d*s+m*u,r[6]=d*i+m*c,r[7]=d*o+m*h,r[8]=d*a-m*n,r[9]=d*u-m*s,r[10]=d*c-m*i,r[11]=d*h-m*o,t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function aa(t,e){e=e||new I(16);const r=Math.cos(t),n=Math.sin(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ua(t,e,r){r=r||new I(16);const n=t[0*4+0],s=t[0*4+1],i=t[0*4+2],o=t[0*4+3],a=t[2*4+0],u=t[2*4+1],c=t[2*4+2],h=t[2*4+3],d=Math.cos(e),m=Math.sin(e);return r[0]=d*n-m*a,r[1]=d*s-m*u,r[2]=d*i-m*c,r[3]=d*o-m*h,r[8]=d*a+m*n,r[9]=d*u+m*s,r[10]=d*c+m*i,r[11]=d*h+m*o,t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function ca(t,e){e=e||new I(16);const r=Math.cos(t),n=Math.sin(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function la(t,e,r){r=r||new I(16);const n=t[0*4+0],s=t[0*4+1],i=t[0*4+2],o=t[0*4+3],a=t[1*4+0],u=t[1*4+1],c=t[1*4+2],h=t[1*4+3],d=Math.cos(e),m=Math.sin(e);return r[0]=d*n+m*a,r[1]=d*s+m*u,r[2]=d*i+m*c,r[3]=d*o+m*h,r[4]=d*a-m*n,r[5]=d*u-m*s,r[6]=d*c-m*i,r[7]=d*h-m*o,t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function tn(t,e,r){r=r||new I(16);let n=t[0],s=t[1],i=t[2];const o=Math.sqrt(n*n+s*s+i*i);n/=o,s/=o,i/=o;const a=n*n,u=s*s,c=i*i,h=Math.cos(e),d=Math.sin(e),m=1-h;return r[0]=a+(1-a)*h,r[1]=n*s*m+i*d,r[2]=n*i*m-s*d,r[3]=0,r[4]=n*s*m-i*d,r[5]=u+(1-u)*h,r[6]=s*i*m+n*d,r[7]=0,r[8]=n*i*m+s*d,r[9]=s*i*m-n*d,r[10]=c+(1-c)*h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}const ha=tn;function rn(t,e,r,n){n=n||new I(16);let s=e[0],i=e[1],o=e[2];const a=Math.sqrt(s*s+i*i+o*o);s/=a,i/=a,o/=a;const u=s*s,c=i*i,h=o*o,d=Math.cos(r),m=Math.sin(r),g=1-d,b=u+(1-u)*d,y=s*i*g+o*m,w=s*o*g-i*m,S=s*i*g-o*m,E=c+(1-c)*d,A=i*o*g+s*m,M=s*o*g+i*m,N=i*o*g-s*m,L=h+(1-h)*d,G=t[0],X=t[1],J=t[2],Y=t[3],T=t[4],D=t[5],ee=t[6],R=t[7],K=t[8],ie=t[9],ae=t[10],te=t[11];return n[0]=b*G+y*T+w*K,n[1]=b*X+y*D+w*ie,n[2]=b*J+y*ee+w*ae,n[3]=b*Y+y*R+w*te,n[4]=S*G+E*T+A*K,n[5]=S*X+E*D+A*ie,n[6]=S*J+E*ee+A*ae,n[7]=S*Y+E*R+A*te,n[8]=M*G+N*T+L*K,n[9]=M*X+N*D+L*ie,n[10]=M*J+N*ee+L*ae,n[11]=M*Y+N*R+L*te,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}const da=rn;function fa(t,e){return e=e||new I(16),e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pa(t,e,r){r=r||new I(16);const n=e[0],s=e[1],i=e[2];return r[0]=n*t[0*4+0],r[1]=n*t[0*4+1],r[2]=n*t[0*4+2],r[3]=n*t[0*4+3],r[4]=s*t[1*4+0],r[5]=s*t[1*4+1],r[6]=s*t[1*4+2],r[7]=s*t[1*4+3],r[8]=i*t[2*4+0],r[9]=i*t[2*4+1],r[10]=i*t[2*4+2],r[11]=i*t[2*4+3],t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function ma(t,e){return e=e||new I(16),e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _a(t,e,r){return r=r||new I(16),r[0]=e*t[0*4+0],r[1]=e*t[0*4+1],r[2]=e*t[0*4+2],r[3]=e*t[0*4+3],r[4]=e*t[1*4+0],r[5]=e*t[1*4+1],r[6]=e*t[1*4+2],r[7]=e*t[1*4+3],r[8]=e*t[2*4+0],r[9]=e*t[2*4+1],r[10]=e*t[2*4+2],r[11]=e*t[2*4+3],t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}var V=Object.freeze({__proto__:null,aim:ea,axisRotate:rn,axisRotation:tn,cameraAim:ta,clone:Go,copy:Dt,create:zo,determinant:qo,equals:Vo,equalsApproximately:Uo,fromMat3:Po,fromQuat:Ro,frustum:Zo,getAxis:Yo,getScaling:Jo,getTranslation:Xo,identity:Qr,inverse:Zr,invert:Ho,lookAt:ra,mul:jo,multiply:en,negate:Fo,ortho:Qo,perspective:Ko,rotate:da,rotateX:oa,rotateY:ua,rotateZ:la,rotation:ha,rotationX:ia,rotationY:aa,rotationZ:ca,scale:pa,scaling:fa,set:Lo,setAxis:Wo,setDefaultType:Io,setTranslation:$o,translate:sa,translation:na,transpose:Do,uniformScale:_a,uniformScaling:ma});let q=Float32Array;function ga(t){const e=q;return q=t,e}function nn(t,e,r,n){const s=new q(4);return t!==void 0&&(s[0]=t,e!==void 0&&(s[1]=e,r!==void 0&&(s[2]=r,n!==void 0&&(s[3]=n)))),s}const ya=nn;function wa(t,e,r,n,s){return s=s||new q(4),s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function sn(t,e,r){r=r||new q(4);const n=e*.5,s=Math.sin(n);return r[0]=s*t[0],r[1]=s*t[1],r[2]=s*t[2],r[3]=Math.cos(n),r}function ba(t,e){e=e||re(4);const r=Math.acos(t[3])*2,n=Math.sin(r*.5);return n>C?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),{angle:r,axis:e}}function va(t,e){const r=ln(t,e);return Math.acos(2*r*r-1)}function on(t,e,r){r=r||new q(4);const n=t[0],s=t[1],i=t[2],o=t[3],a=e[0],u=e[1],c=e[2],h=e[3];return r[0]=n*h+o*a+s*c-i*u,r[1]=s*h+o*u+i*a-n*c,r[2]=i*h+o*c+n*u-s*a,r[3]=o*h-n*a-s*u-i*c,r}const xa=on;function ka(t,e,r){r=r||new q(4);const n=e*.5,s=t[0],i=t[1],o=t[2],a=t[3],u=Math.sin(n),c=Math.cos(n);return r[0]=s*c+a*u,r[1]=i*c+o*u,r[2]=o*c-i*u,r[3]=a*c-s*u,r}function Sa(t,e,r){r=r||new q(4);const n=e*.5,s=t[0],i=t[1],o=t[2],a=t[3],u=Math.sin(n),c=Math.cos(n);return r[0]=s*c-o*u,r[1]=i*c+a*u,r[2]=o*c+s*u,r[3]=a*c-i*u,r}function Ea(t,e,r){r=r||new q(4);const n=e*.5,s=t[0],i=t[1],o=t[2],a=t[3],u=Math.sin(n),c=Math.cos(n);return r[0]=s*c+i*u,r[1]=i*c-s*u,r[2]=o*c+a*u,r[3]=a*c-o*u,r}function dt(t,e,r,n){n=n||new q(4);const s=t[0],i=t[1],o=t[2],a=t[3];let u=e[0],c=e[1],h=e[2],d=e[3],m=s*u+i*c+o*h+a*d;m<0&&(m=-m,u=-u,c=-c,h=-h,d=-d);let g,b;if(1-m>C){const y=Math.acos(m),w=Math.sin(y);g=Math.sin((1-r)*y)/w,b=Math.sin(r*y)/w}else g=1-r,b=r;return n[0]=g*s+b*u,n[1]=g*i+b*c,n[2]=g*o+b*h,n[3]=g*a+b*d,n}function Ta(t,e){e=e||new q(4);const r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i,a=o?1/o:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-s*a,e[3]=i*a,e}function Aa(t,e){return e=e||new q(4),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Ma(t,e){e=e||new q(4);const r=t[0]+t[5]+t[10];if(r>0){const n=Math.sqrt(r+1);e[3]=.5*n;const s=.5/n;e[0]=(t[6]-t[9])*s,e[1]=(t[8]-t[2])*s,e[2]=(t[1]-t[4])*s}else{let n=0;t[5]>t[0]&&(n=1),t[10]>t[n*4+n]&&(n=2);const s=(n+1)%3,i=(n+2)%3,o=Math.sqrt(t[n*4+n]-t[s*4+s]-t[i*4+i]+1);e[n]=.5*o;const a=.5/o;e[3]=(t[s*4+i]-t[i*4+s])*a,e[s]=(t[s*4+n]+t[n*4+s])*a,e[i]=(t[i*4+n]+t[n*4+i])*a}return e}function Ca(t,e,r,n,s){s=s||new q(4);const i=t*.5,o=e*.5,a=r*.5,u=Math.sin(i),c=Math.cos(i),h=Math.sin(o),d=Math.cos(o),m=Math.sin(a),g=Math.cos(a);switch(n){case"xyz":s[0]=u*d*g+c*h*m,s[1]=c*h*g-u*d*m,s[2]=c*d*m+u*h*g,s[3]=c*d*g-u*h*m;break;case"xzy":s[0]=u*d*g-c*h*m,s[1]=c*h*g-u*d*m,s[2]=c*d*m+u*h*g,s[3]=c*d*g+u*h*m;break;case"yxz":s[0]=u*d*g+c*h*m,s[1]=c*h*g-u*d*m,s[2]=c*d*m-u*h*g,s[3]=c*d*g+u*h*m;break;case"yzx":s[0]=u*d*g+c*h*m,s[1]=c*h*g+u*d*m,s[2]=c*d*m-u*h*g,s[3]=c*d*g-u*h*m;break;case"zxy":s[0]=u*d*g-c*h*m,s[1]=c*h*g+u*d*m,s[2]=c*d*m+u*h*g,s[3]=c*d*g-u*h*m;break;case"zyx":s[0]=u*d*g-c*h*m,s[1]=c*h*g+u*d*m,s[2]=c*d*m-u*h*g,s[3]=c*d*g+u*h*m;break;default:throw new Error(`Unknown rotation order: ${n}`)}return s}function an(t,e){return e=e||new q(4),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}const Oa=an;function Na(t,e,r){return r=r||new q(4),r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function un(t,e,r){return r=r||new q(4),r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r}const Ba=un;function cn(t,e,r){return r=r||new q(4),r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}const Ia=cn;function za(t,e,r){return r=r||new q(4),r[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e,r[3]=t[3]/e,r}function ln(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function La(t,e,r,n){return n=n||new q(4),n[0]=t[0]+r*(e[0]-t[0]),n[1]=t[1]+r*(e[1]-t[1]),n[2]=t[2]+r*(e[2]-t[2]),n[3]=t[3]+r*(e[3]-t[3]),n}function hn(t){const e=t[0],r=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+r*r+n*n+s*s)}const Pa=hn;function dn(t){const e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}const Ra=dn;function fn(t,e){e=e||new q(4);const r=t[0],n=t[1],s=t[2],i=t[3],o=Math.sqrt(r*r+n*n+s*s+i*i);return o>1e-5?(e[0]=r/o,e[1]=n/o,e[2]=s/o,e[3]=i/o):(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Fa(t,e){return Math.abs(t[0]-e[0])<C&&Math.abs(t[1]-e[1])<C&&Math.abs(t[2]-e[2])<C&&Math.abs(t[3]-e[3])<C}function Ga(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Ua(t){return t=t||new q(4),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}let ce,qt,Ht;function Va(t,e,r){r=r||new q(4),ce=ce||re(),qt=qt||re(1,0,0),Ht=Ht||re(0,1,0);const n=Gt(t,e);return n<-.999999?(me(qt,t,ce),jr(ce)<1e-6&&me(Ht,t,ce),ue(ce,ce),sn(ce,Math.PI,r),r):n>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(me(t,e,ce),r[0]=ce[0],r[1]=ce[1],r[2]=ce[2],r[3]=1+n,fn(r,r))}let ft,pt;function Da(t,e,r,n,s,i){return i=i||new q(4),ft=ft||new q(4),pt=pt||new q(4),dt(t,n,s,ft),dt(e,r,s,pt),dt(ft,pt,2*s*(1-s),i),i}var Ue=Object.freeze({__proto__:null,add:Na,angle:va,clone:Oa,conjugate:Aa,copy:an,create:nn,divScalar:za,dot:ln,equals:Ga,equalsApproximately:Fa,fromAxisAngle:sn,fromEuler:Ca,fromMat:Ma,fromValues:ya,identity:Ua,inverse:Ta,len:Pa,lenSq:Ra,length:hn,lengthSq:dn,lerp:La,mul:xa,mulScalar:cn,multiply:on,normalize:fn,rotateX:ka,rotateY:Sa,rotateZ:Ea,rotationTo:Va,scale:Ia,set:wa,setDefaultType:ga,slerp:dt,sqlerp:Da,sub:Ba,subtract:un,toAxisAngle:ba});let F=Float32Array;function qa(t){const e=F;return F=t,e}function pn(t,e,r,n){const s=new F(4);return t!==void 0&&(s[0]=t,e!==void 0&&(s[1]=e,r!==void 0&&(s[2]=r,n!==void 0&&(s[3]=n)))),s}const Ha=pn;function ja(t,e,r,n,s){return s=s||new F(4),s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function $a(t,e){return e=e||new F(4),e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Xa(t,e){return e=e||new F(4),e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Ya(t,e){return e=e||new F(4),e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Wa(t,e=0,r=1,n){return n=n||new F(4),n[0]=Math.min(r,Math.max(e,t[0])),n[1]=Math.min(r,Math.max(e,t[1])),n[2]=Math.min(r,Math.max(e,t[2])),n[3]=Math.min(r,Math.max(e,t[3])),n}function Ja(t,e,r){return r=r||new F(4),r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function Ka(t,e,r,n){return n=n||new F(4),n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n[3]=t[3]+e[3]*r,n}function mn(t,e,r){return r=r||new F(4),r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r}const Qa=mn;function Za(t,e){return Math.abs(t[0]-e[0])<C&&Math.abs(t[1]-e[1])<C&&Math.abs(t[2]-e[2])<C&&Math.abs(t[3]-e[3])<C}function eu(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _n(t,e,r,n){return n=n||new F(4),n[0]=t[0]+r*(e[0]-t[0]),n[1]=t[1]+r*(e[1]-t[1]),n[2]=t[2]+r*(e[2]-t[2]),n[3]=t[3]+r*(e[3]-t[3]),n}function tu(t,e,r,n){return n=n||new F(4),n[0]=t[0]+r[0]*(e[0]-t[0]),n[1]=t[1]+r[1]*(e[1]-t[1]),n[2]=t[2]+r[2]*(e[2]-t[2]),n[3]=t[3]+r[3]*(e[3]-t[3]),n}function ru(t,e,r){return r=r||new F(4),r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3]),r}function nu(t,e,r){return r=r||new F(4),r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r[3]=Math.min(t[3],e[3]),r}function jt(t,e,r){return r=r||new F(4),r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}const su=jt;function iu(t,e,r){return r=r||new F(4),r[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e,r[3]=t[3]/e,r}function gn(t,e){return e=e||new F(4),e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}const ou=gn;function au(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function $t(t){const e=t[0],r=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+r*r+n*n+s*s)}const uu=$t;function yn(t){const e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}const cu=yn;function wn(t,e){const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(r*r+n*n+s*s+i*i)}const lu=wn;function bn(t,e){const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+s*s+i*i}const hu=bn;function vn(t,e){e=e||new F(4);const r=t[0],n=t[1],s=t[2],i=t[3],o=Math.sqrt(r*r+n*n+s*s+i*i);return o>1e-5?(e[0]=r/o,e[1]=n/o,e[2]=s/o,e[3]=i/o):(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function du(t,e){return e=e||new F(4),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Xt(t,e){return e=e||new F(4),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}const fu=Xt;function xn(t,e,r){return r=r||new F(4),r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r[3]=t[3]*e[3],r}const pu=xn;function kn(t,e,r){return r=r||new F(4),r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r[3]=t[3]/e[3],r}const mu=kn;function _u(t){return t=t||new F(4),t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function gu(t,e,r){r=r||new F(4);const n=t[0],s=t[1],i=t[2],o=t[3];return r[0]=e[0]*n+e[4]*s+e[8]*i+e[12]*o,r[1]=e[1]*n+e[5]*s+e[9]*i+e[13]*o,r[2]=e[2]*n+e[6]*s+e[10]*i+e[14]*o,r[3]=e[3]*n+e[7]*s+e[11]*i+e[15]*o,r}function Sn(t,e,r){return r=r||new F(4),vn(t,r),jt(r,e,r)}function yu(t,e,r){return r=r||new F(4),$t(t)>e?Sn(t,e,r):Xt(t,r)}function wu(t,e,r){return r=r||new F(4),_n(t,e,.5,r)}var ke=Object.freeze({__proto__:null,add:Ja,addScaled:Ka,ceil:$a,clamp:Wa,clone:fu,copy:Xt,create:pn,dist:lu,distSq:hu,distance:wn,distanceSq:bn,div:mu,divScalar:iu,divide:kn,dot:au,equals:eu,equalsApproximately:Za,floor:Xa,fromValues:Ha,inverse:gn,invert:ou,len:uu,lenSq:cu,length:$t,lengthSq:yn,lerp:_n,lerpV:tu,max:ru,midpoint:wu,min:nu,mul:pu,mulScalar:jt,multiply:xn,negate:du,normalize:vn,round:Ya,scale:su,set:ja,setDefaultType:qa,setLength:Sn,sub:Qa,subtract:mn,transformMat4:gu,truncate:yu,zero:_u});class Yt{constructor(){k(this,"pipelineCount",0);k(this,"pipelineSets",0);k(this,"bindGroupCount",0);k(this,"bindGroupSets",0);k(this,"bufferSets",0);k(this,"drawCount",0)}}class Wt{constructor(e){k(this,"texture",null);k(this,"format",null);this.color=e}setFormat(e){this.format=e}async uploadTexture(e){var n;if(!this.format)return;const r=new Uint8Array([this.color.r*255,this.color.g*255,this.color.b*255,this.color.a*255]);(n=this.texture)==null||n.destroy(),this.texture=e.createTexture({size:[1,1],format:this.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),e.queue.writeTexture({texture:this.texture},r,{},{width:1,height:1})}}const Be=class Be{static async upload(e){return Promise.all([Be.defaultNormalTexture.uploadTexture(e),Be.transparentBlackTexture.uploadTexture(e),Be.opaqueWhiteTexture.uploadTexture(e)])}};k(Be,"opaqueWhiteTexture",new Wt({r:1,g:1,b:1,a:1})),k(Be,"transparentBlackTexture",new Wt({r:0,g:0,b:0,a:0})),k(Be,"defaultNormalTexture",new Wt({r:.5,g:.5,b:1,a:1}));let Se=Be;var Ee=(t=>(t[t.POSITION=0]="POSITION",t[t.NORMAL=1]="NORMAL",t[t.TEXCOORD_0=2]="TEXCOORD_0",t[t.TANGENT=3]="TANGENT",t))(Ee||{});const et="tf",En="mtfInstances",tt="lightCollection",Tn=`
struct Transformation {
  projectionMatrix: mat4x4f,
  viewMatrix: mat4x4f,
  cameraPosition: vec3f,
};

@group(0) @binding(0) var<uniform> ${et}: Transformation;
`,An=`
struct InputLight {
  dir: vec3f,
  pos: vec3f,
  color: vec4f,
  flux: f32,
  ltype: u32,
};

@group(0) @binding(1) var<storage> ${tt}: array<InputLight>;
`,bu=`
struct MTransformation {
  modelMatrix: mat4x4f,
  normalMatrix: mat4x4f,
};

@group(1) @binding(0) var<storage> ${En}: array<MTransformation>;
`,vu=/#([^\s]*)(\s*)/gm;class Mn{constructor(e){k(this,"elseIsValid",!0);k(this,"branches",[]);this.pushBranch("if",e)}pushBranch(e,r){if(!this.elseIsValid)throw new Error(`#${e} not preceeded by an #if or #elif`);this.elseIsValid=e==="if"||e==="elif",this.branches.push({expression:!!r,string:""})}appendStringToCurrentBranch(...e){for(const r of e)this.branches[this.branches.length-1].string+=r}resolve(){for(const e of this.branches)if(e.expression)return e.string;return""}}function Cn(t,...e){const r=[];let n=new Mn(!0);n.elseIsValid=!1;const s=(i,o)=>{if(i.index+i[0].length!=o.length)throw new Error(`#${i[1]} must be immediately followed by a template expression (ie: \${value})`)};for(let i=0;i<t.length;++i){const o=t[i],a=o.matchAll(vu);let u=0,c=!1;for(const h of a){switch(n.appendStringToCurrentBranch(o.substring(u,h.index)),h[1]){case"if":s(h,o),c=!0,r.push(n),n=new Mn(e[i]);break;case"elif":s(h,o),c=!0,n.pushBranch(h[1],e[i]);break;case"else":n.pushBranch(h[1],!0),n.appendStringToCurrentBranch(h[2]);break;case"endif":if(!r.length)throw new Error(`#${h[1]} not preceeded by an #if`);const d=n.resolve();n=r.pop(),n.appendStringToCurrentBranch(d,h[2]);break;default:n.appendStringToCurrentBranch(h[0]);break}u=h.index+h[0].length}u!=o.length&&n.appendStringToCurrentBranch(o.substring(u,o.length)),!c&&e.length>i&&n.appendStringToCurrentBranch(e[i])}if(r.length)throw new Error("Mismatched #if/#endif count");return n.resolve()}const On=t=>Cn`
struct VertexInput {
  @location(${Ee.POSITION}) position: vec4f,
  @location(${Ee.NORMAL}) normal: vec3f,
#if ${t.useTexcoord}
  @location(${Ee.TEXCOORD_0}) uv0: vec2f,
#endif
};

struct VertexOutput {
  @builtin(position) position: vec4f,
  @location(0) normal: vec3f,
  @location(1) pos: vec3f,
  @location(2) uv0: vec2f,
  @location(3) cameraPos: vec3f
};

${Tn}
${bu}

@vertex
fn main(
  vert: VertexInput, 
  @builtin(instance_index) instanceIndex : u32
) -> VertexOutput {
    var o: VertexOutput;
    let modelTransform = ${En}[instanceIndex];
    let pos = modelTransform.modelMatrix * vert.position;
    o.pos = pos.xyz/pos.w;
    o.cameraPos = ${et}.cameraPosition;
    o.position = ${et}.projectionMatrix * ${et}.viewMatrix * pos;
    o.normal = (modelTransform.normalMatrix * vec4f(vert.normal, 0)).xyz;
    #if ${t.useTexcoord}
      o.uv0 = vert.uv0;
    #else
      o.uv0 = vec2f(0);
    #endif
    return o;
};

`,Jt=(t,e)=>((t+e-1)/e|0)*e;function xu(t){return Object.keys(t)}function ku(t,e){return new Array(t).fill(0).map((r,n)=>e(n))}const Te=t=>t&&typeof t.length=="number"&&t.buffer instanceof ArrayBuffer&&typeof t.byteLength=="number",B={i32:{numElements:1,align:4,size:4,type:"i32",View:Int32Array},u32:{numElements:1,align:4,size:4,type:"u32",View:Uint32Array},f32:{numElements:1,align:4,size:4,type:"f32",View:Float32Array},f16:{numElements:1,align:2,size:2,type:"u16",View:Uint16Array},vec2f:{numElements:2,align:8,size:8,type:"f32",View:Float32Array},vec2i:{numElements:2,align:8,size:8,type:"i32",View:Int32Array},vec2u:{numElements:2,align:8,size:8,type:"u32",View:Uint32Array},vec2h:{numElements:2,align:4,size:4,type:"u16",View:Uint16Array},vec3i:{numElements:3,align:16,size:12,type:"i32",View:Int32Array},vec3u:{numElements:3,align:16,size:12,type:"u32",View:Uint32Array},vec3f:{numElements:3,align:16,size:12,type:"f32",View:Float32Array},vec3h:{numElements:3,align:8,size:6,type:"u16",View:Uint16Array},vec4i:{numElements:4,align:16,size:16,type:"i32",View:Int32Array},vec4u:{numElements:4,align:16,size:16,type:"u32",View:Uint32Array},vec4f:{numElements:4,align:16,size:16,type:"f32",View:Float32Array},vec4h:{numElements:4,align:8,size:8,type:"u16",View:Uint16Array},mat2x2f:{numElements:4,align:8,size:16,type:"f32",View:Float32Array},mat2x2h:{numElements:4,align:4,size:8,type:"u16",View:Uint16Array},mat3x2f:{numElements:6,align:8,size:24,type:"f32",View:Float32Array},mat3x2h:{numElements:6,align:4,size:12,type:"u16",View:Uint16Array},mat4x2f:{numElements:8,align:8,size:32,type:"f32",View:Float32Array},mat4x2h:{numElements:8,align:4,size:16,type:"u16",View:Uint16Array},mat2x3f:{numElements:8,align:16,size:32,pad:[3,1],type:"f32",View:Float32Array},mat2x3h:{numElements:8,align:8,size:16,pad:[3,1],type:"u16",View:Uint16Array},mat3x3f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x3h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x3f:{numElements:16,align:16,size:64,pad:[3,1],type:"f32",View:Float32Array},mat4x3h:{numElements:16,align:8,size:32,pad:[3,1],type:"u16",View:Uint16Array},mat2x4f:{numElements:8,align:16,size:32,type:"f32",View:Float32Array},mat2x4h:{numElements:8,align:8,size:16,type:"u16",View:Uint16Array},mat3x4f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x4h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x4f:{numElements:16,align:16,size:64,type:"f32",View:Float32Array},mat4x4h:{numElements:16,align:8,size:32,type:"u16",View:Uint16Array},bool:{numElements:0,align:1,size:0,type:"bool",View:Uint32Array}},Ve={...B,"atomic<i32>":B.i32,"atomic<u32>":B.u32,"vec2<i32>":B.vec2i,"vec2<u32>":B.vec2u,"vec2<f32>":B.vec2f,"vec2<f16>":B.vec2h,"vec3<i32>":B.vec3i,"vec3<u32>":B.vec3u,"vec3<f32>":B.vec3f,"vec3<f16>":B.vec3h,"vec4<i32>":B.vec4i,"vec4<u32>":B.vec4u,"vec4<f32>":B.vec4f,"vec4<f16>":B.vec4h,"mat2x2<f32>":B.mat2x2f,"mat2x2<f16>":B.mat2x2h,"mat3x2<f32>":B.mat3x2f,"mat3x2<f16>":B.mat3x2h,"mat4x2<f32>":B.mat4x2f,"mat4x2<f16>":B.mat4x2h,"mat2x3<f32>":B.mat2x3f,"mat2x3<f16>":B.mat2x3h,"mat3x3<f32>":B.mat3x3f,"mat3x3<f16>":B.mat3x3h,"mat4x3<f32>":B.mat4x3f,"mat4x3<f16>":B.mat4x3h,"mat2x4<f32>":B.mat2x4f,"mat2x4<f16>":B.mat2x4h,"mat3x4<f32>":B.mat3x4f,"mat3x4<f16>":B.mat3x4h,"mat4x4<f32>":B.mat4x4f,"mat4x4<f16>":B.mat4x4h},Su=xu(Ve);function Eu(t=[],e){const r=new Set;for(const n of Su){const s=Ve[n];r.has(s)||(r.add(s),s.flatten=t.includes(n)?e:!e)}}Eu();function Tu(t){const e=t;if(e.elementType)return e.size;{const r=t,n=e.numElements||1;if(r.fields)return t.size*n;{const s=t,{align:i}=Ve[s.type];return n>1?Jt(t.size,i)*n:t.size}}}function Nn(t,e,r,n){const{size:s,type:i}=t;try{const{View:o,align:a}=Ve[i],u=n!==void 0,c=u?Jt(s,a):s,h=c/o.BYTES_PER_ELEMENT,d=u?n===0?(e.byteLength-r)/c:n:1;return new o(e,r,h*d)}catch{throw new Error(`unknown type: ${i}`)}}function Au(t){return!t.fields&&!t.elementType}function Mu(t,e,r){const n=r||0,s=e||new ArrayBuffer(Tu(t)),i=(o,a)=>{const u=o,c=u.elementType;if(c){if(Au(c)&&Ve[c.type].flatten)return Nn(c,s,a,u.numElements);{const{size:h}=er(o),d=u.numElements===0?(s.byteLength-a)/h:u.numElements;return ku(d,m=>i(c,a+h*m))}}else{if(typeof o=="string")throw Error("unreachable");{const h=o.fields;if(h){const d={};for(const[m,{type:g,offset:b}]of Object.entries(h))d[m]=i(g,a+b);return d}else return Nn(o,s,a)}}};return{views:i(t,n),arrayBuffer:s}}function Kt(t,e){if(t!==void 0)if(Te(e)){const r=e;if(r.length===1&&typeof t=="number")r[0]=t;else if(Array.isArray(t[0])||Te(t[0])){const n=t[0].length,s=n===3?4:n;for(let i=0;i<t.length;++i){const o=i*s;r.set(t[i],o)}}else r.set(t)}else if(Array.isArray(e)){const r=e;t.forEach((n,s)=>{Kt(n,r[s])})}else{const r=e;for(const[n,s]of Object.entries(t)){const i=r[n];i&&Kt(s,i)}}}function Qt(t,e,r=0){const n=t,s=n.group===void 0?t:n.typeDefinition,i=Mu(s,e,r);return{...i,set(o){Kt(o,i.views)}}}function Zt(t){const e=t.elementType;if(e)return Zt(e);const r=t.fields;if(r)return Object.values(r).reduce((i,{type:o})=>Math.max(i,Zt(o)),0);const{type:n}=t,{align:s}=Ve[n];return s}function er(t){const e=t.elementType;if(e){const n=e.size,s=Zt(e);return{unalignedSize:n,align:s,size:Jt(n,s)}}const r=t.fields;if(r){const n=Object.values(r).pop();if(n.type.size===0)return er(n.type)}return{size:0,unalignedSize:0,align:1}}function Cu(t){const e=t,r=e.group===void 0?t:e.typeDefinition;return er(r)}class Ou{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class ve{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,r){if(e){r(mt.instance);for(const n of e)n instanceof Array?this.searchBlock(n,r):n.search(r);r(_t.instance)}}}class mt extends ve{}mt.instance=new mt;class _t extends ve{}_t.instance=new _t;class $ extends ve{constructor(){super()}}let tr=class extends ${constructor(t,e,r,n){super(),this.name=t,this.args=e,this.returnType=r,this.body=n}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}};class Nu extends ${constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Bu extends ${constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Iu extends ${constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class zu extends ${constructor(e,r,n,s){super(),this.init=e,this.condition=r,this.increment=n,this.body=s}get astNodeType(){return"for"}search(e){var r,n,s;(r=this.init)===null||r===void 0||r.search(e),(n=this.condition)===null||n===void 0||n.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class ze extends ${constructor(e,r,n,s,i){super(),this.name=e,this.type=r,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class Bn extends ${constructor(e,r,n){super(),this.name=e,this.type=r,this.value=n}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class rr extends ${constructor(e,r,n,s,i){super(),this.name=e,this.type=r,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"let"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class In extends ${constructor(e,r,n,s,i){super(),this.name=e,this.type=r,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}var De;(function(t){t.increment="++",t.decrement="--"})(De||(De={})),function(t){function e(r){const n=r;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}t.parse=e}(De||(De={}));class Lu extends ${constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var rt;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(rt||(rt={})),function(t){function e(r){const n=r;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}t.parse=e}(rt||(rt={}));class Pu extends ${constructor(e,r,n){super(),this.operator=e,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(e){this.value.search(e)}}class Ru extends ${constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}}class Fu extends ${constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class Gu extends ${constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"body"}}class Uu extends ${constructor(e,r,n,s){super(),this.condition=e,this.body=r,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Vu extends ${constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class Du extends ${constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class zn extends ${constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class qu extends ${constructor(){super()}get astNodeType(){return"discard"}}class Hu extends ${constructor(){super()}get astNodeType(){return"break"}}class ju extends ${constructor(){super()}get astNodeType(){return"continue"}}class Le extends ${constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Pe extends Le{constructor(e,r){super(e),this.members=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}}class Ln extends Le{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"template"}}class $u extends Le{constructor(e,r,n,s){super(e),this.storage=r,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class Pn extends Le{constructor(e,r,n,s){super(e),this.attributes=r,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class nt extends Le{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class _e extends ve{constructor(){super()}}class Rn extends _e{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class st extends _e{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}}class Fn extends _e{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const r of this.args)r.search(e);e(this)}}class Gn extends _e{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this)}}class Un extends _e{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(e){var r,n;if(this.initializer instanceof st){const s=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(e),i=(n=this.initializer.type)===null||n===void 0?void 0:n.name,o=e.structs.get(i),a=o==null?void 0:o.getMemberIndex(s);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class Vn extends _e{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Xu extends _e{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Yu extends _e{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class Dn extends _e{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class qn extends _e{constructor(){super()}}class Wu extends qn{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class ge extends qn{constructor(e,r,n){super(),this.operator=e,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class Hn extends ve{constructor(){super()}}class Ju extends Hn{constructor(e,r){super(),this.selector=e,this.body=r}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class Ku extends Hn{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Qu extends ve{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class Zu extends ve{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ec extends ve{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"member"}}class jn extends ve{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}}var v,f;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(f||(f={}));class p{constructor(e,r,n){this.name=e,this.type=r,this.rule=n}toString(){return this.name}}class l{}v=l,l.none=new p("",f.reserved,""),l.eof=new p("EOF",f.token,""),l.reserved={asm:new p("asm",f.reserved,"asm"),bf16:new p("bf16",f.reserved,"bf16"),do:new p("do",f.reserved,"do"),enum:new p("enum",f.reserved,"enum"),f16:new p("f16",f.reserved,"f16"),f64:new p("f64",f.reserved,"f64"),handle:new p("handle",f.reserved,"handle"),i8:new p("i8",f.reserved,"i8"),i16:new p("i16",f.reserved,"i16"),i64:new p("i64",f.reserved,"i64"),mat:new p("mat",f.reserved,"mat"),premerge:new p("premerge",f.reserved,"premerge"),regardless:new p("regardless",f.reserved,"regardless"),typedef:new p("typedef",f.reserved,"typedef"),u8:new p("u8",f.reserved,"u8"),u16:new p("u16",f.reserved,"u16"),u64:new p("u64",f.reserved,"u64"),unless:new p("unless",f.reserved,"unless"),using:new p("using",f.reserved,"using"),vec:new p("vec",f.reserved,"vec"),void:new p("void",f.reserved,"void")},l.keywords={array:new p("array",f.keyword,"array"),atomic:new p("atomic",f.keyword,"atomic"),bool:new p("bool",f.keyword,"bool"),f32:new p("f32",f.keyword,"f32"),i32:new p("i32",f.keyword,"i32"),mat2x2:new p("mat2x2",f.keyword,"mat2x2"),mat2x3:new p("mat2x3",f.keyword,"mat2x3"),mat2x4:new p("mat2x4",f.keyword,"mat2x4"),mat3x2:new p("mat3x2",f.keyword,"mat3x2"),mat3x3:new p("mat3x3",f.keyword,"mat3x3"),mat3x4:new p("mat3x4",f.keyword,"mat3x4"),mat4x2:new p("mat4x2",f.keyword,"mat4x2"),mat4x3:new p("mat4x3",f.keyword,"mat4x3"),mat4x4:new p("mat4x4",f.keyword,"mat4x4"),ptr:new p("ptr",f.keyword,"ptr"),sampler:new p("sampler",f.keyword,"sampler"),sampler_comparison:new p("sampler_comparison",f.keyword,"sampler_comparison"),struct:new p("struct",f.keyword,"struct"),texture_1d:new p("texture_1d",f.keyword,"texture_1d"),texture_2d:new p("texture_2d",f.keyword,"texture_2d"),texture_2d_array:new p("texture_2d_array",f.keyword,"texture_2d_array"),texture_3d:new p("texture_3d",f.keyword,"texture_3d"),texture_cube:new p("texture_cube",f.keyword,"texture_cube"),texture_cube_array:new p("texture_cube_array",f.keyword,"texture_cube_array"),texture_multisampled_2d:new p("texture_multisampled_2d",f.keyword,"texture_multisampled_2d"),texture_storage_1d:new p("texture_storage_1d",f.keyword,"texture_storage_1d"),texture_storage_2d:new p("texture_storage_2d",f.keyword,"texture_storage_2d"),texture_storage_2d_array:new p("texture_storage_2d_array",f.keyword,"texture_storage_2d_array"),texture_storage_3d:new p("texture_storage_3d",f.keyword,"texture_storage_3d"),texture_depth_2d:new p("texture_depth_2d",f.keyword,"texture_depth_2d"),texture_depth_2d_array:new p("texture_depth_2d_array",f.keyword,"texture_depth_2d_array"),texture_depth_cube:new p("texture_depth_cube",f.keyword,"texture_depth_cube"),texture_depth_cube_array:new p("texture_depth_cube_array",f.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new p("texture_depth_multisampled_2d",f.keyword,"texture_depth_multisampled_2d"),texture_external:new p("texture_external",f.keyword,"texture_external"),u32:new p("u32",f.keyword,"u32"),vec2:new p("vec2",f.keyword,"vec2"),vec3:new p("vec3",f.keyword,"vec3"),vec4:new p("vec4",f.keyword,"vec4"),bitcast:new p("bitcast",f.keyword,"bitcast"),block:new p("block",f.keyword,"block"),break:new p("break",f.keyword,"break"),case:new p("case",f.keyword,"case"),continue:new p("continue",f.keyword,"continue"),continuing:new p("continuing",f.keyword,"continuing"),default:new p("default",f.keyword,"default"),discard:new p("discard",f.keyword,"discard"),else:new p("else",f.keyword,"else"),enable:new p("enable",f.keyword,"enable"),fallthrough:new p("fallthrough",f.keyword,"fallthrough"),false:new p("false",f.keyword,"false"),fn:new p("fn",f.keyword,"fn"),for:new p("for",f.keyword,"for"),function:new p("function",f.keyword,"function"),if:new p("if",f.keyword,"if"),let:new p("let",f.keyword,"let"),const:new p("const",f.keyword,"const"),loop:new p("loop",f.keyword,"loop"),while:new p("while",f.keyword,"while"),private:new p("private",f.keyword,"private"),read:new p("read",f.keyword,"read"),read_write:new p("read_write",f.keyword,"read_write"),return:new p("return",f.keyword,"return"),storage:new p("storage",f.keyword,"storage"),switch:new p("switch",f.keyword,"switch"),true:new p("true",f.keyword,"true"),alias:new p("alias",f.keyword,"alias"),type:new p("type",f.keyword,"type"),uniform:new p("uniform",f.keyword,"uniform"),var:new p("var",f.keyword,"var"),override:new p("override",f.keyword,"override"),workgroup:new p("workgroup",f.keyword,"workgroup"),write:new p("write",f.keyword,"write"),r8unorm:new p("r8unorm",f.keyword,"r8unorm"),r8snorm:new p("r8snorm",f.keyword,"r8snorm"),r8uint:new p("r8uint",f.keyword,"r8uint"),r8sint:new p("r8sint",f.keyword,"r8sint"),r16uint:new p("r16uint",f.keyword,"r16uint"),r16sint:new p("r16sint",f.keyword,"r16sint"),r16float:new p("r16float",f.keyword,"r16float"),rg8unorm:new p("rg8unorm",f.keyword,"rg8unorm"),rg8snorm:new p("rg8snorm",f.keyword,"rg8snorm"),rg8uint:new p("rg8uint",f.keyword,"rg8uint"),rg8sint:new p("rg8sint",f.keyword,"rg8sint"),r32uint:new p("r32uint",f.keyword,"r32uint"),r32sint:new p("r32sint",f.keyword,"r32sint"),r32float:new p("r32float",f.keyword,"r32float"),rg16uint:new p("rg16uint",f.keyword,"rg16uint"),rg16sint:new p("rg16sint",f.keyword,"rg16sint"),rg16float:new p("rg16float",f.keyword,"rg16float"),rgba8unorm:new p("rgba8unorm",f.keyword,"rgba8unorm"),rgba8unorm_srgb:new p("rgba8unorm_srgb",f.keyword,"rgba8unorm_srgb"),rgba8snorm:new p("rgba8snorm",f.keyword,"rgba8snorm"),rgba8uint:new p("rgba8uint",f.keyword,"rgba8uint"),rgba8sint:new p("rgba8sint",f.keyword,"rgba8sint"),bgra8unorm:new p("bgra8unorm",f.keyword,"bgra8unorm"),bgra8unorm_srgb:new p("bgra8unorm_srgb",f.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new p("rgb10a2unorm",f.keyword,"rgb10a2unorm"),rg11b10float:new p("rg11b10float",f.keyword,"rg11b10float"),rg32uint:new p("rg32uint",f.keyword,"rg32uint"),rg32sint:new p("rg32sint",f.keyword,"rg32sint"),rg32float:new p("rg32float",f.keyword,"rg32float"),rgba16uint:new p("rgba16uint",f.keyword,"rgba16uint"),rgba16sint:new p("rgba16sint",f.keyword,"rgba16sint"),rgba16float:new p("rgba16float",f.keyword,"rgba16float"),rgba32uint:new p("rgba32uint",f.keyword,"rgba32uint"),rgba32sint:new p("rgba32sint",f.keyword,"rgba32sint"),rgba32float:new p("rgba32float",f.keyword,"rgba32float"),static_assert:new p("static_assert",f.keyword,"static_assert")},l.tokens={decimal_float_literal:new p("decimal_float_literal",f.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new p("hex_float_literal",f.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new p("int_literal",f.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new p("uint_literal",f.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new p("ident",f.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new p("and",f.token,"&"),and_and:new p("and_and",f.token,"&&"),arrow:new p("arrow ",f.token,"->"),attr:new p("attr",f.token,"@"),attr_left:new p("attr_left",f.token,"[["),attr_right:new p("attr_right",f.token,"]]"),forward_slash:new p("forward_slash",f.token,"/"),bang:new p("bang",f.token,"!"),bracket_left:new p("bracket_left",f.token,"["),bracket_right:new p("bracket_right",f.token,"]"),brace_left:new p("brace_left",f.token,"{"),brace_right:new p("brace_right",f.token,"}"),colon:new p("colon",f.token,":"),comma:new p("comma",f.token,","),equal:new p("equal",f.token,"="),equal_equal:new p("equal_equal",f.token,"=="),not_equal:new p("not_equal",f.token,"!="),greater_than:new p("greater_than",f.token,">"),greater_than_equal:new p("greater_than_equal",f.token,">="),shift_right:new p("shift_right",f.token,">>"),less_than:new p("less_than",f.token,"<"),less_than_equal:new p("less_than_equal",f.token,"<="),shift_left:new p("shift_left",f.token,"<<"),modulo:new p("modulo",f.token,"%"),minus:new p("minus",f.token,"-"),minus_minus:new p("minus_minus",f.token,"--"),period:new p("period",f.token,"."),plus:new p("plus",f.token,"+"),plus_plus:new p("plus_plus",f.token,"++"),or:new p("or",f.token,"|"),or_or:new p("or_or",f.token,"||"),paren_left:new p("paren_left",f.token,"("),paren_right:new p("paren_right",f.token,")"),semicolon:new p("semicolon",f.token,";"),star:new p("star",f.token,"*"),tilde:new p("tilde",f.token,"~"),underscore:new p("underscore",f.token,"_"),xor:new p("xor",f.token,"^"),plus_equal:new p("plus_equal",f.token,"+="),minus_equal:new p("minus_equal",f.token,"-="),times_equal:new p("times_equal",f.token,"*="),division_equal:new p("division_equal",f.token,"/="),modulo_equal:new p("modulo_equal",f.token,"%="),and_equal:new p("and_equal",f.token,"&="),or_equal:new p("or_equal",f.token,"|="),xor_equal:new p("xor_equal",f.token,"^="),shift_right_equal:new p("shift_right_equal",f.token,">>="),shift_left_equal:new p("shift_left_equal",f.token,"<<=")},l.storage_class=[v.keywords.function,v.keywords.private,v.keywords.workgroup,v.keywords.uniform,v.keywords.storage],l.access_mode=[v.keywords.read,v.keywords.write,v.keywords.read_write],l.sampler_type=[v.keywords.sampler,v.keywords.sampler_comparison],l.sampled_texture_type=[v.keywords.texture_1d,v.keywords.texture_2d,v.keywords.texture_2d_array,v.keywords.texture_3d,v.keywords.texture_cube,v.keywords.texture_cube_array],l.multisampled_texture_type=[v.keywords.texture_multisampled_2d],l.storage_texture_type=[v.keywords.texture_storage_1d,v.keywords.texture_storage_2d,v.keywords.texture_storage_2d_array,v.keywords.texture_storage_3d],l.depth_texture_type=[v.keywords.texture_depth_2d,v.keywords.texture_depth_2d_array,v.keywords.texture_depth_cube,v.keywords.texture_depth_cube_array,v.keywords.texture_depth_multisampled_2d],l.texture_external_type=[v.keywords.texture_external],l.any_texture_type=[...v.sampled_texture_type,...v.multisampled_texture_type,...v.storage_texture_type,...v.depth_texture_type,...v.texture_external_type],l.texel_format=[v.keywords.r8unorm,v.keywords.r8snorm,v.keywords.r8uint,v.keywords.r8sint,v.keywords.r16uint,v.keywords.r16sint,v.keywords.r16float,v.keywords.rg8unorm,v.keywords.rg8snorm,v.keywords.rg8uint,v.keywords.rg8sint,v.keywords.r32uint,v.keywords.r32sint,v.keywords.r32float,v.keywords.rg16uint,v.keywords.rg16sint,v.keywords.rg16float,v.keywords.rgba8unorm,v.keywords.rgba8unorm_srgb,v.keywords.rgba8snorm,v.keywords.rgba8uint,v.keywords.rgba8sint,v.keywords.bgra8unorm,v.keywords.bgra8unorm_srgb,v.keywords.rgb10a2unorm,v.keywords.rg11b10float,v.keywords.rg32uint,v.keywords.rg32sint,v.keywords.rg32float,v.keywords.rgba16uint,v.keywords.rgba16sint,v.keywords.rgba16float,v.keywords.rgba32uint,v.keywords.rgba32sint,v.keywords.rgba32float],l.const_literal=[v.tokens.int_literal,v.tokens.uint_literal,v.tokens.decimal_float_literal,v.tokens.hex_float_literal,v.keywords.true,v.keywords.false],l.literal_or_ident=[v.tokens.ident,v.tokens.int_literal,v.tokens.uint_literal,v.tokens.decimal_float_literal,v.tokens.hex_float_literal],l.element_count_expression=[v.tokens.int_literal,v.tokens.uint_literal,v.tokens.ident],l.template_types=[v.keywords.vec2,v.keywords.vec3,v.keywords.vec4,v.keywords.mat2x2,v.keywords.mat2x3,v.keywords.mat2x4,v.keywords.mat3x2,v.keywords.mat3x3,v.keywords.mat3x4,v.keywords.mat4x2,v.keywords.mat4x3,v.keywords.mat4x4,v.keywords.atomic,v.keywords.bitcast,...v.any_texture_type],l.attribute_name=[v.tokens.ident,v.keywords.block],l.assignment_operators=[v.tokens.equal,v.tokens.plus_equal,v.tokens.minus_equal,v.tokens.times_equal,v.tokens.division_equal,v.tokens.modulo_equal,v.tokens.and_equal,v.tokens.or_equal,v.tokens.xor_equal,v.tokens.shift_right_equal,v.tokens.shift_left_equal],l.increment_operators=[v.tokens.plus_plus,v.tokens.minus_minus];class $n{constructor(e,r,n){this.type=e,this.lexeme=r,this.line=n}toString(){return this.lexeme}isTemplateType(){return l.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==l.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class tc{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new $n(l.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let n=1;for(;n>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),n--,n==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),n++)}return!0}}let r=l.none;for(;;){let n=this._findType(e);const s=this._peekAhead();if(e==">"&&(s==">"||s=="=")){let i=!1,o=this._tokens.length-1;for(let a=0;a<5&&o>=0;++a,--o)if(this._tokens[o].type===l.tokens.less_than){o>0&&this._tokens[o-1].isArrayOrTemplateType()&&(i=!0);break}if(i)return this._addToken(n),!0}if(n===l.none){let i=e,o=0;const a=2;for(let u=0;u<a;++u)if(i+=this._peekAhead(u),n=this._findType(i),n!==l.none){o=u;break}if(n===l.none)return r===l.none?!1:(this._current--,this._addToken(r),!0);e=i,this._current+=o+1}if(r=n,this._isAtEnd())break;e+=this._advance()}return r===l.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in l.keywords){const n=l.keywords[r];if(this._match(e,n.rule))return n}for(const r in l.tokens){const n=l.tokens[r];if(this._match(e,n.rule))return n}return l.none}_match(e,r){if(typeof r=="string"){if(r==e)return!0}else{const n=r.exec(e);if(n&&n.index==0&&n[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new $n(e,r,this._line))}}class rc{constructor(){this._tokens=[],this._current=0,this._context=new Ou}parse(e){this._initialize(e);let r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}return r}_initialize(e){if(e)if(typeof e=="string"){const r=new tc(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,r){return console.error(e,r),{token:e,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==l.eof}_match(e){if(e instanceof p)return this._check(e)?(this._advance(),!0):!1;for(let r=0,n=e.length;r<n;++r){const s=e[r];if(this._check(s))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),r)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){let n=r.type;return e.indexOf(n)!=-1}return r.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(l.tokens.semicolon)&&!this._isAtEnd(););if(this._match(l.keywords.alias)){const r=this._type_alias();return this._consume(l.tokens.semicolon,"Expected ';'"),r}if(this._match(l.keywords.enable)){const r=this._enable_directive();return this._consume(l.tokens.semicolon,"Expected ';'"),r}const e=this._attribute();if(this._check(l.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(l.tokens.semicolon,"Expected ';'."),r}if(this._check(l.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(l.tokens.semicolon,"Expected ';'."),r}if(this._check(l.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(l.tokens.semicolon,"Expected ';'."),r}if(this._check(l.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(l.tokens.semicolon,"Expected ';'."),r}if(this._check(l.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),r}if(this._check(l.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),r}return null}_function_decl(){if(!this._match(l.keywords.fn))return null;const e=this._consume(l.tokens.ident,"Expected function name.").toString();this._consume(l.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(l.tokens.paren_right))do{if(this._check(l.tokens.paren_right))break;const i=this._attribute(),o=this._consume(l.tokens.ident,"Expected argument name.").toString();this._consume(l.tokens.colon,"Expected ':' for argument type.");const a=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=a,r.push(new Qu(o,u,i)))}while(this._match(l.tokens.comma));this._consume(l.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(l.tokens.arrow)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}const s=this._compound_statement();return new tr(e,r,n,s)}_compound_statement(){const e=[];for(this._consume(l.tokens.brace_left,"Expected '{' for block.");!this._check(l.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(l.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(l.tokens.semicolon)&&!this._isAtEnd(););if(this._check(l.keywords.if))return this._if_statement();if(this._check(l.keywords.switch))return this._switch_statement();if(this._check(l.keywords.loop))return this._loop_statement();if(this._check(l.keywords.for))return this._for_statement();if(this._check(l.keywords.while))return this._while_statement();if(this._check(l.keywords.continuing))return this._continuing_statement();if(this._check(l.keywords.static_assert))return this._static_assert_statement();if(this._check(l.tokens.brace_left))return this._compound_statement();let e=null;return this._check(l.keywords.return)?e=this._return_statement():this._check([l.keywords.var,l.keywords.let,l.keywords.const])?e=this._variable_statement():this._match(l.keywords.discard)?e=new qu:this._match(l.keywords.break)?e=new Hu:this._match(l.keywords.continue)?e=new ju:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(l.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(l.keywords.static_assert))return null;let e=this._optional_paren_expression();return new Nu(e)}_while_statement(){if(!this._match(l.keywords.while))return null;let e=this._optional_paren_expression();const r=this._compound_statement();return new Bu(e,r)}_continuing_statement(){if(!this._match(l.keywords.continuing))return null;const e=this._compound_statement();return new Iu(e)}_for_statement(){if(!this._match(l.keywords.for))return null;this._consume(l.tokens.paren_left,"Expected '('.");const e=this._check(l.tokens.semicolon)?null:this._for_init();this._consume(l.tokens.semicolon,"Expected ';'.");const r=this._check(l.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(l.tokens.semicolon,"Expected ';'.");const n=this._check(l.tokens.paren_right)?null:this._for_increment();this._consume(l.tokens.paren_right,"Expected ')'.");const s=this._compound_statement();return new zu(e,r,n,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(l.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(l.tokens.equal)&&(r=this._short_circuit_or_expression()),new ze(e.name,e.type,e.storage,e.access,r)}if(this._match(l.keywords.let)){const e=this._consume(l.tokens.ident,"Expected name for let.").toString();let r=null;if(this._match(l.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(l.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new rr(e,r,null,null,n)}if(this._match(l.keywords.const)){const e=this._consume(l.tokens.ident,"Expected name for const.").toString();let r=null;if(this._match(l.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(l.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new In(e,r,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(l.increment_operators))return this._current=e,null;const n=this._consume(l.increment_operators,"Expected increment operator");return new Lu(n.type===l.tokens.plus_plus?De.increment:De.decrement,r)}_assignment_statement(){let e=null;if(this._check(l.tokens.brace_right))return null;let r=this._match(l.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const n=this._consume(l.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new Pu(rt.parse(n.lexeme),e,s)}_func_call_statement(){if(!this._check(l.tokens.ident))return null;const e=this._current,r=this._consume(l.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new Ru(r.lexeme,n)}_loop_statement(){if(!this._match(l.keywords.loop))return null;this._consume(l.tokens.brace_left,"Expected '{' for loop.");const e=[];let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let s of r)e.push(s);else e.push(r);r=this._statement()}let n=null;return this._match(l.keywords.continuing)&&(n=this._compound_statement()),this._consume(l.tokens.brace_right,"Expected '}' for loop."),new Fu(e,n)}_switch_statement(){if(!this._match(l.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(l.tokens.brace_left,"Expected '{' for switch.");const r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(l.tokens.brace_right,"Expected '}' for switch."),new Gu(e,r)}_switch_body(){const e=[];if(this._match(l.keywords.case)){const r=this._case_selectors();this._match(l.tokens.colon),this._consume(l.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(l.tokens.brace_right,"Exected '}' for switch case."),e.push(new Ju(r,n))}if(this._match(l.keywords.default)){this._match(l.tokens.colon),this._consume(l.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(l.tokens.brace_right,"Exected '}' for switch default."),e.push(new Ku(r))}if(this._check([l.keywords.default,l.keywords.case])){const r=this._switch_body();e.push(r[0])}return e}_case_selectors(){var e,r,n,s;const i=[(r=(e=this._shift_expression())===null||e===void 0?void 0:e.evaluate(this._context).toString())!==null&&r!==void 0?r:""];for(;this._match(l.tokens.comma);)i.push((s=(n=this._shift_expression())===null||n===void 0?void 0:n.evaluate(this._context).toString())!==null&&s!==void 0?s:"");return i}_case_body(){if(this._match(l.keywords.fallthrough))return this._consume(l.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(l.keywords.if))return null;const e=this._optional_paren_expression(),r=this._compound_statement();let n=[];this._match_elseif()&&(n=this._elseif_statement(n));let s=null;return this._match(l.keywords.else)&&(s=this._compound_statement()),new Uu(e,r,n,s)}_match_elseif(){return this._tokens[this._current].type===l.keywords.else&&this._tokens[this._current+1].type===l.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return e.push(new Zu(r,n)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(l.keywords.return))return null;const e=this._short_circuit_or_expression();return new Vu(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(l.tokens.or_or);)e=new ge(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(l.tokens.and_and);)e=new ge(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(l.tokens.or);)e=new ge(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(l.tokens.xor);)e=new ge(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(l.tokens.and);)e=new ge(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([l.tokens.equal_equal,l.tokens.not_equal])?new ge(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([l.tokens.less_than,l.tokens.greater_than,l.tokens.less_than_equal,l.tokens.greater_than_equal]);)e=new ge(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([l.tokens.shift_left,l.tokens.shift_right]);)e=new ge(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([l.tokens.plus,l.tokens.minus]);)e=new ge(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([l.tokens.star,l.tokens.forward_slash,l.tokens.modulo]);)e=new ge(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([l.tokens.minus,l.tokens.bang,l.tokens.tilde,l.tokens.star,l.tokens.and])?new Wu(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(l.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(l.tokens.bracket_right,"Expected ']'.");const r=this._postfix_expression();return r&&(e.postfix=r),e}if(this._match(l.tokens.period)){const e=this._consume(l.tokens.ident,"Expected member name."),r=this._postfix_expression(),n=new Rn(e.lexeme);return r&&(n.postfix=r),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(l.tokens.ident)){const n=this._previous().toString();if(this._check(l.tokens.paren_left)){const s=this._argument_expression_list(),i=this._getStruct(n);return i!=null?new st(i,s):new Fn(n,s)}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return new Un(n,s.value)}return new Gn(n)}if(this._match(l.const_literal))return new Vn(parseFloat(this._previous().toString()));if(this._check(l.tokens.paren_left))return this._paren_expression();if(this._match(l.keywords.bitcast)){this._consume(l.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(l.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return new Xu(n,s)}const e=this._type_decl(),r=this._argument_expression_list();return new Yu(e,r)}_argument_expression_list(){if(!this._match(l.tokens.paren_left))return null;const e=[];do{if(this._check(l.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(l.tokens.comma));return this._consume(l.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(l.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(l.tokens.paren_right),new Dn([e])}_paren_expression(){this._consume(l.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(l.tokens.paren_right,"Expected ')'."),new Dn([e])}_struct_decl(){if(!this._match(l.keywords.struct))return null;const e=this._consume(l.tokens.ident,"Expected name for struct.").toString();this._consume(l.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(l.tokens.brace_right);){const s=this._attribute(),i=this._consume(l.tokens.ident,"Expected variable name.").toString();this._consume(l.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=o),this._check(l.tokens.brace_right)?this._match(l.tokens.comma):this._consume(l.tokens.comma,"Expected ',' for struct member."),r.push(new ec(i,a,s))}this._consume(l.tokens.brace_right,"Expected '}' after struct body.");const n=new Pe(e,r);return this._context.structs.set(e,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(l.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(l.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(l.keywords.const))return null;const e=this._consume(l.tokens.ident,"Expected variable name");let r=null;if(this._match(l.tokens.colon)){const i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}let n=null;if(this._match(l.tokens.equal)){const i=this._short_circuit_or_expression();if(i instanceof st)n=i;else if(i instanceof Un&&i.initializer instanceof st)n=i.initializer;else try{const o=i.evaluate(this._context);n=new Vn(o)}catch{n=i}}const s=new In(e.toString(),r,"","",n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(l.keywords.let))return null;const e=this._consume(l.tokens.ident,"Expected variable name");let r=null;if(this._match(l.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let n=null;return this._match(l.tokens.equal)&&(n=this._const_expression()),new rr(e.toString(),r,"","",n)}_const_expression(){if(this._match(l.const_literal))return new Rn(this._previous().toString());const e=this._type_decl();this._consume(l.tokens.paren_left,"Expected '('.");let r=[];for(;!this._check(l.tokens.paren_right)&&(r.push(this._const_expression()),!!this._check(l.tokens.comma));)this._advance();return this._consume(l.tokens.paren_right,"Expected ')'."),new st(e,r)}_variable_decl(){if(!this._match(l.keywords.var))return null;let e="",r="";this._match(l.tokens.less_than)&&(e=this._consume(l.storage_class,"Expected storage_class.").toString(),this._match(l.tokens.comma)&&(r=this._consume(l.access_mode,"Expected access_mode.").toString()),this._consume(l.tokens.greater_than,"Expected '>'."));const n=this._consume(l.tokens.ident,"Expected variable name");let s=null;if(this._match(l.tokens.colon)){const i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}return new ze(n.toString(),s,e,r,null)}_override_decl(){if(!this._match(l.keywords.override))return null;const e=this._consume(l.tokens.ident,"Expected variable name");let r=null;if(this._match(l.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return new Bn(e.toString(),r,null)}_enable_directive(){const e=this._consume(l.tokens.ident,"identity expected.");return new Du(e.toString())}_type_alias(){const e=this._consume(l.tokens.ident,"identity expected.");this._consume(l.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=new zn(e.toString(),r);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([l.tokens.ident,...l.texel_format,l.keywords.bool,l.keywords.f32,l.keywords.i32,l.keywords.u32])){const n=this._advance(),s=n.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new Le(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(l.template_types)){let n=this._advance().toString(),s=null,i=null;return this._match(l.tokens.less_than)&&(s=this._type_decl(),i=null,this._match(l.tokens.comma)&&(i=this._consume(l.access_mode,"Expected access_mode for pointer").toString()),this._consume(l.tokens.greater_than,"Expected '>' for type.")),new Ln(n,s,i)}if(this._match(l.keywords.ptr)){let n=this._previous().toString();this._consume(l.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(l.storage_class,"Expected storage_class for pointer");this._consume(l.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let o=null;return this._match(l.tokens.comma)&&(o=this._consume(l.access_mode,"Expected access_mode for pointer").toString()),this._consume(l.tokens.greater_than,"Expected '>' for pointer."),new $u(n,s.toString(),i,o)}const r=this._attribute();if(this._match(l.keywords.array)){let n=null,s=-1;const i=this._previous();if(this._match(l.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let o="";this._match(l.tokens.comma)&&(o=this._shift_expression().evaluate(this._context).toString()),this._consume(l.tokens.greater_than,"Expected '>' for array."),s=o?parseInt(o):0}return new Pn(i.toString(),r,n,s)}return null}_texture_sampler_types(){if(this._match(l.sampler_type))return new nt(this._previous().toString(),null,null);if(this._match(l.depth_texture_type))return new nt(this._previous().toString(),null,null);if(this._match(l.sampled_texture_type)||this._match(l.multisampled_texture_type)){const e=this._previous();this._consume(l.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(l.tokens.greater_than,"Expected '>' for sampler type."),new nt(e.toString(),r,null)}if(this._match(l.storage_texture_type)){const e=this._previous();this._consume(l.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(l.texel_format,"Invalid texel format.").toString();this._consume(l.tokens.comma,"Expected ',' after texel format.");const n=this._consume(l.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(l.tokens.greater_than,"Expected '>' for sampler type."),new nt(e.toString(),r,n)}return null}_attribute(){let e=[];for(;this._match(l.tokens.attr);){const r=this._consume(l.attribute_name,"Expected attribute name"),n=new jn(r.toString(),null);if(this._match(l.tokens.paren_left)){if(n.value=this._consume(l.literal_or_ident,"Expected attribute value").toString(),this._check(l.tokens.comma)){this._advance();do{const s=this._consume(l.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(l.tokens.comma))}this._consume(l.tokens.paren_right,"Expected ')'")}e.push(n)}for(;this._match(l.tokens.attr_left);){if(!this._check(l.tokens.attr_right))do{const r=this._consume(l.attribute_name,"Expected attribute name"),n=new jn(r.toString(),null);if(this._match(l.tokens.paren_left)){if(n.value=[this._consume(l.literal_or_ident,"Expected attribute value").toString()],this._check(l.tokens.comma)){this._advance();do{const s=this._consume(l.literal_or_ident,"Expected attribute value").toString();n.value.push(s)}while(this._match(l.tokens.comma))}this._consume(l.tokens.paren_right,"Expected ')'")}e.push(n)}while(this._match(l.tokens.comma));this._consume(l.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class qe{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Xn{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class gt extends qe{constructor(e,r){super(e,r),this.members=[],this.align=0}get isStruct(){return!0}}class nr extends qe{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}}class Yn extends qe{constructor(e,r,n,s){super(e,n),this.format=r,this.access=s}get isTemplate(){return!0}}var ne;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(ne||(ne={}));class yt{constructor(e,r,n,s,i,o,a){this.name=e,this.type=r,this.group=n,this.binding=s,this.attributes=i,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class nc{constructor(e,r){this.name=e,this.type=r}}class wt{constructor(e,r){this.align=e,this.size=r}}class sc{constructor(e,r,n,s){this.name=e,this.type=r,this.locationType=n,this.location=s,this.interpolation=null}}class Wn{constructor(e,r,n,s){this.name=e,this.type=r,this.locationType=n,this.location=s}}class ic{constructor(e,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.name=e,this.stage=r}}class oc{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class ac{constructor(e,r,n,s){this.name=e,this.type=r,this.attributes=n,this.id=s}}class uc{constructor(e){this.resources=null,this.node=e}}class xe{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new oc,this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new rc().parse(e);for(const n of r)n instanceof tr&&this._functions.set(n.name,new uc(n));for(const n of r){if(n instanceof Pe){const s=this._getTypeInfo(n,null);s instanceof gt&&this.structs.push(s);continue}if(n instanceof zn){this.aliases.push(this._getAliasInfo(n));continue}if(n instanceof Bn){const s=n,i=this._getAttributeNum(s.attributes,"id",0),o=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new ac(s.name,o,s.attributes,i));continue}if(this._isUniformVar(n)){const s=n,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=new yt(s.name,a,i,o,s.attributes,ne.Uniform,s.access);this.uniforms.push(u);continue}if(this._isStorageVar(n)){const s=n,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=this._isStorageTexture(a),c=new yt(s.name,a,i,o,s.attributes,u?ne.StorageTexture:ne.Storage,s.access);this.storage.push(c);continue}if(this._isTextureVar(n)){const s=n,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=this._isStorageTexture(a),c=new yt(s.name,a,i,o,s.attributes,u?ne.StorageTexture:ne.Texture,s.access);u?this.storage.push(c):this.textures.push(c);continue}if(this._isSamplerVar(n)){const s=n,i=this._getAttributeNum(s.attributes,"group",0),o=this._getAttributeNum(s.attributes,"binding",0),a=this._getTypeInfo(s.type,s.attributes),u=new yt(s.name,a,i,o,s.attributes,ne.Sampler,s.access);this.samplers.push(u);continue}if(n instanceof tr){const s=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),o=this._getAttribute(n,"compute"),a=s||i||o;if(a){const u=new ic(n.name,a==null?void 0:a.name);u.inputs=this._getInputs(n.args),u.outputs=this._getOutputs(n.returnType),u.resources=this._findResources(n),this.entry[a.name].push(u)}continue}}}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_findResources(e){const r=[],n=this,s=[];return e.search(i=>{if(i instanceof mt)s.push({});else if(i instanceof _t)s.pop();else if(i instanceof ze){if(s.length>0){const o=i;s[s.length-1][o.name]=o}}else if(i instanceof rr){if(s.length>0){const o=i;s[s.length-1][o.name]=o}}else if(i instanceof Gn){const o=i;if(s.length>0&&s[s.length-1][o.name])return;const a=n._findResource(o.name);a&&r.push(a)}else if(i instanceof Fn){const o=i,a=n._functions.get(o.name);a&&(a.resources===null&&(a.resources=n._findResources(a.node)),r.push(...a.resources))}}),[...new Map(r.map(i=>[i.name,i])).values()]}getBindGroups(){const e=[];function r(n,s){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),s>=e[n].length&&(e[n].length=s+1)}for(const n of this.uniforms){r(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.storage){r(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.textures){r(n.group,n.binding);const s=e[n.group];s[n.binding]=n}for(const n of this.samplers){r(n.group,n.binding);const s=e[n.group];s[n.binding]=n}return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Pe)this._getStructOutputs(e,r);else{const n=this._getOutputInfo(e);n!==null&&r.push(n)}return r}_getStructOutputs(e,r){for(const n of e.members)if(n.type instanceof Pe)this._getStructOutputs(n.type,r);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const i=this._getTypeInfo(n.type,n.type.attributes),o=this._parseInt(s.value),a=new Wn(n.name,i,s.name,o);r.push(a)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getTypeInfo(e,e.attributes),s=this._parseInt(r.value);return new Wn("",n,r.name,s)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const n of e)if(n.type instanceof Pe)this._getStructInputs(n.type,r);else{const s=this._getInputInfo(n);s!==null&&r.push(s)}return r}_getStructInputs(e,r){for(const n of e.members)if(n.type instanceof Pe)this._getStructInputs(n.type,r);else{const s=this._getInputInfo(n);s!==null&&r.push(s)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getAttribute(e,"interpolation"),s=this._getTypeInfo(e.type,e.attributes),i=this._parseInt(r.value),o=new sc(e.name,s,r.name,i);return n!==null&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new nc(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,r){if(this._types.has(e))return this._types.get(e);if(e instanceof Pn){const s=e,i=this._getTypeInfo(s.format,s.attributes),o=new nr(s.name,r);return o.format=i,o.count=s.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Pe){const s=e,i=new gt(s.name,r);for(const o of s.members){const a=this._getTypeInfo(o.type,o.attributes);i.members.push(new Xn(o.name,a,o.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof nt){const s=e,i=s.format instanceof Le,o=s.format?i?this._getTypeInfo(s.format,null):new qe(s.format,null):null,a=new Yn(s.name,o,r,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Ln){const s=e,i=s.format?this._getTypeInfo(s.format,null):null,o=new Yn(s.name,i,r,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const n=new qe(e.name,r);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var r,n;const s=this._getTypeSize(e);if(e.size=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,e instanceof nr){const i=this._getTypeSize(e.format);e.stride=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof gt&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let n=0,s=0,i=0,o=0;for(let a=0,u=e.members.length;a<u;++a){const c=e.members[a],h=this._getTypeSize(c);if(!h)continue;(r=this._getAlias(c.type.name))!==null&&r!==void 0||c.type;const d=h.align,m=h.size;n=this._roundUp(d,n+s),s=m,i=n,o=Math.max(o,d),c.offset=n,c.size=m,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,i+s),e.align=o}_getTypeSize(e){var r;if(e==null)return null;const n=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Xn&&(e=e.type),e instanceof qe){const i=this._getAlias(e.name);i!==null&&(e=i)}{const i=xe._typeInfo[e.name];if(i!==void 0){const o=e.format==="f16"?2:1;return new wt(Math.max(s,i.align/o),Math.max(n,i.size/o))}}{const i=xe._typeInfo[e.name.substring(0,e.name.length-1)];if(i){const o=e.name[e.name.length-1]==="h"?2:1;return new wt(Math.max(s,i.align/o),Math.max(n,i.size/o))}}if(e instanceof nr){let i=e,o=8,a=8;const u=this._getTypeSize(i.format);u!==null&&(a=u.size,o=u.align);const c=i.count,h=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(o,a));return a=c*h,n&&(a=n),new wt(Math.max(s,o),Math.max(n,a))}if(e instanceof gt){let i=0,o=0,a=0,u=0,c=0;for(const h of e.members){const d=this._getTypeSize(h.type);d!==null&&(i=Math.max(d.align,i),a=this._roundUp(d.align,a+u),u=d.size,c=a)}return o=this._roundUp(i,c+u),new wt(Math.max(s,i),Math.max(n,o))}return null}_isUniformVar(e){return e instanceof ze&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ze&&e.storage=="storage"}_isTextureVar(e){return e instanceof ze&&e.type!==null&&xe._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ze&&e.type!==null&&xe._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let i of s)if(i.name==r)return i;return null}_getAttributeNum(e,r,n){if(e===null)return n;for(let s of e)if(s.name==r){let i=s!==null&&s.value!==null?s.value:n;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):n}return n}_roundUp(e,r){return Math.ceil(r/e)*e}}xe._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},xe._textureTypes=l.any_texture_type.map(t=>t.name),xe._samplerTypes=l.sampler_type.map(t=>t.name);function He(t,e){return Object.fromEntries(e.map(r=>{const n=fc(t,r,0);return[r.name,{typeDefinition:n,group:r.group,binding:r.binding,size:n.size}]}))}function Jn(t,e,r){return{fields:Object.fromEntries(e.members.map(n=>[n.name,{offset:n.offset,type:ar(t,n.type,0)}])),size:e.size,offset:r}}function cc(t){var e;if(t.name.includes("depth"))return"depth";switch((e=t.format)==null?void 0:e.name){case"f32":return"float";case"i32":return"sint";case"u32":return"uint";default:throw new Error("unknown texture sample type")}}function Kn(t){return t.name.includes("2d_array")?"2d-array":t.name.includes("cube_array")?"cube-array":t.name.includes("3d")?"3d":t.name.includes("1d")?"1d":t.name.includes("cube")?"cube":"2d"}function lc(t){switch(t.access){case"read":return"read-only";case"write":return"write-only";case"read_write":return"read-write";default:throw new Error("unknonw storage texture access")}}function hc(t){return t.name.endsWith("_comparison")?"comparison":"filtering"}function dc(t,e){const{binding:r,access:n,type:s}=t;switch(t.resourceType){case ne.Uniform:return{binding:r,visibility:e,buffer:{}};case ne.Storage:return{binding:r,visibility:e,buffer:{type:n===""||n==="read"?"read-only-storage":"storage"}};case ne.Texture:{if(s.name==="texture_external")return{binding:r,visibility:e,externalTexture:{}};const i=s.name.includes("multisampled");return{binding:r,visibility:e,texture:{sampleType:cc(s),viewDimension:Kn(s),multisampled:i}}}case ne.Sampler:return{binding:r,visibility:e,sampler:{type:hc(s)}};case ne.StorageTexture:return{binding:r,visibility:e,storageTexture:{access:lc(s),format:s.format.name,viewDimension:Kn(s)}};default:throw new Error("unknown resource type")}}function sr(t,e){const r={};for(const n of t)r[n.name]={stage:e,resources:n.resources.map(s=>{const{name:i,group:o}=s;return{name:i,group:o,entry:dc(s,e)}})};return r}function ir(t){const e=new xe(t),r=Object.fromEntries(e.structs.map(h=>[h.name,Jn(e,h,0)])),n=He(e,e.uniforms),s=He(e,e.storage.filter(h=>h.resourceType===ne.Storage)),i=He(e,e.storage.filter(h=>h.resourceType===ne.StorageTexture)),o=He(e,e.textures.filter(h=>h.type.name!=="texture_external")),a=He(e,e.textures.filter(h=>h.type.name==="texture_external")),u=He(e,e.samplers),c={...sr(e.entry.vertex,GPUShaderStage.VERTEX),...sr(e.entry.fragment,GPUShaderStage.FRAGMENT),...sr(e.entry.compute,GPUShaderStage.COMPUTE)};return{externalTextures:a,samplers:u,structs:r,storages:s,storageTextures:i,textures:o,uniforms:n,entryPoints:c}}function or(t,e=""){if(!t)throw new Error(e)}function fc(t,e,r){switch(e.resourceType){case ne.Uniform:case ne.Storage:case ne.StorageTexture:return ar(t,e.type,r);default:return{size:0,type:e.type.name}}}function ar(t,e,r){if(e.isArray){or(!e.isStruct,"struct array is invalid"),or(!e.isStruct,"template array is invalid");const n=e;return{size:n.size,elementType:ar(t,n.format,r),numElements:n.count}}else{if(e.isStruct)return or(!e.isTemplate,"template struct is invalid"),Jn(t,e,r);{const n=e,s=e.isTemplate?`${n.name}<${n.format.name}>`:e.name;return{size:e.size,type:s}}}}function pc(t){switch(t.dimension){case"1d":return"1d";case"3d":return"3d";default:case"2d":return t.depthOrArrayLayers>1?"2d-array":"2d"}}function mc(t){return[t.width,t.height||1,t.depthOrArrayLayers||1]}function _c(t){return Array.isArray(t)||Te(t)?[...t,1,1].slice(0,3):mc(t)}function gc(t,e){const r=_c(t),n=Math.max(...r.slice(0,e==="3d"?3:2));return 1+Math.log2(n)|0}function yc(t){let e,r;switch(t){case"2d":e="texture_2d<f32>",r="textureSample(ourTexture, ourSampler, fsInput.texcoord)";break;case"2d-array":e="texture_2d_array<f32>",r=`
          textureSample(
              ourTexture,
              ourSampler,
              fsInput.texcoord,
              uni.layer)`;break;case"cube":e="texture_cube<f32>",r=`
          textureSample(
              ourTexture,
              ourSampler,
              faceMat[uni.layer] * vec3f(fract(fsInput.texcoord), 1))`;break;case"cube-array":e="texture_cube_array<f32>",r=`
          textureSample(
              ourTexture,
              ourSampler,
              faceMat[uni.layer] * vec3f(fract(fsInput.texcoord), 1), uni.layer)`;break;default:throw new Error(`unsupported view: ${t}`)}return`
        const faceMat = array(
          mat3x3f( 0,  0,  -2,  0, -2,   0,  1,  1,   1),   // pos-x
          mat3x3f( 0,  0,   2,  0, -2,   0, -1,  1,  -1),   // neg-x
          mat3x3f( 2,  0,   0,  0,  0,   2, -1,  1,  -1),   // pos-y
          mat3x3f( 2,  0,   0,  0,  0,  -2, -1, -1,   1),   // neg-y
          mat3x3f( 2,  0,   0,  0, -2,   0, -1,  1,   1),   // pos-z
          mat3x3f(-2,  0,   0,  0, -2,   0,  1,  1,  -1));  // neg-z

        struct VSOutput {
          @builtin(position) position: vec4f,
          @location(0) texcoord: vec2f,
        };

        @vertex fn vs(
          @builtin(vertex_index) vertexIndex : u32
        ) -> VSOutput {
          var pos = array<vec2f, 3>(
            vec2f(-1.0, -1.0),
            vec2f(-1.0,  3.0),
            vec2f( 3.0, -1.0),
          );

          var vsOutput: VSOutput;
          let xy = pos[vertexIndex];
          vsOutput.position = vec4f(xy, 0.0, 1.0);
          vsOutput.texcoord = xy * vec2f(0.5, -0.5) + vec2f(0.5);
          return vsOutput;
        }

        struct Uniforms {
          layer: u32,
        };

        @group(0) @binding(0) var ourSampler: sampler;
        @group(0) @binding(1) var ourTexture: ${e};
        @group(0) @binding(2) var<uniform> uni: Uniforms;

        @fragment fn fs(fsInput: VSOutput) -> @location(0) vec4f {
          _ = uni.layer; // make sure this is used so all pipelines have the same bindings
          return ${r};
        }
      `}const Qn=new WeakMap;function wc(t,e,r){let n=Qn.get(t);n||(n={pipelineByFormatAndView:{},moduleByViewType:{}},Qn.set(t,n));let{sampler:s,uniformBuffer:i,uniformValues:o}=n;const{pipelineByFormatAndView:a,moduleByViewType:u}=n;r=r||pc(e);let c=u[r];if(!c){const m=yc(r);c=t.createShaderModule({label:`mip level generation for ${r}`,code:m}),u[r]=c}s||(s=t.createSampler({minFilter:"linear",magFilter:"linear"}),i=t.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),o=new Uint32Array(1),Object.assign(n,{sampler:s,uniformBuffer:i,uniformValues:o}));const h=`${e.format}.${r}`;a[h]||(a[h]=t.createRenderPipeline({label:`mip level generator pipeline for ${r}`,layout:"auto",vertex:{module:c,entryPoint:"vs"},fragment:{module:c,entryPoint:"fs",targets:[{format:e.format}]}}));const d=a[h];for(let m=1;m<e.mipLevelCount;++m)for(let g=0;g<e.depthOrArrayLayers;++g){o[0]=g,t.queue.writeBuffer(i,0,o);const b=t.createBindGroup({layout:d.getBindGroupLayout(0),entries:[{binding:0,resource:s},{binding:1,resource:e.createView({dimension:r,baseMipLevel:m-1,mipLevelCount:1})},{binding:2,resource:{buffer:i}}]}),y={label:"mip gen renderPass",colorAttachments:[{view:e.createView({dimension:"2d",baseMipLevel:m,mipLevelCount:1,baseArrayLayer:g,arrayLayerCount:1}),loadOp:"clear",storeOp:"store"}]},w=t.createCommandEncoder({label:"mip gen encoder"}),S=w.beginRenderPass(y);S.setPipeline(d),S.setBindGroup(0,b),S.draw(3),S.end();const E=w.finish();t.queue.submit([E])}}const bc=new Map([[Int8Array,{formats:["sint8","snorm8"],defaultForType:1}],[Uint8Array,{formats:["uint8","unorm8"],defaultForType:1}],[Int16Array,{formats:["sint16","snorm16"],defaultForType:1}],[Uint16Array,{formats:["uint16","unorm16"],defaultForType:1}],[Int32Array,{formats:["sint32","snorm32"],defaultForType:0}],[Uint32Array,{formats:["uint32","unorm32"],defaultForType:0}],[Float32Array,{formats:["float32","float32"],defaultForType:0}]]);new Map([...bc.entries()].map(([t,{formats:[e,r]}])=>[[e,t],[r,t]]).flat());function vc(t){const e=t;return Te(e.data)||Array.isArray(e.data)}function Zn(t){return Te(t)||Array.isArray(t)||vc(t)}function xc(t,e){if(Te(t))return t;const{Type:r}=ur(e);return new r(t)}function kc(t,e,r,n="2d"){if(r%1!==0)throw new Error("can't guess dimensions");if(!t&&!e){const i=Math.sqrt(r/(n==="cube"?6:1));i%1===0?(t=i,e=i):(t=r,e=1)}else if(e){if(!t&&(t=r/e,t%1))throw new Error("can't guess dimensions")}else if(e=r/t,e%1)throw new Error("can't guess dimensions");const s=r/t/e;if(s%1)throw new Error("can't guess dimensions");return[t,e,s]}function Sc(t){switch(t){case"1d":return"1d";case"3d":return"3d";default:return"2d"}}const Ec={"8snorm":Int8Array,"8unorm":Uint8Array,"8sint":Int8Array,"8uint":Uint8Array,"16snorm":Int16Array,"16unorm":Uint16Array,"16sint":Int16Array,"16uint":Uint16Array,"32snorm":Int32Array,"32unorm":Uint32Array,"32sint":Int32Array,"32uint":Uint32Array,"16float":Uint16Array,"32float":Float32Array},Tc=/([a-z]+)(\d+)([a-z]+)/;function ur(t){const[,e,r,n]=Tc.exec(t),s=e.length,i=parseInt(r)/8,o=s*i,a=Ec[`${r}${n}`];return{channels:e,numChannels:s,bytesPerChannel:i,bytesPerElement:o,Type:a}}function Ac(t,e){return[t.width,t.height,t.depthOrArrayLayers].map(r=>Math.max(1,Math.floor(r/2**e)))}function Mc(t,e,r,n){const s=xc(r.data||r,e.format),i=Ac(e,0),{bytesPerElement:o}=ur(e.format),a=n.origin||[0,0,0];t.queue.writeTexture({texture:e,origin:a},s,{bytesPerRow:o*i[0],rowsPerImage:i[1]},i)}function Cc(t,e,r,n={}){r.forEach((s,i)=>{const o=[0,0,i+(n.baseArrayLayer||0)];if(Zn(s))Mc(t,e,s,{origin:o});else{const a=s,{flipY:u,premultipliedAlpha:c,colorSpace:h}=n;t.queue.copyExternalImageToTexture({source:a,flipY:u},{texture:e,premultipliedAlpha:c,colorSpace:h,origin:o},es(a,n))}}),e.mipLevelCount>1&&wc(t,e)}function es(t,e){if(t instanceof HTMLVideoElement)return[t.videoWidth,t.videoHeight,1];{const r=t,{width:n,height:s}=r;if(n>0&&s>0&&!Zn(t))return[n,s,1];const i=e.format||"rgba8unorm",{bytesPerElement:o,bytesPerChannel:a}=ur(i),u=Te(t)||Array.isArray(t)?t:t.data,c=(Te(u)?u.byteLength:u.length*a)/o;return kc(n,s,c)}}function Oc(t,e,r={}){const n=es(e[0],r);n[2]=n[2]>1?n[2]:e.length;const s=t.createTexture({dimension:Sc(r.dimension),format:r.format||"rgba8unorm",mipLevelCount:r.mipLevelCount?r.mipLevelCount:r.mips?gc(n):1,size:n,usage:(r.usage??0)|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return Cc(t,s,e,r),s}function Nc(t,e,r={}){return Oc(t,[e],r)}const Ae="material",ts=`
struct Material { 
  baseColorFactor: vec4f,
  metallicFactor: f32,
  roughnessFactor: f32,
  emissiveFactor: vec3f,
  normalScale:f32,
  occlusionStrength: f32,
  alphaCutoff: f32,
  applyNormalMap: u32,
}

@group(2) @binding(0) var<uniform> ${Ae}: Material;
`,Bc=t=>Cn`

const PI = 3.141592653589793;
const RECIPROCAL_PI = 0.3183098861837907;
const RECIPROCAL_2PI = 0.15915494309189535;
const ESP = 0.001;

const reflectance = 0.5;

${An}
${ts}
// 贴图
@group(2) @binding(1) var baseColorTexture: texture_2d<f32>;
@group(2) @binding(2) var normalTexture: texture_2d<f32>;
@group(2) @binding(3) var metallicRoughnessTexture: texture_2d<f32>;
@group(2) @binding(4) var emissiveTexture: texture_2d<f32>;
@group(2) @binding(5) var occlusionTexture: texture_2d<f32>;

// sampler
@group(2) @binding(6) var materialSampler: sampler;

fn lin2rgb(lin: vec3f) -> vec3f {
  return pow(lin, vec3f(1.0/2.2));
}

fn rgb2lin(rgb: vec3f) -> vec3f {
  return pow(rgb, vec3f(2.2));
}

// from http://www.thetenthplanet.de/archives/1180
fn cotangentFrame(N: vec3f, p: vec3f, uv: vec2f) -> mat3x3f
{
    // get edge vectors of the pixel triangle
    let dp1 = dpdx( p );
    let dp2 = dpdy( p );
    let duv1 = dpdx( uv );
    let duv2 = dpdy( uv );
 
    // solve the linear system
    let dp2perp = cross( dp2, N );
    let dp1perp = cross( N, dp1 );
    let T = dp2perp * duv1.x + dp1perp * duv2.x;
    let B = dp2perp * duv1.y + dp1perp * duv2.y;
 
    // construct a scale-invariant frame 
    let invmax = inverseSqrt( max( dot(T,T), dot(B,B) ) );
    return mat3x3f( T * invmax, B * invmax, N );
}

fn applyNormalMap(localNorm: vec3f, uv0: vec2f, normal: vec3f, p: vec3f) -> vec3f {
  let n = normalize(2.0 * localNorm - 1.0);
  let tbn = cotangentFrame(normal, -p, uv0);
  return normalize(tbn * n);
}

fn fresnelSchlick(F0: vec3f, VoH: f32) -> vec3f {
  return F0 + (1.0 - F0) * pow( (1.0 - VoH), 5.0);
}

fn D_GGX(roughness: f32, NoH: f32) -> f32 {
  let alpha2 = pow(roughness, 4.0);
  return RECIPROCAL_PI * alpha2 / pow(1.0 + NoH*NoH*(alpha2-1.0), 2.0);
}

fn G1_SchlickGGX(k: f32, NoX: f32) -> f32 {
  return max(NoX,ESP) / ( k + (1.0-k)*NoX );
}

fn G_Smith(roughness: f32, NoL: f32, NoV: f32) -> f32 {
  let k = roughness*roughness*0.5;
  return G1_SchlickGGX(k, NoL) * G1_SchlickGGX(k, NoV);
}

fn cook_torrance_MicrofacetBRDF(l: vec3f, n: vec3f, v: vec3f, baseColor: vec3f, 
                                  roughness: f32, metallic: f32, reflectance: f32) -> vec3f {
  let h = normalize(l+v);
  let VoH = max(dot(v,h),0.0);
  let NoH = max(dot(n,h),0.0);
  let NoV = max(dot(n,v),0.0);
  let NoL = max(dot(n,l),0.0);
  
  // metal F0 is baseColor, dielectric F0 is reflectance
  let F0 = mix(vec3f(0.16 * reflectance * reflectance), baseColor, metallic);
  
  let F = fresnelSchlick(F0, NoH);
  let D = D_GGX(roughness, NoH);
  let G = G_Smith(roughness, NoL, NoV);
  let spec = (D*G)/(4.0*max(NoL,ESP)*max(NoV,ESP));
  
  // metal diffuse is zero, dielectric diffuse is baseColor*transmitted
  let diff = RECIPROCAL_PI * mix(baseColor, vec3f(0.0), metallic); 
  
  return (1.0-F)*diff + F*spec;
}

struct Light {
  dir: vec3f,
  ir: vec3f,
};

fn irradiance_direction_light(in_light: InputLight, n: vec3f) -> Light {
  var light: Light;
  let l = normalize(-in_light.dir);  // towards light
  let irradiance = max(dot(l,n),0.0) * in_light.flux;
  light.dir = l;
  light.ir = irradiance * rgb2lin(in_light.color.rgb);
  return light;
}

fn irradiance_point_light(in_light: InputLight, pos: vec3f, n: vec3f) -> Light {
  var light: Light;
  let lightDir = in_light.pos - pos;
  let r = length(lightDir);
  let l = normalize(lightDir);
  let irradiance = max(dot(l,n),0.0) * in_light.flux / (4.0 * PI * pow(r, 2.0));
  light.dir = l;
  light.ir = irradiance * rgb2lin(in_light.color.rgb);
  return light;
}

fn radiance_render(brdf: vec3f, ir: vec3f) -> vec3f {
  return brdf * ir;
}

@fragment
fn main(
  @location(0) norm: vec3f, 
  @location(1) pos: vec3f,
  @location(2) uv0: vec2f,  
  @location(3) cameraPos: vec3f
) -> @location(0) vec4f {
  let baseColor = ${Ae}.baseColorFactor * textureSample(baseColorTexture, materialSampler, uv0);
  let metallicRoughness = textureSample(metallicRoughnessTexture, materialSampler, uv0);
  let roughness = ${Ae}.roughnessFactor * metallicRoughness.g;
  let metallic = ${Ae}.metallicFactor * metallicRoughness.b;
  let emissiveColor = ${Ae}.emissiveFactor * textureSample(emissiveTexture, materialSampler, uv0).rgb;
  
  let v = normalize(cameraPos-pos);
  let n = select(normalize(norm), 
                applyNormalMap(textureSample(normalTexture, materialSampler, uv0).xyz, uv0, normalize(norm), v),
                bool(${Ae}.applyNormalMap));

  var radiance = rgb2lin(emissiveColor);  
  ///////////////////////////////////////////
  for(var i=0u; i<arrayLength(&${tt}); i++){
    let in_light = ${tt}[i];
    var out_light: Light;
    switch in_light.ltype {
      case 1: {
        out_light = irradiance_direction_light(in_light, n); 
      }
      case 2: {
        out_light = irradiance_point_light(in_light, pos, n); 
      }
      default: {
        
      }
    }
    let brdf = cook_torrance_MicrofacetBRDF(out_light.dir, n, v, rgb2lin(baseColor.rgb),
                          roughness, metallic, reflectance);
                          
    radiance += radiance_render(brdf, out_light.ir);
  }
  ///////////////////////////////////////////
  let rgb = lin2rgb(radiance);

  #if ${t.useAlphaCutoff}
    if(baseColor.a < ${Ae}.alphaCutoff){
      discard;
    }
  #endif
  return vec4f(rgb, baseColor.a);
}
`;function Ic(t,e){return Math.floor((t+e-1)/e)*e}function zc(t,e,r,n){const s=n??V.create();let i=t[0],o=t[1],a=t[2],u=t[3],c=i+i,h=o+o,d=a+a,m=i*c,g=i*h,b=i*d,y=o*h,w=o*d,S=a*d,E=u*c,A=u*h,M=u*d,N=r[0],L=r[1],G=r[2];return s[0]=(1-(y+S))*N,s[1]=(g+M)*N,s[2]=(b-A)*N,s[3]=0,s[4]=(g-M)*L,s[5]=(1-(m+S))*L,s[6]=(w+E)*L,s[7]=0,s[8]=(b+A)*G,s[9]=(w-E)*G,s[10]=(1-(m+y))*G,s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s}function Lc(t){if(t.matrix)return V.create(...t.matrix);{let e=t.scale??[1,1,1],r=t.rotation??[0,0,0,1],n=t.translation??[0,0,0];return zc(r,n,e)}}function rs(t,e,r){const n=[],s=Lc(t);return V.mul(e,s,s),n.push({name:t.name,matrix:s,mesh:t.mesh,camera:t.camera}),t.children&&n.push(...t.children.map(i=>rs(r[i],s,r)).flat()),n}const Pc=1179937895,Rc=2,Fc=1313821514,Gc=5130562;var ns=(t=>(t[t.POINTS=0]="POINTS",t[t.LINE=1]="LINE",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(ns||{}),cr=(t=>(t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t))(cr||{}),ss=(t=>(t[t.BYTE=1]="BYTE",t[t.UNSIGNED_BYTE=1]="UNSIGNED_BYTE",t[t.SHORT=2]="SHORT",t[t.UNSIGNED_SHORT=2]="UNSIGNED_SHORT",t[t.INT=4]="INT",t[t.UNSIGNED_INT=4]="UNSIGNED_INT",t[t.FLOAT=4]="FLOAT",t[t.DOUBLE=8]="DOUBLE",t))(ss||{}),is=(t=>(t.BYTE="sint8",t.UNSIGNED_BYTE="uint8",t.SHORT="sint16",t.UNSIGNED_SHORT="uint16",t.INT="int32",t.UNSIGNED_INT="uint32",t.FLOAT="float32",t))(is||{}),lr=(t=>(t[t.SCALAR=1]="SCALAR",t[t.VEC2=2]="VEC2",t[t.VEC3=3]="VEC3",t[t.VEC4=4]="VEC4",t[t.MAT2=4]="MAT2",t[t.MAT3=9]="MAT3",t[t.MAT4=16]="MAT4",t))(lr||{});class Uc{async load(e,r,n){const{bindGroupLayouts:s,format:i,mips:o=!1,depthFormat:a,record:u,onProgress:c}=n,h=await this.parse(e,r,i,o,c);return h.buildInRenderPipeline(e,s,i,a,u,c),h}async parse(e,r,n,s,i){var G,X,J,Y;i&&i("downloading",.1);const o=await(await fetch(r)).arrayBuffer(),a=new Uint32Array(o,0,5);if(a[0]!=Pc)throw Error("Provided file is not a gltf file");if(a[1]!=Rc)throw Error("Provided file is not gltf version 2");const u=a[3];if(a[4]!=Fc)throw Error("Invalid glB: The first chunk of the glB file is not a JSON chunk!");const c=JSON.parse(new TextDecoder("utf-8").decode(new Uint8Array(o,5*4,u)));console.log(c);const h=new Uint32Array(o,5*4+u,2),d=h[0];if(h[1]!=Gc)throw Error("Invalid glB: The second chunk of the glB file is not a binary chunk!");const m=new $c(o,7*4+u,d),g=c.bufferViews.map(T=>new Xc(m,T)),b=c.accessors.map(T=>new Yc(g[T.bufferView],T)),y=((G=c.images)==null?void 0:G.map(T=>new Wc(T,g[T.bufferView])))??[],w=((X=c.samplers)==null?void 0:X.map(T=>{const D=new je(T);return D.uploadSampler(e),D}))??[];je.createDefaultSampler(e);const S=((J=c.textures)==null?void 0:J.map(T=>new cs(T,y[T.source],T.sampler!==void 0?w[T.sampler].sampler:je.defaultSampler)))??[],E=((Y=c.materials)==null?void 0:Y.map(T=>new Jc(T,S,n)))??[];i&&i("parse mesh",.3);const A=c.meshes.map((T,D)=>{i&&i("parse mesh",.3+(D+1)/c.meshes.length*.1);const ee=T.primitives.map(R=>{let K=R.mode;if(K===void 0&&(K=4),!(K in ns))throw new Error(`Unsupported primitive mode ${K}`);const ie=R.indices!==void 0&&R.indices<b.length?b[R.indices]:null,ae=Object.keys(R.attributes).map(te=>({name:te,shaderLocation:Reflect.get(Ee,te),accessor:b[Reflect.get(R.attributes,te)]})).filter(({shaderLocation:te})=>te!==void 0);return new jc(ie,K,ae,R.material!==void 0?E[R.material]:void 0,R)});return new qc(ee,T)});i&&i("parse nodes",.4);const M=c.scenes[c.scene??0],N=M.nodes.map((T,D)=>{i&&i("parse nodes",.4+(D+1)/M.nodes.length*.1);const ee=c.nodes[T];return rs(ee,V.identity(),c.nodes).filter(R=>R.mesh!==void 0).map(R=>new Dc(A[R.mesh],R))}).flat(),L=new Vc(N,A,M);return g.forEach(T=>T.flag===0&&T.uploadBuffer(e)),i&&i("upload textures",.5),await Promise.all((y==null?void 0:y.map(async(T,D)=>{i&&i("upload textures",.5+(D+1)/y.length*.1),await T.view.uploadTexture(e,T,s)}))??[]),await Se.upload(e),L}}class Vc{constructor(e,r,n){k(this,"renderPipelines",new Map);k(this,"record");k(this,"nodeBindGroupLayout",null);k(this,"materialBindGroupLayout",null);k(this,"instanceBindGroup",null);k(this,"instanceBindGroupIndex",0);this.a_nodes=e,this.a_meshs=r,Object.assign(this,n)}buildInRenderPipeline(e,r,n,s="depth24plus",i,o){return this.buildRenderPipeline(e,On,Bc,r,n,s,i,o)}buildRenderPipeline(e,r,n,s,i,o="depth24plus",a,u){return this.buildRenderOrder(e,r,n,s,i,o,a,u)}buildRenderOrder(e,r,n,s,i,o="depth24plus",a,u){this.record=a,this.nodeBindGroupLayout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]}),this.materialBindGroupLayout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},...[1,2,3,4,5].map(g=>({binding:g,visibility:GPUShaderStage.FRAGMENT,texture:{viewDimension:"2d"}})),{binding:6,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]});const c=new Map,h={total:0,offset:0,matrices:c,arrayBuffer:new Float32Array};u&&u("parse primitives",.6),this.a_nodes.forEach((g,b)=>{const y={matrix:g.matrix,normalMatrix:g.calcNormalMatrix()};u&&u("parse primitives",.6+(b+1)/this.a_nodes.length*.2),g.a_mesh.primitives.forEach(w=>{const S=JSON.stringify(w);let E=c.get(S);E||(E=[],c.set(S,E)),E.push(y),h.total++})}),u&&u("make instance",.8);const d=e.createBuffer({size:16*2*4*h.total,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});this.instanceBindGroup=e.createBindGroup({layout:this.nodeBindGroupLayout,entries:[{binding:0,resource:{buffer:d}}]}),this.instanceBindGroupIndex=s.length,a&&a.bindGroupCount++,h.arrayBuffer=new Float32Array(d.getMappedRange());const m=new Map;this.a_meshs.forEach((g,b)=>{g.a_primitives.forEach(y=>{var Y;const{gpuBuffers:w,indices:S,pipelineCacheKey:E,vertexCount:A}=y.makeBuffers(),M=JSON.stringify((Y=y.a_material)==null?void 0:Y.__json);let N=m.get(M);N||(N={bindGroup:y.makeBindGroup(e,this.materialBindGroupLayout),groupIndex:s.length+1},a&&a.bindGroupCount++,m.set(M,N));let L=this.renderPipelines.get(E);if(!L){const{pipeline:T,create:D}=Hc(JSON.parse(E),e,r,n,[...s,this.nodeBindGroupLayout,this.materialBindGroupLayout],i,o);L={pipeline:T,materialPrimitivesMap:new Map},D&&a&&a.pipelineCount++,this.renderPipelines.set(E,L)}let G=L.materialPrimitivesMap.get(N);G||(G=[],L.materialPrimitivesMap.set(N,G)),G.push({buffers:w,indices:S,vertexCount:A,instanceInAll:this.setInstancePosForPrimitiveNodes(y,h)});const X=.8+(b+1)/this.a_meshs.length*.2,J=X>=1?"done":"make buffer pipeline bindGroup pair";u&&u(J,X)})}),d.unmap()}setInstancePosForPrimitiveNodes(e,r){const n=r.matrices.get(JSON.stringify(e.__json)),s=r.offset,i=n.length;for(let o=0;o<i;o++){const a=(s+o)*32;r.arrayBuffer.set(n[o].matrix,a),r.arrayBuffer.set(n[o].normalMatrix,a+16)}return r.offset+=i,{first:s,count:i}}createInstanceForPrimitiveNodes(e,r,n,s){const i=n.get(JSON.stringify(r.__json)),o=i.length,a=e.createBuffer({size:16*2*4*o,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),u=new Float32Array(a.getMappedRange());for(let c=0;c<o;c++){const h=c*32;u.set(i[c].matrix,h),u.set(i[c].normalMatrix,h+16)}return a.unmap(),{bindGroup:e.createBindGroup({layout:s,entries:[{binding:0,resource:{buffer:a}}]}),count:o}}render(e,r,n){const s=n??new Yt;return this.record&&Object.assign(s,this.record),s&&s.bindGroupSets++,e.setBindGroup(this.instanceBindGroupIndex,this.instanceBindGroup),this.renderPipelines.forEach(i=>{e.setPipeline(i.pipeline),s&&s.pipelineSets++,i.materialPrimitivesMap.forEach((o,a)=>{e.setBindGroup(a.groupIndex,a.bindGroup),s&&s.bindGroupSets++,o.forEach(u=>{u.buffers.forEach(({accessor:g,offset:b},y)=>{s&&s.bufferSets++,e.setVertexBuffer(y,g.view.gpuBuffer,b,g.byteLength)});const{first:c,count:h}=u.instanceInAll,{indices:d,vertexCount:m}=u;d?(s&&s.bufferSets++,e.setIndexBuffer(d.view.gpuBuffer,d.vertexType,d.byteOffset,d.byteLength),e.drawIndexed(d.count,h,0,0,c)):e.draw(m,h,0,c),s&&s.drawCount++})})}),r&&r(s),s}}class Dc{constructor(e,r){k(this,"name");k(this,"matrix");k(this,"mesh");k(this,"camera");k(this,"bindGroup",null);this.a_mesh=e,this.name=r.name,this.mesh=r.mesh,this.camera=r.camera,this.matrix=r.matrix}calcNormalMatrix(){return V.transpose(V.inverse(this.matrix))}makeBindGroup(e,r){const n=e.createBuffer({size:128,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),s=this.calcNormalMatrix();return new Float32Array(n.getMappedRange()).set([...this.matrix,...s]),n.unmap(),this.bindGroup=e.createBindGroup({layout:r,entries:[{binding:0,resource:{buffer:n}}]}),this.bindGroup}}class qc{constructor(e,r){this.a_primitives=e,Object.assign(this,r)}}const os=new Map,as=new Map;function us(t,e,r){const n=JSON.stringify(e);let s=as.get(n);return s||(s=t.createShaderModule({code:typeof r=="string"?r:r(e)}),as.set(n,s)),s}function Hc(t,e,r,n,s,i,o="depth24plus"){const a=JSON.stringify(t);let u=os.get(a);if(u)return{pipeline:u,create:!1};let c;switch(t.alphaMode){case"BLEND":c={color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one"}};break}return u=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:s}),vertex:{module:us(e,t.shaderContext.vertex,r),entryPoint:"main",buffers:t.bufferLayout},fragment:{module:us(e,t.shaderContext.fragment,n),entryPoint:"main",targets:[{format:i,blend:c}]},primitive:{cullMode:t.doubleSided?"none":"back",...t.primitive},depthStencil:{format:o,depthWriteEnabled:!0,depthCompare:"less"}}),os.set(a,u),{pipeline:u,create:!0}}class jc{constructor(e,r,n,s,i){k(this,"renderPipeline",null);k(this,"vertexCount",0);k(this,"bufferLayout",[]);k(this,"gpuBuffers",[]);var o;this.a_indices=e,this.topology=r,this.attributeAccessors=n,this.a_material=s,this.__json=i,Object.assign(this,this.__json),(o=this.a_indices)==null||o.view.addUsage(GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST),this.setupPrimitive()}makeBuffers(){var s,i;const e={topology:"triangle-list"};this.topology==5&&(e.topology="triangle-strip",this.a_indices&&(e.stripIndexFormat=this.a_indices.vertexType));const r=this.bufferLayout,n=((s=this.a_material)==null?void 0:s.alphaMode)??"OPAQUE";return{pipelineCacheKey:JSON.stringify({primitive:e,bufferLayout:r,alphaMode:n,doubleSided:((i=this.a_material)==null?void 0:i.doubleSided)??!1,shaderContext:{vertex:{useTexcoord:"TEXCOORD_0"in this.attributes,useAlphaCutoff:n=="MASK"},fragment:{}}}),vertexCount:this.vertexCount,gpuBuffers:this.gpuBuffers,indices:this.a_indices}}setupPrimitive(){const e=new Map,r=new Map;this.attributeAccessors.sort((n,s)=>n.accessor.byteOffset-s.accessor.byteOffset).forEach(({accessor:n,name:s,shaderLocation:i})=>{s=="POSITION"&&(this.vertexCount=n.count),n.view.addUsage(GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST);let o=e.get(n.bufferView),a,u=o&&Math.abs(n.byteOffset-o.attributes[0].offset)>=o.arrayStride;!o||u?(o={arrayStride:n.byteStride,attributes:[]},e.set(u?s:n.bufferView,o),r.set(o,{accessor:n,offset:n.byteOffset})):(a=r.get(o),a.offset=Math.min(a.offset,n.byteOffset)),o.attributes.push({shaderLocation:i,format:n.vertexType,offset:n.byteOffset})});for(const n of e.values()){const s=r.get(n);for(const i of n.attributes)i.offset-=s.offset;n.attributes=n.attributes.sort((i,o)=>i.shaderLocation-o.shaderLocation)}this.bufferLayout=[...e.values()].sort((n,s)=>n.attributes[0].shaderLocation-s.attributes[0].shaderLocation),this.gpuBuffers=this.bufferLayout.map(n=>r.get(n))}makeBindGroup(e,r){if(!this.a_material)return;const n=ir(ts),s=Qt(n.uniforms[Ae]);s.set(this.a_material.uniformValue);const i=e.createBuffer({size:s.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(i,0,s.arrayBuffer);const o=this.a_material.textures;return e.createBindGroup({layout:r,entries:[{binding:0,resource:{buffer:i}},...o.map((a,u)=>{const c=a.a_image.view.texture;return{binding:u+1,resource:c.createView()}}),{binding:o.length+1,resource:this.a_material.samplers[0]}]})}}class $c extends Uint8Array{constructor(e,r,n){return super(),new Uint8Array(e,r,n)}}class Xc{constructor(e,r){k(this,"viewBuffer");k(this,"usage",0);k(this,"format",null);k(this,"gpuBuffer",null);k(this,"texture",null);k(this,"flag",0);Object.assign(this,{byteStride:0,byteOffset:0,...r}),this.viewBuffer=e.subarray(this.byteOffset,this.byteOffset+this.byteLength)}setFlag(e){this.flag=e}setFormat(e){this.format=e}addUsage(e){this.usage=this.usage|e}async uploadTexture(e,r,n){var o;if(!this.format)throw new Error("Can't upload texture without format");const s=new Blob([this.viewBuffer],{type:r.mimeType}),i=await createImageBitmap(s);(o=this.texture)==null||o.destroy(),this.texture=Nc(e,i,{mips:n})}uploadBuffer(e){var r;(r=this.gpuBuffer)==null||r.destroy(),this.gpuBuffer=e.createBuffer({size:Ic(this.viewBuffer.byteLength,4),usage:this.usage,mappedAtCreation:!0}),Reflect.construct(this.viewBuffer.constructor,[this.gpuBuffer.getMappedRange()]).set(this.viewBuffer),this.gpuBuffer.unmap()}}class Yc{constructor(e,r){this.view=e,Object.assign(this,{byteOffset:0,...r})}get byteStride(){const e=Reflect.get(lr,this.type)*Reflect.get(ss,Reflect.get(cr,this.componentType));return Math.max(e,this.view.byteStride)}get byteLength(){return this.count*this.byteStride}get vertexType(){const e=Reflect.get(is,Reflect.get(cr,this.componentType));if(!e)throw Error(`Unrecognized or unsupported glTF type ${this.componentType}`);const r=Reflect.get(lr,this.type);return r>1?`${e}x${r}`:e}}class Wc{constructor(e,r){this.view=r,Object.assign(this,e),r.setFlag(1),r.addUsage(GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT)}}const Ke=class Ke{constructor(e){k(this,"sampler",null);Object.assign(this,e)}static createDefaultSampler(e){Ke.defaultSampler||(Ke.defaultSampler=e.createSampler({addressModeU:"repeat",addressModeV:"repeat",minFilter:"linear",magFilter:"linear",mipmapFilter:"linear"}))}uploadSampler(e){Ke.createDefaultSampler(e);const r={addressModeU:this.addressModeForWrap(this.wrapS),addressModeV:this.addressModeForWrap(this.wrapT)};switch((!this.magFilter||this.magFilter===9729)&&(r.magFilter="linear"),this.minFilter){case WebGLRenderingContext.NEAREST:break;case WebGLRenderingContext.LINEAR:case WebGLRenderingContext.LINEAR_MIPMAP_NEAREST:r.minFilter="linear";break;case WebGLRenderingContext.NEAREST_MIPMAP_LINEAR:r.mipmapFilter="linear";break;case WebGLRenderingContext.LINEAR_MIPMAP_LINEAR:default:r.minFilter="linear",r.mipmapFilter="linear";break}this.sampler=e.createSampler(r)}addressModeForWrap(e){switch(e){case 33071:return"clamp-to-edge";case 33648:return"mirror-repeat";default:return"repeat"}}};k(Ke,"defaultSampler",null);let je=Ke;class cs{constructor(e,r,n){this.a_image=r,this.a_sampler=n,Object.assign(this,e)}}class Jc{constructor(e,r,n){k(this,"uniformValue");k(this,"textures");k(this,"samplers",[]);var i,o;this.__json=e,Object.assign(this,e),this.uniformValue={baseColorFactor:this.pbrMetallicRoughness.baseColorFactor??[1,1,1,1],metallicFactor:this.pbrMetallicRoughness.metallicFactor??1,roughnessFactor:this.pbrMetallicRoughness.roughnessFactor??1,emissiveFactor:this.emissiveFactor??[0,0,0],normalScale:((i=this.normalTexture)==null?void 0:i.scale)??1,occlusionStrength:((o=this.occlusionTexture)==null?void 0:o.strength)??1,alphaCutoff:this.alphaCutoff??.5,applyNormalMap:this.normalTexture!==void 0?1:0};const s=n.split("-")[0];this.textures=[{a:this.pbrMetallicRoughness.baseColorTexture,d:Se.opaqueWhiteTexture,f:`${s}-srgb`},{a:this.normalTexture,d:Se.defaultNormalTexture,f:s},{a:this.pbrMetallicRoughness.metallicRoughnessTexture,d:Se.opaqueWhiteTexture,f:s},{a:this.emissiveTexture,d:Se.transparentBlackTexture,f:`${s}-srgb`},{a:this.occlusionTexture,d:Se.transparentBlackTexture,f:s}].map(({a,d:u,f:c})=>{const h=(a==null?void 0:a.index)!==void 0?r[a==null?void 0:a.index]:new cs({source:-1,sampler:-1},{view:u},je.defaultSampler);return h.a_image.view.setFormat(c),this.samplers.includes(h.a_sampler)||this.samplers.push(h.a_sampler),h})}}class Kc{constructor(e,r,n,s,i){k(this,"invScreen");k(this,"centerTranslation");k(this,"translation");k(this,"rotation");k(this,"camera");k(this,"invCamera");this.eye=e,this.center=r,this.up=n,this.zoomSpeed=s,this.screenDims=i;var o=Q.set(e[0],e[1],e[2]),a=Q.set(r[0],r[1],r[2]),u=Q.set(n[0],n[1],n[2]);Q.normalize(u,u);var c=Q.sub(a,o),h=Q.len(c);Q.normalize(c,c);var d=Q.cross(c,u);Q.normalize(d,d);var m=Q.cross(d,c);Q.normalize(m,m),Q.cross(d,c,m),Q.normalize(d,d),this.zoomSpeed=s,this.invScreen=[1/i[0],1/i[1]],this.centerTranslation=V.translation(r),V.inverse(this.centerTranslation,this.centerTranslation);var g=Q.set(0,0,-1*h);this.translation=V.translation(g);var b=Dr.create(d[0],d[1],d[2],m[0],m[1],m[2],-c[0],-c[1],-c[2]);Dr.transpose(b,b),this.rotation=Ue.fromMat(b),Ue.normalize(this.rotation,this.rotation),this.camera=V.create(),this.invCamera=V.create(),this.updateCameraMatrix()}rotate(e,r){var n=W.set(bt(e[0]*2*this.invScreen[0]-1,-1,1),bt(1-e[1]*2*this.invScreen[1],-1,1)),s=W.set(bt(r[0]*2*this.invScreen[0]-1,-1,1),bt(1-r[1]*2*this.invScreen[1],-1,1)),i=ls(n),o=ls(s);this.rotation=Ue.mul(this.rotation,i,this.rotation),this.rotation=Ue.mul(this.rotation,o,this.rotation),this.updateCameraMatrix()}zoom(e){var r=Q.set(0,0,e*this.invScreen[1]*this.zoomSpeed),n=V.translation(r);this.translation=V.mul(this.translation,n,this.translation),this.translation[14]>=-.2&&(this.translation[14]=-.2),this.updateCameraMatrix()}pan(e){var r=ke.set(e[0]*this.invScreen[0]*Math.abs(this.translation[14]),e[1]*this.invScreen[1]*Math.abs(this.translation[14]),0,0),n=ke.transformMat4(r,this.invCamera),s=V.translation(n);this.centerTranslation=V.mul(this.centerTranslation,s,this.centerTranslation),this.updateCameraMatrix()}updateCameraMatrix(){var e=V.fromQuat(this.rotation);this.camera=V.mul(e,this.centerTranslation,this.camera),this.camera=V.mul(this.translation,this.camera,this.camera),this.invCamera=V.invert(this.camera,this.invCamera)}eyePos(){return[this.invCamera[12],this.invCamera[13],this.invCamera[14]]}eyeDir(){var e=ke.set(0,0,-1,0);return e=ke.transformMat4(e,e,this.invCamera),e=ke.normalize(e,e),[e[0],e[1],e[2]]}upDir(){var e=ke.set(0,1,0,0);return e=ke.transformMat4(e,e,this.invCamera),e=ke.normalize(e,e),[e[0],e[1],e[2]]}}function ls(t){const e=W.dot(t,t);if(e<=1)return Ue.set(t[0],t[1],Math.sqrt(1-e),0);{const r=W.normalize(t);return Ue.set(r[0],r[1],0,0)}}function bt(t,e,r){return t<e?e:t>r?r:t}const pe=class pe{};k(pe,"defs"),k(pe,"view"),k(pe,"elementByteSize"),(()=>{try{pe.defs=ir(An),pe.elementByteSize=Cu(pe.defs.storages[tt]).size,pe.view=e=>Qt(pe.defs.storages[tt],new ArrayBuffer(e*pe.elementByteSize))}catch{}})();let $e=pe;class Qc extends $e{constructor(r,n,s){super();k(this,"type",1);this.dir=r,this.color=n,this.flux=s}}class hs{update(){}}class Zc{constructor(e){k(this,"bindGroupLayout");k(this,"bindGroup",null);k(this,"cameras",[]);k(this,"mainCamera",null);k(this,"lights",[]);k(this,"buffers",[]);k(this,"children",[]);k(this,"updates",[]);k(this,"needUpdateBindGroup",!1);this.device=e,this.bindGroupLayout=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.buffers[0]=e.createBuffer({size:Re.view.arrayBuffer.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM})}add(e){e instanceof Re?(this.cameras.push(e),this.mainCamera=e):e instanceof hs?(e instanceof ds&&this.add(e.camera),this.updates.push(e)):e instanceof $e?(this.lights.push(e),this.needUpdateBindGroup=!0):this.children.push(e)}makeBindGroup(){return this.buffers[1]=this.device.createBuffer({size:$e.elementByteSize*this.lights.length,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE}),this.device.createBindGroup({layout:this.bindGroupLayout,entries:this.buffers.map((e,r)=>({binding:r,resource:{buffer:e}}))})}setBuffers(){Re.view.set({projectionMatrix:this.mainCamera.matrix,viewMatrix:this.mainCamera.viewMatrix,cameraPosition:this.mainCamera.cameraPosition}),this.device.queue.writeBuffer(this.buffers[0],0,Re.view.arrayBuffer);const e=$e.view(this.lights.length);e.set(this.lights.map(r=>({dir:r.dir??Q.zero(),pos:r.pos??Q.zero(),color:r.color,flux:r.flux,ltype:r.type}))),this.device.queue.writeBuffer(this.buffers[1],0,e.arrayBuffer)}render(e,r){this.mainCamera&&((!this.bindGroup||this.needUpdateBindGroup)&&(this.bindGroup=this.makeBindGroup(),this.needUpdateBindGroup=!1),this.updates.forEach(n=>n.update()),this.setBuffers(),e.setBindGroup(0,this.bindGroup),this.children.forEach(n=>n.render(e,r)))}}let el=class{constructor(){k(this,"mousemove",null);k(this,"press",null);k(this,"wheel",null);k(this,"twoFingerDrag",null);k(this,"pinch",null)}registerForCanvas(t){let e;t.addEventListener("mousemove",s=>{s.preventDefault();const i=t.getBoundingClientRect(),o=[s.clientX-i.left,s.clientY-i.top];e?this.mousemove&&this.mousemove(e,o,s):e=[s.clientX-i.left,s.clientY-i.top],e=o}),t.addEventListener("mousedown",s=>{s.preventDefault();let i=t.getBoundingClientRect(),o=[s.clientX-i.left,s.clientY-i.top];this.press&&this.press(o,s)}),t.addEventListener("wheel",s=>{s.preventDefault(),this.wheel&&this.wheel(-s.deltaY)}),t.oncontextmenu=function(s){s.preventDefault()};const r={};t.addEventListener("touchstart",s=>{const i=t.getBoundingClientRect();s.preventDefault();for(let o=0;o<s.changedTouches.length;++o){const a=s.changedTouches[o];r[a.identifier]=[a.clientX-i.left,a.clientY-i.top],s.changedTouches.length==1&&this.press&&this.press(r[a.identifier],s)}}),t.addEventListener("touchmove",s=>{s.preventDefault();const i=t.getBoundingClientRect();if(Object.keys(r).length==1){if(this.mousemove){const o=s.changedTouches[0],a=r[o.identifier],u=[o.clientX-i.left,o.clientY-i.top];s.buttons=1,this.mousemove(a,u,s)}}else{const o={};for(let y=0;y<s.changedTouches.length;++y){let w=s.changedTouches[y];o[w.identifier]=[w.clientX-i.left,w.clientY-i.top]}let a=[];for(const y in r)y in o||(o[y]=r[y]),a.push(r[y]);let u=[];for(const y in o)u.push(o[y]);let c=[W.set(u[0][0]-a[0][0],u[0][1]-a[0][1]),W.set(u[1][0]-a[1][0],u[1][1]-a[1][1])],h=[W.create(),W.create()];W.normalize(h[0],c[0]),W.normalize(h[1],c[1]);let d=W.set(a[1][0]-a[0][0],a[1][1]-a[0][1]);W.normalize(d,d);let m=W.lerp(c[0],c[1],.5);W.normalize(m,m);let g=[W.dot(d,h[0]),W.dot(d,h[1])],b=[W.dot(m,h[0]),W.dot(m,h[1])];if(this.pinch&&Math.abs(g[0])>.5&&Math.abs(g[1])>.5&&Math.sign(g[0])!=Math.sign(g[1])){let y=W.distance(a[0],a[1]),w=W.distance(u[0],u[1]);this.pinch(w-y)}else if(this.twoFingerDrag&&Math.abs(b[0])>.5&&Math.abs(b[1])>.5&&Math.sign(b[0])==Math.sign(b[1])){let y=W.lerp(c[0],c[1],.5);y[1]=-y[1],this.twoFingerDrag(y)}}for(let o=0;o<s.changedTouches.length;++o){let a=s.changedTouches[o];r[a.identifier]=[a.clientX-i.left,a.clientY-i.top]}});let n=function(s){s.preventDefault();for(let i=0;i<s.changedTouches.length;++i){let o=s.changedTouches[i];delete r[o.identifier]}};t.addEventListener("touchcancel",n),t.addEventListener("touchend",n)}};const Ge=class Ge{constructor(){this.viewMatrix=V.identity(),this.cameraPosition=Q.zero()}};k(Ge,"defs"),k(Ge,"view"),(()=>{try{Ge.defs=ir(Tn),Ge.view=Qt(Ge.defs.uniforms[et])}catch{}})();let Re=Ge;class tl extends Re{constructor(r,n,s,i){super();k(this,"eye",[0,0,0]);k(this,"target",[0,0,0]);k(this,"up",[0,1,0]);this.matrix=V.perspective(r,n,s,i)}lookAt(r,n,s){this.eye=r,n&&(this.target=n),s&&(this.up=s),this.viewMatrix=V.lookAt(this.eye,this.target,this.up),this.cameraPosition=Q.getTranslation(V.inverse(this.viewMatrix))}}class ds extends hs{constructor(r,n,s){super();k(this,"arcballController");k(this,"id","orbitcontroller-tips");this.camera=r,this.canvas=n,this.options=s,this.arcballController=this.createArcBallCamera(r.eye,r.target,r.up)}createArcBallCamera(r,n,s){const i=this.canvas.clientWidth,o=this.canvas.clientHeight,{zoomSpeed:a}=this.options??{},u=new Kc(r,n,s,a??.5,[i,o]),c=new el;if(c.mousemove=(h,d,m)=>{m.buttons==1?u.rotate(h,d):m.buttons==2&&u.pan([d[0]-h[0],h[1]-d[1]])},c.wheel=h=>{u.zoom(h*.5)},c.registerForCanvas(this.canvas),!document.getElementById(this.id)){const h=document.createElement("div");h.innerText="Controls: left-click to drag, right-click to pan, scroll to zoom.",document.body.insertBefore(h,document.body.firstChild),h.id=this.id}return u}update(){this.camera.viewMatrix=this.arcballController.camera,this.camera.cameraPosition=Q.getTranslation(V.inverse(this.camera.viewMatrix))}}const rl=`const lightDir = vec3f(0, -1, 0);\r
const lightColor = vec3f(0.5);\r
const ambientColor = vec3f(0.5);\r
\r
@fragment\r
fn main(@location(0) norm: vec3f) -> @location(0) vec4f {\r
  let n = normalize(norm);\r
  let l = normalize(lightDir);\r
  let surfaceColor = ambientColor + lightColor * saturate(dot(n, -l));\r
  return vec4f(surfaceColor, 1.);\r
}`;class nl{constructor(){k(this,"comments",[]);k(this,"name","");k(this,"vertexs",[]);k(this,"uvs",[]);k(this,"norms",[]);k(this,"indices",[]);k(this,"vertexData",[]);k(this,"matrix",V.identity());k(this,"record");k(this,"renderPipeline",null);k(this,"renderBuffers",null);k(this,"renderBindGroup",null)}get VertexCount(){return this.vertexs.length/3}makeBuffers(e,r){if(this.vertexs.length===0)throw new Error("No vertex");const{indexFormat:n="uint32"}=r??{},s=n==="uint32"?new Uint32Array(this.indices):new Uint16Array(this.indices),i=e.createBuffer({size:s.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(i,0,s);const o=new Float32Array(this.vertexData),a=e.createBuffer({size:o.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});e.queue.writeBuffer(a,0,o);const u=[{arrayStride:8*4,stepMode:"vertex",attributes:[{shaderLocation:Ee.POSITION,offset:0,format:"float32x3"},{shaderLocation:Ee.NORMAL,offset:3*4,format:"float32x3"},{shaderLocation:Ee.TEXCOORD_0,offset:6*4,format:"float32x2"}]}];return{indicesBuffer:i,vertexBuffer:a,vertexDescriptor:u,indexFormat:n}}makeBindGroup(e){const r=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"read-only-storage"}}]}),n=e.createBuffer({size:16*4*2,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),s=V.transpose(V.inverse(this.matrix));return new Float32Array(n.getMappedRange()).set([...this.matrix,...s]),n.unmap(),{bindGroup:e.createBindGroup({layout:r,entries:[{binding:0,resource:{buffer:n}}]}),bindGroupLayout:r}}buildRenderPipeline(e,r,n,s,i,o="depth24plus",a){this.renderBuffers=this.makeBuffers(e,{indexFormat:"uint32"}),this.renderBindGroup={...this.makeBindGroup(e),groupIndex:s.length},a&&a.bindGroupCount++,this.renderPipeline=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[...s,this.renderBindGroup.bindGroupLayout]}),vertex:{module:e.createShaderModule({code:typeof r=="string"?r:r({})}),entryPoint:"main",buffers:this.renderBuffers.vertexDescriptor},fragment:{module:e.createShaderModule({code:n}),entryPoint:"main",targets:[{format:i}]},primitive:{cullMode:"back",topology:"triangle-list"},depthStencil:{format:o,depthWriteEnabled:!0,depthCompare:"less"}}),a&&a.pipelineCount++,this.record=a}buildInRenderPipeline(e,r,n,s="depth24plus",i){return this.buildRenderPipeline(e,On,rl,r,n,s,i)}render(e,r,n){if(!this.renderPipeline)return;const s=n??new Yt;this.record&&Object.assign(s,this.record);const{vertexBuffer:i,indicesBuffer:o,indexFormat:a}=this.renderBuffers,{groupIndex:u,bindGroup:c}=this.renderBindGroup;return e.setPipeline(this.renderPipeline),s&&s.pipelineSets++,e.setVertexBuffer(0,i),e.setIndexBuffer(o,a),s&&(s.bufferSets=s.bufferSets+2),e.setBindGroup(u,c),s&&s.bindGroupSets++,e.drawIndexed(this.indices.length),s&&s.drawCount++,r&&r(s),s}}class sl{async load(e,r,n){const s=await this.parse(r),{bindGroupLayouts:i,format:o,depthFormat:a,record:u}=n;return s.buildInRenderPipeline(e,i,o,a,u),s}async parse(e){const r=(await(await fetch(e)).text()).split(`
`),n=new nl,s=[],i=[],o=[],a=[];n.name=e.split("/").at(-1)??"",r.forEach(y=>{const w=y.trim(),[S,...E]=w.split(" ");S==="#"?n.comments.push(E.join(" ")):S==="o"?n.name=E.join(" "):S==="v"?s.push(E.map(parseFloat)):S==="vt"?i.push(E.map(parseFloat)):S==="vn"?o.push(E.map(parseFloat)):S==="f"&&a.push(E)});const u=[],c=[],h=[],d=[],m=[],g={};let b=0;for(const y of a)for(const w of y){if(g[w]!==void 0){d.push(g[w]);continue}g[w]=b,d.push(b);const[S,E,A]=w.split("/").map(L=>Number(L)-1);S>-1&&(u.push(...s[S]),m.push(...s[S]));const M=A>-1?o[A]:be([(he(-1,1),he(-1,1),he(-1,1))]);h.push(...M),m.push(...M);const N=E>-1?i[E]:[he(0,1),he(0,1)];c.push(...N),m.push(...N),b++}return n.vertexs=u,n.uvs=c,n.norms=h,n.indices=d,n.vertexData=m,n}}function il(t){if(t&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function Xe(t,e){var r=t.__state.conversionName.toString(),n=Math.round(t.r),s=Math.round(t.g),i=Math.round(t.b),o=t.a,a=Math.round(t.h),u=t.s.toFixed(1),c=t.v.toFixed(1);if(e||r==="THREE_CHAR_HEX"||r==="SIX_CHAR_HEX"){for(var h=t.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}else{if(r==="CSS_RGB")return"rgb("+n+","+s+","+i+")";if(r==="CSS_RGBA")return"rgba("+n+","+s+","+i+","+o+")";if(r==="HEX")return"0x"+t.hex.toString(16);if(r==="RGB_ARRAY")return"["+n+","+s+","+i+"]";if(r==="RGBA_ARRAY")return"["+n+","+s+","+i+","+o+"]";if(r==="RGB_OBJ")return"{r:"+n+",g:"+s+",b:"+i+"}";if(r==="RGBA_OBJ")return"{r:"+n+",g:"+s+",b:"+i+",a:"+o+"}";if(r==="HSV_OBJ")return"{h:"+a+",s:"+u+",v:"+c+"}";if(r==="HSVA_OBJ")return"{h:"+a+",s:"+u+",v:"+c+",a:"+o+"}"}return"unknown format"}var fs=Array.prototype.forEach,it=Array.prototype.slice,x={BREAK:{},extend:function(t){return this.each(it.call(arguments,1),function(e){var r=this.isObject(e)?Object.keys(e):[];r.forEach((function(n){this.isUndefined(e[n])||(t[n]=e[n])}).bind(this))},this),t},defaults:function(t){return this.each(it.call(arguments,1),function(e){var r=this.isObject(e)?Object.keys(e):[];r.forEach((function(n){this.isUndefined(t[n])&&(t[n]=e[n])}).bind(this))},this),t},compose:function(){var t=it.call(arguments);return function(){for(var e=it.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},each:function(t,e,r){if(t){if(fs&&t.forEach&&t.forEach===fs)t.forEach(e,r);else if(t.length===t.length+0){var n=void 0,s=void 0;for(n=0,s=t.length;n<s;n++)if(n in t&&e.call(r,t[n],n)===this.BREAK)return}else for(var i in t)if(e.call(r,t[i],i)===this.BREAK)return}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,r){var n=void 0;return function(){var s=this,i=arguments;function o(){n=null,r||t.apply(s,i)}var a=r||!n;clearTimeout(n),n=setTimeout(o,e),a&&t.apply(s,i)}},toArray:function(t){return t.toArray?t.toArray():it.call(t)},isUndefined:function(t){return t===void 0},isNull:function(t){return t===null},isNaN:function(t){function e(r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return t instanceof Function}},ol=[{litmus:x.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Xe},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Xe},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Xe},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Xe}}},{litmus:x.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:x.isArray,conversions:{RGB_ARRAY:{read:function(t){return t.length!==3?!1:{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return t.length!==4?!1:{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:x.isObject,conversions:{RGBA_OBJ:{read:function(t){return x.isNumber(t.r)&&x.isNumber(t.g)&&x.isNumber(t.b)&&x.isNumber(t.a)?{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return x.isNumber(t.r)&&x.isNumber(t.g)&&x.isNumber(t.b)?{space:"RGB",r:t.r,g:t.g,b:t.b}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return x.isNumber(t.h)&&x.isNumber(t.s)&&x.isNumber(t.v)&&x.isNumber(t.a)?{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return x.isNumber(t.h)&&x.isNumber(t.s)&&x.isNumber(t.v)?{space:"HSV",h:t.h,s:t.s,v:t.v}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],ot=void 0,vt=void 0,hr=function(){vt=!1;var t=arguments.length>1?x.toArray(arguments):arguments[0];return x.each(ol,function(e){if(e.litmus(t))return x.each(e.conversions,function(r,n){if(ot=r.read(t),vt===!1&&ot!==!1)return vt=ot,ot.conversionName=n,ot.conversion=r,x.BREAK}),x.BREAK}),vt},ps=void 0,xt={hsv_to_rgb:function(t,e,r){var n=Math.floor(t/60)%6,s=t/60-Math.floor(t/60),i=r*(1-e),o=r*(1-s*e),a=r*(1-(1-s)*e),u=[[r,a,i],[o,r,i],[i,r,a],[i,o,r],[a,i,r],[r,i,o]][n];return{r:u[0]*255,g:u[1]*255,b:u[2]*255}},rgb_to_hsv:function(t,e,r){var n=Math.min(t,e,r),s=Math.max(t,e,r),i=s-n,o=void 0,a=void 0;if(s!==0)a=i/s;else return{h:NaN,s:0,v:0};return t===s?o=(e-r)/i:e===s?o=2+(r-t)/i:o=4+(t-e)/i,o/=6,o<0&&(o+=1),{h:o*360,s:a,v:s/255}},rgb_to_hex:function(t,e,r){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,r),n},component_from_hex:function(t,e){return t>>e*8&255},hex_with_component:function(t,e,r){return r<<(ps=e*8)|t&~(255<<ps)}},al=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},fe=function(){function t(e,r){for(var n=0;n<r.length;n++){var s=r[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Me=function t(e,r,n){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,r);if(s===void 0){var i=Object.getPrototypeOf(e);return i===null?void 0:t(i,r,n)}else{if("value"in s)return s.value;var o=s.get;return o===void 0?void 0:o.call(n)}},Ce=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Oe=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},se=function(){function t(){if(de(this,t),this.__state=hr.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return fe(t,[{key:"toString",value:function(){return Xe(this)}},{key:"toHexString",value:function(){return Xe(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function dr(t,e,r){Object.defineProperty(t,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(se.recalculateRGB(this,e,r),this.__state[e])},set:function(n){this.__state.space!=="RGB"&&(se.recalculateRGB(this,e,r),this.__state.space="RGB"),this.__state[e]=n}})}function fr(t,e){Object.defineProperty(t,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(se.recalculateHSV(this),this.__state[e])},set:function(r){this.__state.space!=="HSV"&&(se.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=r}})}se.recalculateRGB=function(t,e,r){if(t.__state.space==="HEX")t.__state[e]=xt.component_from_hex(t.__state.hex,r);else if(t.__state.space==="HSV")x.extend(t.__state,xt.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v));else throw new Error("Corrupted color state")},se.recalculateHSV=function(t){var e=xt.rgb_to_hsv(t.r,t.g,t.b);x.extend(t.__state,{s:e.s,v:e.v}),x.isNaN(e.h)?x.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},se.COMPONENTS=["r","g","b","h","s","v","hex","a"],dr(se.prototype,"r",2),dr(se.prototype,"g",1),dr(se.prototype,"b",0),fr(se.prototype,"h"),fr(se.prototype,"s"),fr(se.prototype,"v"),Object.defineProperty(se.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(se.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=xt.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var Fe=function(){function t(e,r){de(this,t),this.initialValue=e[r],this.domElement=document.createElement("div"),this.object=e,this.property=r,this.__onChange=void 0,this.__onFinishChange=void 0}return fe(t,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),ul={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},ms={};x.each(ul,function(t,e){x.each(t,function(r){ms[r]=e})});var cl=/(\d+(\.\d+)?)px/;function ye(t){if(t==="0"||x.isUndefined(t))return 0;var e=t.match(cl);return x.isNull(e)?0:parseFloat(e[1])}var _={makeSelectable:function(t,e){t===void 0||t.style===void 0||(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,r){var n=r,s=e;x.isUndefined(s)&&(s=!0),x.isUndefined(n)&&(n=!0),t.style.position="absolute",s&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,r,n){var s=r||{},i=ms[e];if(!i)throw new Error("Event type "+e+" not supported.");var o=document.createEvent(i);switch(i){case"MouseEvents":{var a=s.x||s.clientX||0,u=s.y||s.clientY||0;o.initMouseEvent(e,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,a,u,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var c=o.initKeyboardEvent||o.initKeyEvent;x.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break}default:{o.initEvent(e,s.bubbles||!1,s.cancelable||!0);break}}x.defaults(o,n),t.dispatchEvent(o)},bind:function(t,e,r,n){var s=n||!1;return t.addEventListener?t.addEventListener(e,r,s):t.attachEvent&&t.attachEvent("on"+e,r),_},unbind:function(t,e,r,n){var s=n||!1;return t.removeEventListener?t.removeEventListener(e,r,s):t.detachEvent&&t.detachEvent("on"+e,r),_},addClass:function(t,e){if(t.className===void 0)t.className=e;else if(t.className!==e){var r=t.className.split(/ +/);r.indexOf(e)===-1&&(r.push(e),t.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return _},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var r=t.className.split(/ +/),n=r.indexOf(e);n!==-1&&(r.splice(n,1),t.className=r.join(" "))}else t.className=void 0;return _},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return ye(e["border-left-width"])+ye(e["border-right-width"])+ye(e["padding-left"])+ye(e["padding-right"])+ye(e.width)},getHeight:function(t){var e=getComputedStyle(t);return ye(e["border-top-width"])+ye(e["border-bottom-width"])+ye(e["padding-top"])+ye(e["padding-bottom"])+ye(e.height)},getOffset:function(t){var e=t,r={left:0,top:0};if(e.offsetParent)do r.left+=e.offsetLeft,r.top+=e.offsetTop,e=e.offsetParent;while(e);return r},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},_s=function(t){Ce(e,t);function e(r,n){de(this,e);var s=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),i=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function o(){i.setValue(!i.__prev)}return _.bind(s.__checkbox,"change",o,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return fe(e,[{key:"setValue",value:function(r){var n=Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Fe),ll=function(t){Ce(e,t);function e(r,n,s){de(this,e);var i=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),o=s,a=i;if(i.__select=document.createElement("select"),x.isArray(o)){var u={};x.each(o,function(c){u[c]=c}),o=u}return x.each(o,function(c,h){var d=document.createElement("option");d.innerHTML=h,d.setAttribute("value",c),a.__select.appendChild(d)}),i.updateDisplay(),_.bind(i.__select,"change",function(){var c=this.options[this.selectedIndex].value;a.setValue(c)}),i.domElement.appendChild(i.__select),i}return fe(e,[{key:"setValue",value:function(r){var n=Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return _.isActive(this.__select)?this:(this.__select.value=this.getValue(),Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Fe),hl=function(t){Ce(e,t);function e(r,n){de(this,e);var s=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),i=s;function o(){i.setValue(i.__input.value)}function a(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),_.bind(s.__input,"keyup",o),_.bind(s.__input,"change",o),_.bind(s.__input,"blur",a),_.bind(s.__input,"keydown",function(u){u.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return fe(e,[{key:"updateDisplay",value:function(){return _.isActive(this.__input)||(this.__input.value=this.getValue()),Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Fe);function gs(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var ys=function(t){Ce(e,t);function e(r,n,s){de(this,e);var i=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),o=s||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,x.isUndefined(i.__step)?i.initialValue===0?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=gs(i.__impliedStep),i}return fe(e,[{key:"setValue",value:function(r){var n=r;return this.__min!==void 0&&n<this.__min?n=this.__min:this.__max!==void 0&&n>this.__max&&(n=this.__max),this.__step!==void 0&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(r){return this.__min=r,this}},{key:"max",value:function(r){return this.__max=r,this}},{key:"step",value:function(r){return this.__step=r,this.__impliedStep=r,this.__precision=gs(r),this}}]),e}(Fe);function dl(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r}var kt=function(t){Ce(e,t);function e(r,n,s){de(this,e);var i=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n,s));i.__truncationSuspended=!1;var o=i,a=void 0;function u(){var b=parseFloat(o.__input.value);x.isNaN(b)||o.setValue(b)}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function h(){c()}function d(b){var y=a-b.clientY;o.setValue(o.getValue()+y*o.__impliedStep),a=b.clientY}function m(){_.unbind(window,"mousemove",d),_.unbind(window,"mouseup",m),c()}function g(b){_.bind(window,"mousemove",d),_.bind(window,"mouseup",m),a=b.clientY}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),_.bind(i.__input,"change",u),_.bind(i.__input,"blur",h),_.bind(i.__input,"mousedown",g),_.bind(i.__input,"keydown",function(b){b.keyCode===13&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,c())}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return fe(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():dl(this.getValue(),this.__precision),Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ys);function ws(t,e,r,n,s){return n+(s-n)*((t-e)/(r-e))}var pr=function(t){Ce(e,t);function e(r,n,s,i,o){de(this,e);var a=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n,{min:s,max:i,step:o})),u=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),_.bind(a.__background,"mousedown",c),_.bind(a.__background,"touchstart",m),_.addClass(a.__background,"slider"),_.addClass(a.__foreground,"slider-fg");function c(y){document.activeElement.blur(),_.bind(window,"mousemove",h),_.bind(window,"mouseup",d),h(y)}function h(y){y.preventDefault();var w=u.__background.getBoundingClientRect();return u.setValue(ws(y.clientX,w.left,w.right,u.__min,u.__max)),!1}function d(){_.unbind(window,"mousemove",h),_.unbind(window,"mouseup",d),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}function m(y){y.touches.length===1&&(_.bind(window,"touchmove",g),_.bind(window,"touchend",b),g(y))}function g(y){var w=y.touches[0].clientX,S=u.__background.getBoundingClientRect();u.setValue(ws(w,S.left,S.right,u.__min,u.__max))}function b(){_.unbind(window,"touchmove",g),_.unbind(window,"touchend",b),u.__onFinishChange&&u.__onFinishChange.call(u,u.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return fe(e,[{key:"updateDisplay",value:function(){var r=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=r*100+"%",Me(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ys),bs=function(t){Ce(e,t);function e(r,n,s){de(this,e);var i=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=s===void 0?"Fire":s,_.bind(i.__button,"click",function(a){return a.preventDefault(),o.fire(),!1}),_.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return fe(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Fe),mr=function(t){Ce(e,t);function e(r,n){de(this,e);var s=Oe(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r,n));s.__color=new se(s.getValue()),s.__temp=new se(0);var i=s;s.domElement=document.createElement("div"),_.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",_.bind(s.__input,"keydown",function(y){y.keyCode===13&&d.call(this)}),_.bind(s.__input,"blur",d),_.bind(s.__selector,"mousedown",function(){_.addClass(this,"drag").bind(window,"mouseup",function(){_.removeClass(i.__selector,"drag")})}),_.bind(s.__selector,"touchstart",function(){_.addClass(this,"drag").bind(window,"touchend",function(){_.removeClass(i.__selector,"drag")})});var o=document.createElement("div");x.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),x.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),x.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),x.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),x.extend(o.style,{width:"100%",height:"100%",background:"none"}),vs(o,"top","rgba(0,0,0,0)","#000"),x.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),pl(s.__hue_field),x.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),_.bind(s.__saturation_field,"mousedown",a),_.bind(s.__saturation_field,"touchstart",a),_.bind(s.__field_knob,"mousedown",a),_.bind(s.__field_knob,"touchstart",a),_.bind(s.__hue_field,"mousedown",u),_.bind(s.__hue_field,"touchstart",u);function a(y){g(y),_.bind(window,"mousemove",g),_.bind(window,"touchmove",g),_.bind(window,"mouseup",c),_.bind(window,"touchend",c)}function u(y){b(y),_.bind(window,"mousemove",b),_.bind(window,"touchmove",b),_.bind(window,"mouseup",h),_.bind(window,"touchend",h)}function c(){_.unbind(window,"mousemove",g),_.unbind(window,"touchmove",g),_.unbind(window,"mouseup",c),_.unbind(window,"touchend",c),m()}function h(){_.unbind(window,"mousemove",b),_.unbind(window,"touchmove",b),_.unbind(window,"mouseup",h),_.unbind(window,"touchend",h),m()}function d(){var y=hr(this.value);y!==!1?(i.__color.__state=y,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function m(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}s.__saturation_field.appendChild(o),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function g(y){y.type.indexOf("touch")===-1&&y.preventDefault();var w=i.__saturation_field.getBoundingClientRect(),S=y.touches&&y.touches[0]||y,E=S.clientX,A=S.clientY,M=(E-w.left)/(w.right-w.left),N=1-(A-w.top)/(w.bottom-w.top);return N>1?N=1:N<0&&(N=0),M>1?M=1:M<0&&(M=0),i.__color.v=N,i.__color.s=M,i.setValue(i.__color.toOriginal()),!1}function b(y){y.type.indexOf("touch")===-1&&y.preventDefault();var w=i.__hue_field.getBoundingClientRect(),S=y.touches&&y.touches[0]||y,E=S.clientY,A=1-(E-w.top)/(w.bottom-w.top);return A>1?A=1:A<0&&(A=0),i.__color.h=A*360,i.setValue(i.__color.toOriginal()),!1}return s}return fe(e,[{key:"updateDisplay",value:function(){var r=hr(this.getValue());if(r!==!1){var n=!1;x.each(se.COMPONENTS,function(o){if(!x.isUndefined(r[o])&&!x.isUndefined(this.__color.__state[o])&&r[o]!==this.__color.__state[o])return n=!0,{}},this),n&&x.extend(this.__color.__state,r)}x.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,i=255-s;x.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,vs(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),x.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(Fe),fl=["-moz-","-o-","-webkit-","-ms-",""];function vs(t,e,r,n){t.style.background="",x.each(fl,function(s){t.style.cssText+="background: "+s+"linear-gradient("+e+", "+r+" 0%, "+n+" 100%); "})}function pl(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var ml={load:function(t,e){var r=e||document,n=r.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=t,r.getElementsByTagName("head")[0].appendChild(n)},inject:function(t,e){var r=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var s=r.getElementsByTagName("head")[0];try{s.appendChild(n)}catch{}}},_l=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,gl=function(t,e){var r=t[e];return x.isArray(arguments[2])||x.isObject(arguments[2])?new ll(t,e,arguments[2]):x.isNumber(r)?x.isNumber(arguments[2])&&x.isNumber(arguments[3])?x.isNumber(arguments[4])?new pr(t,e,arguments[2],arguments[3],arguments[4]):new pr(t,e,arguments[2],arguments[3]):x.isNumber(arguments[4])?new kt(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new kt(t,e,{min:arguments[2],max:arguments[3]}):x.isString(r)?new hl(t,e):x.isFunction(r)?new bs(t,e,""):x.isBoolean(r)?new _s(t,e):null};function yl(t){setTimeout(t,1e3/60)}var wl=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||yl,bl=function(){function t(){de(this,t),this.backgroundElement=document.createElement("div"),x.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),_.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),x.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;_.bind(this.backgroundElement,"click",function(){e.hide()})}return fe(t,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),x.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,r=function n(){e.domElement.style.display="none",e.backgroundElement.style.display="none",_.unbind(e.domElement,"webkitTransitionEnd",n),_.unbind(e.domElement,"transitionend",n),_.unbind(e.domElement,"oTransitionEnd",n)};_.bind(this.domElement,"webkitTransitionEnd",r),_.bind(this.domElement,"transitionend",r),_.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-_.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-_.getHeight(this.domElement)/2+"px"}}]),t}(),vl=il(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);ml.inject(vl);var xs="dg",ks=72,Ss=20,at="Default",ut=function(){try{return!!window.localStorage}catch{return!1}}(),ct=void 0,Es=!0,Ye=void 0,_r=!1,Ts=[],H=function t(e){var r=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),_.addClass(this.domElement,xs),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=x.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=x.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),x.isUndefined(n.load)?n.load={preset:at}:n.preset&&(n.load.preset=n.preset),x.isUndefined(n.parent)&&n.hideable&&Ts.push(this),n.resizable=x.isUndefined(n.parent)&&n.resizable,n.autoPlace&&x.isUndefined(n.scrollable)&&(n.scrollable=!0);var s=ut&&localStorage.getItem(We(this,"isLocal"))==="true",i=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return r.parent?r.getRoot().preset:n.load.preset},set:function(d){r.parent?r.getRoot().preset=d:n.load.preset=d,El(this),r.revert()}},width:{get:function(){return n.width},set:function(d){n.width=d,br(r,d)}},name:{get:function(){return n.name},set:function(d){n.name=d,o&&(o.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(d){n.closed=d,n.closed?_.addClass(r.__ul,t.CLASS_CLOSED):_.removeClass(r.__ul,t.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=d?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return s},set:function(d){ut&&(s=d,d?_.bind(window,"unload",i):_.unbind(window,"unload",i),localStorage.setItem(We(r,"isLocal"),d))}}}),x.isUndefined(n.parent)){if(this.closed=n.closed||!1,_.addClass(this.domElement,t.CLASS_MAIN),_.makeSelectable(this.domElement,!1),ut&&s){r.useLocalStorage=!0;var a=localStorage.getItem(We(this,"gui"));a&&(n.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,_.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(_.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(_.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),_.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{n.closed===void 0&&(n.closed=!0);var u=document.createTextNode(n.name);_.addClass(u,"controller-name"),o=gr(r,u);var c=function(d){return d.preventDefault(),r.closed=!r.closed,!1};_.addClass(this.__ul,t.CLASS_CLOSED),_.addClass(o,"title"),_.bind(o,"click",c),n.closed||(this.closed=!1)}n.autoPlace&&(x.isUndefined(n.parent)&&(Es&&(Ye=document.createElement("div"),_.addClass(Ye,xs),_.addClass(Ye,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Ye),Es=!1),Ye.appendChild(this.domElement),_.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||br(r,n.width)),this.__resizeHandler=function(){r.onResizeDebounced()},_.bind(window,"resize",this.__resizeHandler),_.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),_.bind(this.__ul,"transitionend",this.__resizeHandler),_.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&Sl(this),i=function(){ut&&localStorage.getItem(We(r,"isLocal"))==="true"&&localStorage.setItem(We(r,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=i;function h(){var d=r.getRoot();d.width+=1,x.defer(function(){d.width-=1})}n.parent||h()};H.toggleHide=function(){_r=!_r,x.each(Ts,function(t){t.domElement.style.display=_r?"none":""})},H.CLASS_AUTO_PLACE="a",H.CLASS_AUTO_PLACE_CONTAINER="ac",H.CLASS_MAIN="main",H.CLASS_CONTROLLER_ROW="cr",H.CLASS_TOO_TALL="taller-than-window",H.CLASS_CLOSED="closed",H.CLASS_CLOSE_BUTTON="close-button",H.CLASS_CLOSE_TOP="close-top",H.CLASS_CLOSE_BOTTOM="close-bottom",H.CLASS_DRAG="drag",H.DEFAULT_WIDTH=245,H.TEXT_CLOSED="Close Controls",H.TEXT_OPEN="Open Controls",H._keydownHandler=function(t){document.activeElement.type!=="text"&&(t.which===ks||t.keyCode===ks)&&H.toggleHide()},_.bind(window,"keydown",H._keydownHandler,!1),x.extend(H.prototype,{add:function(t,e){return lt(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return lt(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;x.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Ye.removeChild(this.domElement);var t=this;x.each(this.__folders,function(e){t.removeFolder(e)}),_.unbind(window,"keydown",H._keydownHandler,!1),As(this)},addFolder:function(t){if(this.__folders[t]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var r=new H(e);this.__folders[t]=r;var n=gr(this,r.domElement);return _.addClass(n,"folder"),r},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],As(t);var e=this;x.each(t.__folders,function(r){t.removeFolder(r)}),x.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=_.getOffset(t.__ul).top,r=0;x.each(t.__ul.childNodes,function(n){t.autoPlace&&n===t.__save_row||(r+=_.getHeight(n))}),window.innerHeight-e-Ss<r?(_.addClass(t.domElement,H.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-Ss+"px"):(_.removeClass(t.domElement,H.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&x.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:x.debounce(function(){this.onResize()},50),remember:function(){if(x.isUndefined(ct)&&(ct=new bl,ct.domElement.innerHTML=_l),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;x.each(Array.prototype.slice.call(arguments),function(e){t.__rememberedObjects.length===0&&kl(t),t.__rememberedObjects.indexOf(e)===-1&&t.__rememberedObjects.push(e)}),this.autoPlace&&br(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=St(this)),t.folders={},x.each(this.__folders,function(e,r){t.folders[r]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=St(this),yr(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[at]=St(this,!0)),this.load.remembered[t]=St(this),this.preset=t,wr(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){x.each(this.__controllers,function(e){this.getRoot().load.remembered?Ms(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),x.each(this.__folders,function(e){e.revert(e)}),t||yr(this.getRoot(),!1)},listen:function(t){var e=this.__listening.length===0;this.__listening.push(t),e&&Os(this.__listening)},updateDisplay:function(){x.each(this.__controllers,function(t){t.updateDisplay()}),x.each(this.__folders,function(t){t.updateDisplay()})}});function gr(t,e,r){var n=document.createElement("li");return e&&n.appendChild(e),r?t.__ul.insertBefore(n,r):t.__ul.appendChild(n),t.onResize(),n}function As(t){_.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&_.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function yr(t,e){var r=t.__preset_select[t.__preset_select.selectedIndex];e?r.innerHTML=r.value+"*":r.innerHTML=r.value}function xl(t,e,r){if(r.__li=e,r.__gui=t,x.extend(r,{options:function(i){if(arguments.length>1){var o=r.__li.nextElementSibling;return r.remove(),lt(t,r.object,r.property,{before:o,factoryArgs:[x.toArray(arguments)]})}if(x.isArray(i)||x.isObject(i)){var a=r.__li.nextElementSibling;return r.remove(),lt(t,r.object,r.property,{before:a,factoryArgs:[i]})}},name:function(i){return r.__li.firstElementChild.firstElementChild.innerHTML=i,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof pr){var n=new kt(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});x.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(i){var o=r[i],a=n[i];r[i]=n[i]=function(){var u=Array.prototype.slice.call(arguments);return a.apply(n,u),o.apply(r,u)}}),_.addClass(e,"has-slider"),r.domElement.insertBefore(n.domElement,r.domElement.firstElementChild)}else if(r instanceof kt){var s=function(i){if(x.isNumber(r.__min)&&x.isNumber(r.__max)){var o=r.__li.firstElementChild.firstElementChild.innerHTML,a=r.__gui.__listening.indexOf(r)>-1;r.remove();var u=lt(t,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]});return u.name(o),a&&u.listen(),u}return i};r.min=x.compose(s,r.min),r.max=x.compose(s,r.max)}else r instanceof _s?(_.bind(e,"click",function(){_.fakeEvent(r.__checkbox,"click")}),_.bind(r.__checkbox,"click",function(i){i.stopPropagation()})):r instanceof bs?(_.bind(e,"click",function(){_.fakeEvent(r.__button,"click")}),_.bind(e,"mouseover",function(){_.addClass(r.__button,"hover")}),_.bind(e,"mouseout",function(){_.removeClass(r.__button,"hover")})):r instanceof mr&&(_.addClass(e,"color"),r.updateDisplay=x.compose(function(i){return e.style.borderLeftColor=r.__color.toString(),i},r.updateDisplay),r.updateDisplay());r.setValue=x.compose(function(i){return t.getRoot().__preset_select&&r.isModified()&&yr(t.getRoot(),!0),i},r.setValue)}function Ms(t,e){var r=t.getRoot(),n=r.__rememberedObjects.indexOf(e.object);if(n!==-1){var s=r.__rememberedObjectIndecesToControllers[n];if(s===void 0&&(s={},r.__rememberedObjectIndecesToControllers[n]=s),s[e.property]=e,r.load&&r.load.remembered){var i=r.load.remembered,o=void 0;if(i[t.preset])o=i[t.preset];else if(i[at])o=i[at];else return;if(o[n]&&o[n][e.property]!==void 0){var a=o[n][e.property];e.initialValue=a,e.setValue(a)}}}}function lt(t,e,r,n){if(e[r]===void 0)throw new Error('Object "'+e+'" has no property "'+r+'"');var s=void 0;if(n.color)s=new mr(e,r);else{var i=[e,r].concat(n.factoryArgs);s=gl.apply(t,i)}n.before instanceof Fe&&(n.before=n.before.__li),Ms(t,s),_.addClass(s.domElement,"c");var o=document.createElement("span");_.addClass(o,"property-name"),o.innerHTML=s.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(s.domElement);var u=gr(t,a,n.before);return _.addClass(u,H.CLASS_CONTROLLER_ROW),s instanceof mr?_.addClass(u,"color"):_.addClass(u,al(s.getValue())),xl(t,u,s),t.__controllers.push(s),s}function We(t,e){return document.location.href+"."+e}function wr(t,e,r){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),r&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function Cs(t,e){e.style.display=t.useLocalStorage?"block":"none"}function kl(t){var e=t.__save_row=document.createElement("li");_.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),_.addClass(e,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",_.addClass(r,"button gears");var n=document.createElement("span");n.innerHTML="Save",_.addClass(n,"button"),_.addClass(n,"save");var s=document.createElement("span");s.innerHTML="New",_.addClass(s,"button"),_.addClass(s,"save-as");var i=document.createElement("span");i.innerHTML="Revert",_.addClass(i,"button"),_.addClass(i,"revert");var o=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?x.each(t.load.remembered,function(d,m){wr(t,m,m===t.preset)}):wr(t,at,!1),_.bind(o,"change",function(){for(var d=0;d<t.__preset_select.length;d++)t.__preset_select[d].innerHTML=t.__preset_select[d].value;t.preset=this.value}),e.appendChild(o),e.appendChild(r),e.appendChild(n),e.appendChild(s),e.appendChild(i),ut){var a=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block",localStorage.getItem(We(t,"isLocal"))==="true"&&u.setAttribute("checked","checked"),Cs(t,a),_.bind(u,"change",function(){t.useLocalStorage=!t.useLocalStorage,Cs(t,a)})}var h=document.getElementById("dg-new-constructor");_.bind(h,"keydown",function(d){d.metaKey&&(d.which===67||d.keyCode===67)&&ct.hide()}),_.bind(r,"click",function(){h.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),ct.show(),h.focus(),h.select()}),_.bind(n,"click",function(){t.save()}),_.bind(s,"click",function(){var d=prompt("Enter a new preset name.");d&&t.saveAs(d)}),_.bind(i,"click",function(){t.revert()})}function Sl(t){var e=void 0;t.__resize_handle=document.createElement("div"),x.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function r(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function n(){_.removeClass(t.__closeButton,H.CLASS_DRAG),_.unbind(window,"mousemove",r),_.unbind(window,"mouseup",n)}function s(i){return i.preventDefault(),e=i.clientX,_.addClass(t.__closeButton,H.CLASS_DRAG),_.bind(window,"mousemove",r),_.bind(window,"mouseup",n),!1}_.bind(t.__resize_handle,"mousedown",s),_.bind(t.__closeButton,"mousedown",s),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function br(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function St(t,e){var r={};return x.each(t.__rememberedObjects,function(n,s){var i={},o=t.__rememberedObjectIndecesToControllers[s];x.each(o,function(a,u){i[u]=e?a.initialValue:a.getValue()}),r[s]=i}),r}function El(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}function Os(t){t.length!==0&&wl.call(window,function(){Os(t)}),x.each(t,function(e){e.updateDisplay()})}var Tl=H;async function Al(t,e){const r=navigator.gpu;if(!r)throw new Error("Web GPU not available");const n=await r.requestAdapter(t);if(!n)throw new Error("Can not request Web GPU Adapter");e!=null&&e.requiredFeatures&&(e.requiredFeatures=e.requiredFeatures.filter(i=>n.features.has(i)));const s=await n.requestDevice(e);if(!s)throw new Error("Can not request Web GPU Device");return{gpu:r,adapter:n,device:s,format:r.getPreferredCanvasFormat()}}function Ml(t,e,r,n,s){var m;const i=typeof t=="object"&&typeof e=="object";if(!i&&!(typeof t!="object"&&typeof e!="object"))throw new Error("");const o=document.createElement("canvas");o.id="webgpu-canvas",n&&(o.className=n);const a=i?t.width:t,u=i?t.height:e;o.style.width=typeof a=="number"?`${a}px`:a,o.style.height=typeof u=="number"?`${u}px`:u,(m=s?document.getElementById(s):document.body)==null||m.appendChild(o);const c=i?e.width:o.clientWidth,h=i?e.height:o.clientHeight;o.width=c*window.devicePixelRatio,o.height=h*window.devicePixelRatio;const d=o.getContext("webgpu");if(!d)throw new Error("webgpu context for canvas not available");return r&&d.configure(r),{canvas:o,ctx:d,width:o.clientWidth,height:o.clientHeight,aspect:o.clientWidth/o.clientHeight}}const le=class le{static checkTextureIsValid(e,r){const n=!e||e.width!==r[0]||e.height!==r[1];return n&&e&&e.destroy(),n}static createDepthTexture(e,r){return le.checkTextureIsValid(le.depthTexture,r)&&(le.depthTexture=e.createTexture({size:r,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})),le.depthTexture}static createMultiSampleTexture(e,r,n,s){return le.checkTextureIsValid(le.multiSampleTexture,r)&&(le.multiSampleTexture=e.createTexture({format:n,usage:GPUTextureUsage.RENDER_ATTACHMENT,size:r,sampleCount:s})),le.multiSampleTexture}};k(le,"depthTexture"),k(le,"multiSampleTexture");let vr=le;class Cl{constructor(e){k(this,"className");k(this,"parentID");this.className=e==null?void 0:e.className,this.parentID=e==null?void 0:e.parentID}async checkSupport(){const e=await Al(),{device:r,format:n}=e,s=Ml(500,500,{device:r,format:n},this.className,this.parentID);return Object.assign(this,{...e,...s}),this}render(e,r){const n=this.ctx.getCurrentTexture(),s=vr.createDepthTexture(this.device,[n.width,n.height]),i=this.device.createCommandEncoder(),o=i.beginRenderPass({colorAttachments:[{loadOp:"clear",storeOp:"store",view:n.createView()}],depthStencilAttachment:{depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",view:s.createView()}});e.render(o,r),o.end(),this.device.queue.submit([i.finish()])}}const Ol=(t,e)=>new Promise(r=>{const n=setInterval(()=>{e()&&(clearInterval(n),r(!0))},t)}),Tt=class Tt{constructor(e){k(this,"root");k(this,"bar");k(this,"text");k(this,"canHidden",!1);k(this,"transitionDuration",.1);this.root=document.createElement("div"),this.root.className="loading-bar",this.root.innerHTML=Tt.html,(e??document.body).appendChild(this.root),this.bar=document.querySelector(".bar-container .progress"),this.bar.style.setProperty("transition-duration",`${this.transitionDuration}s`),this.text=document.querySelector(".bar-container .tip"),new MutationObserver(r=>{r.forEach(n=>{n.type=="attributes"&&n.attributeName=="style"&&n.target.style.width=="100%"&&(this.canHidden=!0)})}).observe(this.bar,{attributes:!0})}setPercentage(e,r,n){this.bar.style.setProperty("width",`${e*100}%`),this.text.textContent=`${r}: ${e*100}%`}showLoading(){this.root.classList.toggle("show")}async hiddenLoading(){this.nextTick(()=>this.root.classList.toggle("show"))}async nextTick(e){await Ol(10,()=>this.canHidden),setTimeout(e,(this.transitionDuration+.1)*1e3)}};k(Tt,"html",`
    <div class="bar-container">
      <div class="bar">
        <div class="progress"></div>
      </div>
      <div class="tip">dd</div>
    </div>
  `);let xr=Tt;const we=location.href,Ns={bunny:{path:`${we}bunny/bunny-export.obj`,near:1,far:100,eye:[0,2,5],target:[0,0,0]},avocado:{path:`${we}gltf/Avocado.glb`,near:.01,far:1e3,eye:[0,0,.2],zoomSpeed:.5},cylinder_engine:{path:`${we}gltf/2CylinderEngine.glb`,near:.01,far:1e3,eye:[0,0,700],zoomSpeed:70},stone_demon:{path:`${we}gltf/stone_demon.glb`,near:.01,far:1e3,eye:[0,3,3],zoomSpeed:5},antique_camera:{path:`${we}glTF-Sample-Models/2.0/AntiqueCamera/glTF-Binary/AntiqueCamera-Interleaved.glb`,near:.01,far:100,eye:[0,10,5],target:[0,4,0],zoomSpeed:5},buggy:{path:`${we}glTF-Sample-Models/2.0/Buggy/glTF-Binary/Buggy.glb`,near:.01,far:1e3,eye:[100,200,0],target:[0,0,0],zoomSpeed:30},corset:{path:`${we}glTF-Sample-Models/2.0/Corset/glTF-Binary/Corset.glb`,near:.01,far:1e3,eye:[.1,.1,0],target:[0,.01,0],zoomSpeed:1},damaged_helmet:{path:`${we}glTF-Sample-Models/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb`,near:.01,far:100,eye:[0,0,5],target:[0,0,0],zoomSpeed:30},flight_helmet:{path:`${we}glTF-Sample-Models/2.0/FlightHelmet/glTF-Binary/FlightHelmet.glb`,near:.01,far:100,eye:[1,1,0],target:[0,.5,0],zoomSpeed:5},sponza:{path:`${we}glTF-Sample-Models/2.0/Sponza/glTF-Binary/Sponza.glb`,near:.01,far:100,eye:[5,10,0],target:[0,3,0],zoomSpeed:10}};let ht=!0;const Je={model_name:"stone_demon",mips:!0,flux:10},kr=new Tl;kr.add(Je,"model_name",Object.keys(Ns)).onChange(()=>ht=!0),kr.add(Je,"mips").onChange(()=>ht=!0),kr.add(Je,"flux",1,40);const Et=document.createElement("div");Et.id="canvas-parent",document.body.appendChild(Et);const Sr=new xr(Et),Ne=await new Cl({parentID:Et.id}).checkSupport().catch(({message:t})=>{const e=document.createElement("div");throw e.innerText=t,document.body.appendChild(e),new Error(t)}),Bs=new Qc([-1,-1,-1],[1,1,1,1],10);async function Nl(){const t=Ns[Je.model_name],e=new Zc(Ne.device);e.add(Bs);const r=new tl(Ie(75),Ne.aspect,t.near,t.far);r.lookAt(t.eye,t.target);const n=new ds(r,Ne.canvas,{zoomSpeed:t.zoomSpeed});e.add(n);const s=t.path.endsWith(".obj")?new sl:new Uc;Sr.showLoading();const i=await s.load(Ne.device,t.path,{bindGroupLayouts:[e.bindGroupLayout],format:Ne.format,mips:Je.mips,record:new Yt,onProgress:(o,a)=>{Sr.setPercentage(a,o)}});return Sr.hiddenLoading(),e.add(i),e}let Er=document.createElement("div");Er.className="record",document.body.appendChild(Er);let Is;async function zs(){ht&&(Is=await Nl()),Bs.flux=Je.flux,Ne==null||Ne.render(Is,t=>{ht&&(Er.innerHTML=`
<div>pipelineCount: ${t.pipelineCount}</div>
<div>pipelineSets: ${t.pipelineSets}</div>
<div>bindGroupCount: ${t.bindGroupCount}</div>
<div>bindGroupSets: ${t.bindGroupSets}</div>
<div>bufferSets: ${t.bufferSets}</div>
<div>drawCount: ${t.drawCount}</div>
`)}),ht=!1,requestAnimationFrame(zs)}requestAnimationFrame(zs)})();
